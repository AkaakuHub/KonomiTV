import{D as m,d as k,m as y,M as i,U as p,J as V,u as U,_ as $,r as B,o as _,g as F,w as d,e,i as N,b as s,c as g,h as c,X as f,l as h,t as E,n as T,R as I,p as P,q as R}from"./index-ndZ4D6My.js";import{C as M}from"./CommentMuteSettings-Wir5EXnU.js";import{S as O}from"./Base--d3RfA1W.js";import{V as w}from"./VSlider-hBChPhPk.js";import{V as L}from"./VSwitch-fjBgU2Yt.js";import"./VDialog-pmrLWE8U.js";import"./VTextField-NByOXRhe.js";import"./index-T_rq9rzx.js";import"./transition-UUEsY4u_.js";import"./VAvatar-KwYm5DOR.js";import"./VCard-if2q-Q_q.js";import"./ssrBoot--GxFJ_Pv.js";import"./VSelect-NGSqugWF.js";import"./Navigation-agvUXJ8_.js";import"./lazy-ow2CGE0z.js";class W{static async fetchAuthorizationURL(){const t=await m.get("/niconico/auth");return t.type==="error"?(m.showGenericError(t,"ニコニコアカウントとの連携用の認証 URL を取得できませんでした。"),null):t.data.authorization_url}static async logoutAccount(){const t=await m.delete("/niconico/logout");return t.type==="error"?(m.showGenericError(t,"ニコニコアカウントとの連携を解除できませんでした。"),!1):!0}}const S=W,K=k({name:"Settings-Jikkyo",components:{SettingsBase:O,CommentMuteSettings:M},data(){return{comment_mute_settings_modal:!1,is_loading:!0}},computed:{...y(U,V)},async created(){if(await this.userStore.fetchUser(),this.is_loading=!1,location.hash!==""){const u=new URLSearchParams(location.hash.replace("#",""));if(u.get("status")!==null&&u.get("detail")!==null){const t=parseInt(u.get("status")),a=u.get("detail");this.onOAuthCallbackReceived(t,a),history.replaceState(null,""," ")}}},methods:{async loginNiconicoAccount(){if(this.userStore.is_logged_in===!1){i.warning("連携をはじめるには、KonomiTV アカウントにログインしてください。");return}const u=await S.fetchAuthorizationURL();if(u===null)return;if(p.isMobileDevice()===!0){location.href=u;return}const t=window.open(u,"KonomiTV-OAuthPopup",p.getWindowFeatures());if(t===null){i.error("ポップアップウインドウを開けませんでした。");return}const a=async l=>{if(t.closed||p.typeof(l.data)!=="object"||!("KonomiTV-OAuthPopup"in l.data))return;t&&t.close(),window.removeEventListener("message",a);const A=l.data["KonomiTV-OAuthPopup"].status,C=l.data["KonomiTV-OAuthPopup"].detail;this.onOAuthCallbackReceived(A,C)};window.addEventListener("message",a)},async onOAuthCallbackReceived(u,t){if(console.log(`NiconicoAuthCallbackAPI: Status: ${u} / Detail: ${t}`),u!==200){if(t.startsWith("Authorization was denied (access_denied)"))i.error("ニコニコアカウントとの連携がキャンセルされました。");else if(t.startsWith("Failed to get access token (HTTP Error ")){const a=t.replace("Failed to get access token ","");i.error(`アクセストークンの取得に失敗しました。${a}`)}else if(t.startsWith("Failed to get access token (Connection Timeout)"))i.error("アクセストークンの取得に失敗しました。ニコニコで障害が発生している可能性があります。");else if(t.startsWith("Failed to get user information (HTTP Error ")){const a=t.replace("Failed to get user information ","");i.error(`ニコニコアカウントのユーザー情報の取得に失敗しました。${a}`)}else t.startsWith("Failed to get user information (Connection Timeout)")?i.error("ニコニコアカウントのユーザー情報の取得に失敗しました。ニコニコで障害が発生している可能性があります。"):i.error(`ニコニコアカウントとの連携に失敗しました。(${t})`);return}await this.userStore.fetchUser(!0),i.success("ニコニコアカウントと連携しました。")},async logoutNiconicoAccount(){await S.logoutAccount()!==!1&&(await this.userStore.fetchUser(!0),i.success("ニコニコアカウントとの連携を解除しました。"))}}}),o=u=>(P("data-v-d9abe42b"),u=u(),R(),u),z={class:"settings__heading"},J=o(()=>e("span",{class:"ml-3"},"ニコニコ実況",-1)),j={key:0,class:"niconico-account niconico-account--anonymous"},G={class:"niconico-account-wrapper"},H=o(()=>e("div",{class:"niconico-account__info ml-4"},[e("div",{class:"niconico-account__info-name"},[e("span",{class:"niconico-account__info-name-text"},"ニコニコアカウントと連携していません")]),e("span",{class:"niconico-account__info-description"}," ニコニコアカウントと連携すると、テレビを見ながらニコニコ実況にコメントできるようになります。 ")],-1)),q={key:1,class:"niconico-account"},X={class:"niconico-account-wrapper"},Q=["src"],Y={class:"niconico-account__info"},Z={class:"niconico-account__info-name"},x={class:"niconico-account__info-name-text"},uu={class:"niconico-account__info-description"},tu=o(()=>e("span",{class:"mr-2",style:{"white-space":"nowrap"}},"Niconico User ID:",-1)),eu=["href"],su={key:0,class:"text-secondary"},ou=o(()=>e("div",{class:"settings__item mt-7"},[e("div",{class:"settings__item-heading"},"コメントのミュート設定"),e("div",{class:"settings__item-label"},[c(" 表示したくないコメントを、映像上やコメントリストに表示しないようにミュートできます。"),e("br")])],-1)),nu=o(()=>e("span",{class:"ml-1"},"コメントのミュート設定を開く",-1)),iu={class:"settings__item"},au=o(()=>e("div",{class:"settings__item-heading"},"コメントの速さ",-1)),cu=o(()=>e("div",{class:"settings__item-label"},[c(" プレイヤーに流れるコメントの速さを設定します。"),e("br"),c(" たとえば 1.2 に設定すると、コメントが 1.2 倍速く流れます。"),e("br")],-1)),ru={class:"settings__item"},lu=o(()=>e("div",{class:"settings__item-heading"},"コメントの文字サイズ",-1)),_u=o(()=>e("div",{class:"settings__item-label"},[c(" プレイヤーに流れるコメントの文字サイズの基準値を設定します。"),e("br"),c(" 実際の文字サイズは画面サイズに合わせて調整されます。デフォルトの文字サイズは 34px です。"),e("br")],-1)),du={class:"settings__item settings__item--switch"},mu=o(()=>e("label",{class:"settings__item-heading",for:"close_comment_form_after_sending"},"コメント送信後にコメント入力フォームを閉じる",-1)),Bu=o(()=>e("label",{class:"settings__item-label",for:"close_comment_form_after_sending"},[c(" この設定をオンにすると、コメントを送信した後に、コメント入力フォームが自動で閉じるようになります。"),e("br"),c(" コメント入力フォームが表示されたままだと、大半のショートカットキーが文字入力と競合して使えなくなります。とくに理由がなければ、オンにしておくのがおすすめです。"),e("br")],-1));function pu(u,t,a,l,A,C){const r=B("Icon"),v=B("router-link"),b=B("CommentMuteSettings"),D=B("SettingsBase");return _(),F(D,null,{default:d(()=>[e("h2",z,[N((_(),F(v,{class:"settings__back-button",to:"/settings/"},{default:d(()=>[s(r,{icon:"fluent:arrow-left-12-filled",width:"25px"})]),_:1})),[[I]]),s(r,{icon:"bi:chat-left-text-fill",width:"19px"}),J]),e("div",{class:T(["settings__content",{"settings__content--loading":u.is_loading}])},[u.userStore.user===null||u.userStore.user.niconico_user_id===null?(_(),g("div",j,[e("div",G,[s(r,{class:"flex-shrink-0",icon:"bi:chat-left-text-fill",width:"45px"}),H]),s(f,{class:"niconico-account__login ml-auto",color:"secondary",width:"130",height:"56",variant:"flat",onClick:t[0]||(t[0]=n=>u.loginNiconicoAccount())},{default:d(()=>[s(r,{icon:"fluent:plug-connected-20-filled",class:"mr-2",height:"26"}),c("連携する ")]),_:1})])):h("",!0),u.userStore.user!==null&&u.userStore.user.niconico_user_id!==null?(_(),g("div",q,[e("div",X,[e("img",{class:"niconico-account__icon",src:u.userStore.user_niconico_icon_url??""},null,8,Q),e("div",Y,[e("div",Z,[e("span",x,E(u.userStore.user.niconico_user_name)+" と連携しています",1)]),e("span",uu,[tu,e("a",{class:"link mr-2",href:`https://www.nicovideo.jp/user/${u.userStore.user.niconico_user_id}`,target:"_blank"},E(u.userStore.user.niconico_user_id),9,eu),u.userStore.user.niconico_user_premium===!0?(_(),g("span",su,"(Premium)")):h("",!0)])])]),s(f,{class:"niconico-account__login ml-auto",color:"secondary",width:"130",height:"56",variant:"flat",onClick:t[1]||(t[1]=n=>u.logoutNiconicoAccount())},{default:d(()=>[s(r,{icon:"fluent:plug-disconnected-20-filled",class:"mr-2",height:"26"}),c("連携解除 ")]),_:1})])):h("",!0),ou,s(f,{class:"settings__save-button mt-4",variant:"flat",onClick:t[2]||(t[2]=n=>u.comment_mute_settings_modal=!u.comment_mute_settings_modal)},{default:d(()=>[s(r,{icon:"heroicons-solid:filter",height:"19px"}),nu]),_:1}),e("div",iu,[au,cu,s(w,{class:"settings__item-form",color:"primary","show-ticks":"always","thumb-label":"","hide-details":"",step:.1,min:.5,max:2,modelValue:u.settingsStore.settings.comment_speed_rate,"onUpdate:modelValue":t[3]||(t[3]=n=>u.settingsStore.settings.comment_speed_rate=n)},null,8,["modelValue"])]),e("div",ru,[lu,_u,s(w,{class:"settings__item-form",color:"primary","show-ticks":"always","thumb-label":"","hide-details":"",step:1,min:20,max:60,modelValue:u.settingsStore.settings.comment_font_size,"onUpdate:modelValue":t[4]||(t[4]=n=>u.settingsStore.settings.comment_font_size=n)},null,8,["modelValue"])]),e("div",du,[mu,Bu,s(L,{class:"settings__item-switch",color:"primary",id:"close_comment_form_after_sending","hide-details":"",modelValue:u.settingsStore.settings.close_comment_form_after_sending,"onUpdate:modelValue":t[5]||(t[5]=n=>u.settingsStore.settings.close_comment_form_after_sending=n)},null,8,["modelValue"])])],2),s(b,{modelValue:u.comment_mute_settings_modal,"onUpdate:modelValue":t[6]||(t[6]=n=>u.comment_mute_settings_modal=n)},null,8,["modelValue"])]),_:1})}const Uu=$(K,[["render",pu],["__scopeId","data-v-d9abe42b"]]);export{Uu as default};
