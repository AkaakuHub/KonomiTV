(function(){var t={40490:function(t,e,s){"use strict";var i=s(62856),a=s(96086),n=s(52803),r=s(77738),o=s(20144),l=s(54801),c=s(61797),_=s.n(c),d=s(43726),u=function(){var t=this,e=t._self._c;return e(d.Z,{attrs:{id:"app"}},[e("transition",[e("router-view")],1)],1)},m=[],p=s(1001),h={},g=(0,p.Z)(h,u,m,!1,null,null,null),v=g.exports,f=s(56975),w=f.Z.extend({render(t){return t("transition",{props:{name:this.computedTransition},on:{beforeEnter:this.onBeforeTransition,afterEnter:this.onAfterTransition,enterCancelled:this.onTransitionCancelled,beforeLeave:this.onBeforeTransition,afterLeave:this.onAfterTransition,leaveCancelled:this.onTransitionCancelled,enter:this.onEnter}},[this.genWindowItem()])}}),b=s(96150),y=s(48131),C=(s(57658),s(20286)),k=C.Z.extend({data(){return{items:[]}},methods:{register(t){const e=this.items[this.internalIndex];this.items.push(t),this.items.sort(((t,e)=>{const s=this.$slots.default.findIndex((e=>t.$vnode.key===e.key)),i=this.$slots.default.findIndex((t=>e.$vnode.key===t.key));return s-i})),t.$on("change",(()=>this.onClick(t))),this.mandatory&&!this.selectedValues.length&&this.updateMandatory(),this.updateItem(t,this.items.indexOf(t)),void 0!==e&&this.updateInternalValue(this.items.indexOf(e))},unregister(t){const e=this.items[this.internalIndex];this.constructor.super.options.methods.unregister.call(this,t),void 0!==e&&this.updateInternalValue(this.items.indexOf(e))}}}),x=b.Z.extend({methods:{genBar(t,e){const s={style:{height:(0,y.kb)(this.height)},props:{activeClass:this.activeClass,centerActive:this.centerActive,dark:this.dark,light:this.light,mandatory:!this.optional,mobileBreakpoint:this.mobileBreakpoint,nextIcon:this.nextIcon,prevIcon:this.prevIcon,showArrows:this.showArrows,value:this.internalValue},on:{"call:slider":this.callSlider,change:t=>{this.internalValue=t}},ref:"items"};return this.setTextColor(this.computedColor,s),this.setBackgroundColor(this.backgroundColor,s),this.$createElement(k,s,[this.genSlider(e),t])}}}),S=s(71550),O=S.Z.extend({data(){return{items:[]}},methods:{register(t){const e=this.items[this.internalIndex];this.items.push(t),this.items.sort(((t,e)=>{const s=this.$slots.default.findIndex((e=>t.$vnode.key===e.key)),i=this.$slots.default.findIndex((t=>e.$vnode.key===t.key));return s-i})),t.$on("change",(()=>this.onClick(t))),this.mandatory&&!this.selectedValues.length&&this.updateMandatory(),this.updateItem(t,this.items.indexOf(t)),void 0!==e&&this.items.indexOf(e)!==this.internalValue&&this.updateInternalValue(this.items.indexOf(e))},unregister(t){const e=this.items[this.internalIndex];this.constructor.super.options.methods.unregister.call(this,t),void 0!==e&&this.updateInternalValue(this.items.indexOf(e))},updateReverse(t,e){const s=this.items.length,i=s-1;return s<=2?t<e:this.continuous?t===i&&0===e||(0!==t||e!==i)&&t<e:t<e}}}),T=s(88741),I=s(4741),j=s(89088),Z=s(78986);o["default"].use(Z.Z),o["default"].component("v-snackbar",T.Z),o["default"].component("v-btn",I.Z),o["default"].component("v-icon",j.Z);var B=new Z.Z({theme:{dark:!0,themes:{dark:{primary:"#E64F97",secondary:"#E33157",twitter:{base:"#4F82E6",lighten1:"#799FEC",lighten2:"#41A5F1"},gray:"#66514C",black:"#110A09",background:{base:"#1E1310",lighten1:"#2F221F",lighten2:"#433532",lighten3:"#4c3c38"},text:{base:"#FFEAEA",darken1:"#D9C7C7",darken2:"#8E7F7E",darken3:"#786968"}}},options:{customProperties:!0}}}),P=s(78345);class ${static getAccessToken(){return localStorage.getItem("KonomiTV-AccessToken")}static saveAccessToken(t){localStorage.setItem("KonomiTV-AccessToken",t)}static deleteAccessToken(){null!==localStorage.getItem("KonomiTV-AccessToken")&&localStorage.removeItem("KonomiTV-AccessToken")}static AltOrOption(){return/iPhone|iPad|Macintosh/i.test(navigator.userAgent)?"Option":"Alt"}static CtrlOrCmd(){return/iPhone|iPad|Macintosh/i.test(navigator.userAgent)?"Cmd":"Ctrl"}static downloadBlobData(t,e){const s=URL.createObjectURL(t),i=document.createElement("a");i.download=e,i.href=s,i.click(),URL.revokeObjectURL(s)}static escapeHTML(t){const e={"&":"&amp;",'"':"&quot;","'":"&apos;","<":"&lt;",">":"&gt;"};return t.replace(/[&"'<>]/g,(t=>e[t]))}static getWindowFeatures(){const t=650,e=window.screen.height>=800?800:window.screen.height-100,s=(window.screen.height-e)/2,i=(window.screen.width-t)/2;return`toolbar=0,status=0,top=${s},left=${i},width=${t},height=${e},modal=yes,alwaysRaised=yes`}static hasActiveElementClass(t){return null!==document.activeElement&&document.activeElement.classList.contains(t)}static isFirefox(){return/Firefox/i.test(navigator.userAgent)}static isSafari(){return/Safari/i.test(navigator.userAgent)&&!/Chrome/i.test(navigator.userAgent)}static isMobileDevice(){return/iPhone|iPad|iPod|Macintosh|Android|Mobile/i.test(navigator.userAgent)&&"ontouchend"in document}static isSmartphoneHorizontal(){return window.matchMedia("(max-width: 1000px) and (max-height: 450px)").matches}static isSmartphoneVertical(){return window.matchMedia("(max-width: 600px) and (min-height: 450.01px)").matches}static isTabletHorizontal(){return window.matchMedia("(max-width: 1264px) and (max-height: 850px)").matches}static isTabletVertical(){return window.matchMedia("(max-width: 850px) and (min-height: 850.01px)").matches}static isTouchDevice(){return window.matchMedia("(hover: none)").matches}static mathFloor(t,e=0){return Math.floor(t*10**e)/10**e}static async sleep(t){return await new Promise((e=>setTimeout(e,1e3*t)))}static time(){return Date.now()/1e3}static typeof(t){return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()}static URLtoLink(t){t=$.escapeHTML(t);const e=/(https?:\/\/[-A-Z0-9+&@#/%?=~_|!:,.;]*[-A-Z0-9+&@#/%=~_|])/gi;return t.replace(e,'<a href="$1" target="_blank">$1</a>')}}$.version="0.8.0-dev",$.api_base_url=(()=>`${window.location.protocol}//${window.location.host}/api`)();var z=$;class A{static getChannelType(t){try{const e=t.match("(?<channel_type>[a-z]+)[0-9]+").groups.channel_type.toUpperCase();return e}catch(e){return"GR"}}static getChannelForceType(t){return null===t?"normal":t>=500?"festival":t>=200?"so-many":t>=100?"many":"normal"}}var D=s(48764),L=s(29204),N={success(t){return window.KonomiTVVueInstance?.$message.success(t)},info(t){return window.KonomiTVVueInstance?.$message.info(t)},warning(t){return window.KonomiTVVueInstance?.$message.warning(t)},error(t){return window.KonomiTVVueInstance?.$message.error(t)},show(t){return window.KonomiTVVueInstance?.$message.show(t)}},E=s(6154);const K=E["default"].create();K.interceptors.request.use((t=>{if(void 0===t.baseURL&&(t.baseURL=pt.api_base_url),!1===t.url?.startsWith("http")){const e=pt.getAccessToken();null!==e&&(t.headers["Authorization"]=`Bearer ${e}`),t.headers["X-KonomiTV-Version"]=pt.version}return t.timeout=3e4,t}));var M=K;class H{static async createUser(t){const e=await G.post("/users",t);if("is_error"in e){switch(e.error.message){case"Specified username is duplicated":N.error("ユーザー名が重複しています。");break;case"Specified username is not accepted due to system limitations":N.error("ユーザー名に token と me は使えません。");break;default:G.showGenericError(e,"アカウントを作成できませんでした。");break}return null}return e.data}static async createUserAccessToken(t,e){const s=await G.post("/users/token",new URLSearchParams({username:t,password:e}));if("is_error"in s){switch(s.error.message){case"Incorrect username":N.error("ログインできませんでした。そのユーザー名のアカウントは存在しません。");break;case"Incorrect password":N.error("ログインできませんでした。パスワードを間違えていませんか？");break;default:G.showGenericError(s,"ログインできませんでした。");break}return null}return s.data}static async fetchUser(){const t=await G.get("/users/me");return"is_error"in t?(G.showGenericError(t,"アカウント情報を取得できませんでした。"),null):t.data}static async fetchUserIcon(){const t=await G.get("/users/me/icon",{responseType:"blob"});return"is_error"in t?(G.showGenericError(t,"アイコン画像を取得できませんでした。"),null):URL.createObjectURL(t.data)}static async updateUser(t){const e=await G.put("/users/me",t);if("is_error"in e)switch(e.error.message){case"Specified username is duplicated":N.error("ユーザー名が重複しています。");break;case"Specified username is not accepted due to system limitations":N.error("ユーザー名に token と me は使えません。");break;default:G.showGenericError(e,"アカウント情報を更新できませんでした。");break}else;}static async updateUserIcon(t){const e=new FormData;e.append("image",t);const s=await G.put("/users/me/icon",e,{headers:{"Content-Type":"multipart/form-data"}});if("is_error"in s)switch(s.error.message){case"Please upload JPEG or PNG image":N.error("JPEG または PNG 画像をアップロードしてください。");break;default:G.showGenericError(s,"アイコン画像を更新できませんでした。");break}else;}static async deleteUser(){const t=await G["delete"]("/users/me");"is_error"in t&&G.showGenericError(t,"アカウントを削除できませんでした。")}}var F=H;const V=(0,a.Q_)("user",{state:()=>({is_logged_in:!1,user:null,user_icon_url:null}),getters:{user_niconico_icon_url(){if(null===this.user||null===this.user.niconico_user_id)return null;const t=this.user.niconico_user_id.toString().slice(0,4);return`https://secure-dcdn.cdn.nimg.jp/nicoaccount/usericon/${t}/${this.user.niconico_user_id}.jpg`}},actions:{async register(t,e){const s=await F.createUser({username:t,password:e});return null===s?(console.log("Register failed."),!1):(await this.login(t,e,!0),console.log("Register successful."),N.success("アカウントを作成しました。"),!0)},async login(t,e,s=!1){const i=await F.createUserAccessToken(t,e);return null===i?(console.log("Login failed."),this.logout(!0),!1):(console.log("Login successful."),pt.saveAccessToken(i.access_token),this.is_logged_in=!0,await this.fetchUser(!0),!1===s&&N.success("ログインしました。"),!0)},logout(t=!1){const e=st();e.settings.sync_settings=!1,pt.deleteAccessToken(),this.is_logged_in=!1,this.user=null,this.user_icon_url="",!1===t&&N.success("ログアウトしました。")},async fetchUser(t=!1){if(null===pt.getAccessToken())return null;if(null!==this.user&&!1===t)return this.user;const e=await F.fetchUser();if(null===e)return null===pt.getAccessToken()&&this.logout(!0),null;this.is_logged_in=!0,this.user=e;const s=await F.fetchUserIcon();return null===s?null:(this.user_icon_url=s,this.user)},async updateUser(t){await F.updateUser(t),await this.fetchUser(!0),void 0!==t.username?N.show("ユーザー名を更新しました。"):void 0!==t.password&&N.show("パスワードを更新しました。")},async updateUserIcon(t){await F.updateUserIcon(t),await this.fetchUser(!0),N.show("アイコン画像を更新しました。")},async deleteUser(){await F.deleteUser(),this.logout(!0),N.show("アカウントを削除しました。")}}});var R=V;class U{static async request(t){const e=await M.request(t).catch((t=>t));return e instanceof L.d7?(console.error(e),e.response?{status:e.response.status,data:null,error:new Error(e.response.data.detail),is_error:!0}:{status:NaN,data:null,error:e,is_error:!0}):{status:e.status,data:e.data,error:null,is_success:!0}}static async get(t,e){const s={url:t,method:"GET",...e};return await U.request(s)}static async post(t,e,s){const i={url:t,method:"POST",data:e,...s};return await U.request(i)}static async put(t,e,s){const i={url:t,method:"PUT",data:e,...s};return await U.request(i)}static async delete(t,e){const s={url:t,method:"DELETE",...e};return await U.request(s)}static showGenericError(t,e){const s=R();switch(t.error.message){case"Not authenticated":return s.logout(!0),void N.error(`${e}\nログインし直してください。`);case"Access token data is invalid":return s.logout(!0),void N.error(`${e}\nログインセッションが不正です。もう一度ログインし直してください。`);case"Access token is invalid":return s.logout(!0),void N.error(`${e}\nログインセッションの有効期限が切れています。もう一度ログインし直してください。`);case"User associated with access token does not exist":return s.logout(!0),void N.error(`${e}\nログインセッションに紐づくユーザーが存在しないか、削除されています。`);default:return void(t.error.message?Number.isNaN(t.status)?N.error(`${e}(${t.error.message})`):N.error(`${e}(HTTP Error ${t.status} / ${t.error.message})`):N.error(`${e}(HTTP Error ${t.status})`))}}}var G=U;class W{static async fetchClientSettings(){const t=await G.get("/settings/client");return"is_error"in t?null:t.data}static async updateClientSettings(t){await G.put("/settings/client",t)}}var q=W;const Y=["pinned_channel_ids","saved_twitter_hashtags","panel_display_state","tv_panel_active_tab","tv_channel_selection_requires_alt_key","caption_font","always_border_caption_text","specify_caption_opacity","caption_opacity","tv_show_superimpose","capture_save_mode","capture_caption_mode","comment_speed_rate","comment_font_size","close_comment_form_after_sending","muted_comment_keywords","muted_niconico_user_ids","mute_vulgar_comments","mute_abusive_discriminatory_prejudiced_comments","mute_big_size_comments","mute_fixed_comments","mute_colored_comments","mute_consecutive_same_characters_comments","fold_panel_after_sending_tweet","reset_hashtag_when_program_switches","auto_add_watching_channel_hashtag","twitter_active_tab","tweet_hashtag_position","tweet_capture_watermark_position"],X={pinned_channel_ids:[],showed_panel_last_time:!0,selected_twitter_account_id:null,saved_twitter_hashtags:[],tv_streaming_quality:"1080p",tv_data_saver_mode:!1,tv_low_latency_mode:!0,panel_display_state:"RestorePreviousState",tv_panel_active_tab:"Program",tv_channel_selection_requires_alt_key:!1,caption_font:"Windows TV MaruGothic",always_border_caption_text:!0,specify_caption_opacity:!1,caption_opacity:.5,tv_show_superimpose:!0,tv_show_data_broadcasting:!0,capture_copy_to_clipboard:!1,capture_save_mode:"UploadServer",capture_caption_mode:"Both",sync_settings:!1,comment_speed_rate:1,comment_font_size:34,close_comment_form_after_sending:!0,muted_comment_keywords:[],muted_niconico_user_ids:[],mute_vulgar_comments:!0,mute_abusive_discriminatory_prejudiced_comments:!0,mute_big_size_comments:!0,mute_fixed_comments:!1,mute_colored_comments:!1,mute_consecutive_same_characters_comments:!1,fold_panel_after_sending_tweet:!1,reset_hashtag_when_program_switches:!0,auto_add_watching_channel_hashtag:!0,twitter_active_tab:"Capture",tweet_hashtag_position:"Append",tweet_capture_watermark_position:"None"};function J(){const t=localStorage.getItem("KonomiTV-Settings");return null!==t?JSON.parse(t):(Q(X),X)}function Q(t){localStorage.setItem("KonomiTV-Settings",JSON.stringify(t))}function tt(t){const e={};for(const s of Object.keys(X))e[s]=s in t?t[s]:X[s];return e}const et=(0,a.Q_)("settings",{state:()=>{const t=J(),e=tt(t);return Q(e),{settings:e}},actions:{async importClientSettings(t){const e=await t.text();let s={};try{s=JSON.parse(e)}catch(a){return!1}const i=tt(s);return Q(i),this.settings=i,await this.syncClientSettingsToServer(),!0},async resetClientSettings(){const t={...X,sync_settings:this.settings.sync_settings};Q(t),this.settings=t,await this.syncClientSettingsToServer()},getSyncableClientSettings(){const t={};for(const e of Y)e in this.settings?t[e]=this.settings[e]:t[e]=X[e];return t},async syncClientSettingsFromServer(t=!1){if(null===pt.getAccessToken()||!1===this.settings.sync_settings&&!1===t)return;const e=await q.fetchClientSettings();if(null!==e)for(const[s,i]of Object.entries(e))this.settings[s]=i},async syncClientSettingsToServer(t=!1){if(null===pt.getAccessToken()||!1===this.settings.sync_settings&&!1===t)return;const e=this.getSyncableClientSettings();await q.updateClientSettings(e)}}});var st=et;class it{static getCommentColor(t){return this.color_table[t]||null}static getCommentPosition(t){switch(t){case"ue":return"top";case"naka":return"right";case"shita":return"bottom";default:return null}}static getCommentSize(t){switch(t){case"big":case"medium":case"small":return t;default:return null}}static parseCommentCommand(t){let e="#FFEAEA",s="right",i="medium";if(void 0!==t&&null!==t){const a=t.replace("184","").split(" ");for(const t of a){const a=it.getCommentColor(t),n=it.getCommentPosition(t),r=it.getCommentSize(t);null!==a&&(e=a),null!==n&&(s=n),null!==r&&(i=r)}}return{color:e,position:s,size:i}}static isMutedComment(t,e,s,i,a){const n=st();if(n.settings.muted_niconico_user_ids.includes(e))return!0;if(it.special_command_comments_pattern.test(t))return!0;if(!0===n.settings.mute_fixed_comments&&("top"===i||"bottom"===i))return console.log("[CommentUtils] Muted comment (fixed_comments): "+t),!0;if(!0===n.settings.mute_colored_comments&&"#FFEAEA"!==s)return console.log("[CommentUtils] Muted comment (colored_comments): "+t),!0;if(!0===n.settings.mute_big_size_comments&&"big"===a)return console.log("[CommentUtils] Muted comment (big_size_comments): "+t),!0;if(!0===n.settings.mute_vulgar_comments&&it.mute_vulgar_comments_pattern.test(t))return console.log("[CommentUtils] Muted comment (vulgar_comments): "+t),!0;if(!0===n.settings.mute_abusive_discriminatory_prejudiced_comments&&it.mute_abusive_discriminatory_prejudiced_comments_pattern.test(t))return console.log("[CommentUtils] Muted comment (abusive_discriminatory_prejudiced_comments): "+t),!0;if(!0===n.settings.mute_consecutive_same_characters_comments&&it.mute_consecutive_same_characters_comments_pattern.test(t))return console.log("[CommentUtils] Muted comment (consecutive_same_characters_comments): "+t),!0;for(const r of n.settings.muted_comment_keywords)if(""!==r.pattern)switch(r.match){case"partial":if(t.includes(r.pattern))return console.log("[CommentUtils] Muted comment (partial): "+t),!0;break;case"forward":if(t.startsWith(r.pattern))return console.log("[CommentUtils] Muted comment (forward): "+t),!0;break;case"backward":if(t.endsWith(r.pattern))return console.log("[CommentUtils] Muted comment (backward): "+t),!0;break;case"exact":if(t===r.pattern)return console.log("[CommentUtils] Muted comment (exact): "+t),!0;break;case"regex":if(new RegExp(r.pattern).test(t))return console.log("[CommentUtils] Muted comment (regex): "+t),!0;break}return!!it.annoying_statistical_comments_pattern.test(t)}static addMutedKeywords(t){const e=st();for(const s of e.settings.muted_comment_keywords)if("exact"===s.match&&s.pattern===t)return;e.settings.muted_comment_keywords.push({match:"exact",pattern:t})}static addMutedNiconicoUserIDs(t){const e=st();e.settings.muted_niconico_user_ids.includes(t)||e.settings.muted_niconico_user_ids.push(t)}}it.mute_vulgar_comments_pattern=new RegExp(D.Buffer.from("XChpXCl8XChVXCl8cHJwcnzvvZDvvZLvvZDvvZJ8U0VYfFPjgIdYfFPil69YfFPil4tYfFPil49YfO+8s++8pe+8uHzvvLPjgIfvvLh877yz4pev77y4fO+8s+KXi++8uHzvvLPil4/vvLh844Ki44OA44Or44OIfOOCouODiuOCpXzjgqLjg4rjg6t844Kk44Kr6IetfOOCpOOBj3zjgYbjgpPjgZN844Km44Oz44KzfOOBhuOCk+OBoXzjgqbjg7Pjg4F844Ko44Kt44ObfOOBiOOBoeOBiOOBoXzjgYjjgaPjgaF844Ko44OD44OBfOOBiOOBo+OCjXzjgqjjg4Pjg61844GI44KNfOOCqOODrXzlt6Xlj6N844GK44GV44KP44KK44G+44KTfOOBiuOBl+OBo+OBk3zjgqrjgrfjg4PjgrN844Kq44OD44K144OzfOOBiuOBo+OBseOBhHzjgqrjg4Pjg5HjgqR844Kq44OK44OL44O8fOOBiuOBquOBu3zjgqrjg4rjg5t844GK44Gx44GEfOOCquODkeOCpHzjgYpwfOOBiu+9kHzjgqrjg5Xjg5HjgrN844Ks44Kk44K444OzfOOCreODs+OCv+ODnnzjgY/jgbHjgYJ844GP44Gx44GBfOOCr+ODquODiOODquOCuXzjgq/jg7Pjg4t844GU44GP44GU44GP44GU44GP44GU44GPfOOCs+ODs+ODieODvOODoHzjgZHjgaTjgYLjgap844Kx44OE44Ki44OKfOOCtuODvOODoeODs3zjgrfjgrN844GX44GT44GX44GTfOOCt+OCs+OCt+OCs3zjgZnjgZHjgZnjgZF844Gb44GE44GI44GNfOOBm+OBhOOCinzjgZvjg7zjgop844GZ44GF44GF44GF44GF44GFfOOBmeOBhuOBhuOBhuOBhuOBhnzjgrvjgq/jg63jgrl844K744OD44Kv44K5fOOCu+ODleODrHzjgaHjgaPjgbHjgYR844Gh44Gj44OR44KkfOODgeODg+ODkeOCpHzjgaHjgpPjgZN844Gh44CH44GTfOOBoeKXr+OBk3zjgaHil4vjgZN844Gh4peP44GTfOODgeODs+OCs3zjg4HjgIfjgrN844OB4pev44KzfOODgeKXi+OCs3zjg4Hil4/jgrN844Gh44KT44G9fOOBoeOAh+OBvXzjgaHil6/jgb1844Gh4peL44G9fOOBoeKXj+OBvXzjg4Hjg7Pjg51844OB44CH44OdfOODgeKXr+ODnXzjg4Hil4vjg51844OB4peP44OdfOOBoeOCk+OBoeOCk3zjg4Hjg7Pjg4Hjg7N844Gm44GD44KT44Gm44GD44KTfOODhuOCo+ODs+ODhuOCo+ODs3zjg4bjgqPjg7Pjg51844OH44Kr44GEfOODh+ODquODmOODq3zjgarjgYvjgaDjgZd844Gq44GL44CH44GXfOOBquOBi+KXr+OBl3zjgarjgYvil4vjgZd844Gq44GL4peP44GXfOiEseOBknzjg4zjgYR844OM44GLfOODjOOCq3zjg4zjgY1844OM44KtfOODjOOBj3zjg4zjgq9844OM44GRfOODjOOCsXzjg4zjgZN844OM44KzfOOBseOBhOOCguOBv3zjg5Hjg5HmtLt844G144GG44O7fOOBteOBhuKApnzjgbXjgYV8776M772pfOOBteOBj+OCieOBv3zjgbXjgY/jgonjgpPjgad844G644Gj44GffOOBuuOCjeOBuuOCjXzjg5rjg63jg5rjg618776N776f776b776N776f776bfOODleOCp+ODqXzjgbvjgYbjgZHjgYR844G844Gj44GNfOODneODq+ODjnzjgbzjgo3jgpN844Oc44Ot44OzfO++ju++nu++m+++nXzjgb3jgo3jgop844Od44Ot44OqfO++ju++n+++m+++mHzjg57jg7PjgY3jgaR844Oe44Oz44Kt44OEfOOBvuOCk+OBk3zjgb7jgIfjgZN844G+4pev44GTfOOBvuKXi+OBk3zjgb7il4/jgZN844Oe44Oz44KzfOODnuOAh+OCs3zjg57il6/jgrN844Oe4peL44KzfOODnuKXj+OCs3zjgb7jgpPjgZXjgpN844KC44Gj44GT44KKfOODouODg+OCs+ODqnzjgoLjgb/jgoLjgb9844Oi44Of44Oi44OffOODpOOBo+OBn3zjg6TjgaPjgaZ844Ok44KJfOOChOOCieOBm+OCjXzjg6Tjgop844Ok44KLfOODpOOCjHzjg6Tjgo1844Op44OW44ObfOODr+ODrOODoXzmhJvmtrJ85ZaYfOmZsOaguHzpmbDojI586Zmw5ZSHfOa3q+WkonzpmqDmr5t86Zmw5q+bfOeUo+OCgeOCi3zlpbPjga7lrZDjga7ml6V85rGa44Gj44GV44KTfOWnpnzpqI7kuZfkvY185beo5qC5fOW3qOODgeODs3zlt6jnj4186YeR546JfOaciOe1jHzlvozog4zkvY185a2Q56iufOWtkOS9nOOCinzlsITnsr585L+h6ICFfOeyvua2snzpgI/jgZF85oCn5LqkfOeyvuWtkHzmraPluLjkvY185oCn5b60fOaAp+eahHznlJ/nkIZ85a+45q2i44KBfOe0oOadkHzmirHjgYR85oqx44GLfOaKseOBjXzmirHjgY985oqx44GRfOaKseOBk3zkvZPmtrJ85Lmz6aaWfOaBpeWeonznj43mo5J85Lit44Gg44GXfOS4reWHuuOBl3zlsL985oqc44GEfOaKnOOBkeOBquOBhHzmipzjgZHjgot85oqc44GR44KMfOeKr+ePjXzohqjjgol85YyF6IyOfOWLg+i1t3zmkannvoV86a2U576FfOaPieOBvnzmj4njgb985o+J44KAfOaPieOCgXzmvKvmuZZ844CH772efOKXr++9nnzil4vvvZ584peP772efOOAh+ODg+OCr+OCuXzil6/jg4Pjgq/jgrl84peL44OD44Kv44K5fOKXj+ODg+OCr+OCuQ==","base64").toString()),it.mute_abusive_discriminatory_prejudiced_comments_pattern=new RegExp(D.Buffer.from("44CCfOOCouODi+ODl+ODrOOBj+OCk3zjgqLjg4vjg5fjg6zlkJt844Ki44K544OafOOCpOOCq+OCjHzjgYTjgb7jgYTjgaF844Kk44Oe44Kk44OBfOOCpOODqeOBpOOBj3zjgqbjgrh844Km44O844OofOOCpuODqHzjgqbjg6jjgq9844Km44OyfOOBjeOCguOBhHzjgq3jg6LjgqR844Kt44Oi44GEfOOCrS/jg6Av44OBfOOCrOOCpOOCuHzvvbbvvp7vvbLvvbzvvp5844Ks44KtfOOCq+OCuXzjgq3jg4Pjgrp844GN44Gh44GM44GEfOOCreODgeOCrOOCpHzjgq3jg6Djg4F844K344OKfOOCueODhuODnnzjgaTjgb7jgonjgap844Gk44G+44KJ44KTfOODgeODp+ODg+ODkeODqnzjg4Hjg6fjg7N85Y2D44On44OzfOOBpOOCk+OBvHzjg4Tjg7Pjg5x844ON44OI44Km44OofOOBq+OBoOOBguOBgnzjg4vjg4B85LqM44OAfO++hu++gO++nnzjg5Hjg7zjg6h844OR44OofOODkeODqOOCr3zjgbbjgaPjgZV844OW44OD44K1fOOBtuOBleOBhHzjg5bjgrXjgqR844G+44Gs44GRfOODoeOCr+ODqXzjg5Djgqt844Og44Kr44Gk44GPfOiNkuOCieOBl3zpurvnlJ/jgrvjg6Hjg7Pjg4h85oWw5a6J5ammfOWus+WFkHzlpJblrZd85aem5Zu9fOmfk+WbvXzpn5PkuK186Z+T5pelfOWfuuWcsOWklnzmsJfni4LjgYR85rCX6YGV44GEfOWIh+OBo+OBn3zliIfjgaPjgaZ85rCX5oyB44Gh5oKqfOWbveS6pOaWree1tnzmrrp86aCDfOmgg+OBl3zpoIPjgZl86aCD44GbfOWcqOaXpXzlj4LmlL/mqKl85q2744GtfOawj+OBrXzvvoDvvot85q255YyVfOatueODknzlpLHpgJ986Zqc5a6zfOaWreS6pHzkuK3pn5N85pyd6a6ufOW+tOeUqOW3pXzlo7p85aO3fOWjvHzml6Xpn5N85pel5bidfOeymOedgHzlj43ml6V86aas6bm/fOeZuueLgnznmbrpgZR85py0fOWjsuWbvXzkuI3lv6t85L215ZCIfOmWk+aKnOOBkXzmloflj6V86Z2W5Zu9","base64").toString()),it.mute_consecutive_same_characters_comments_pattern=/(.)\1{7,}/,it.special_command_comments_pattern=/\/[a-z]+ /,it.annoying_statistical_comments_pattern=/最高\d+米\/|計\d+ＩＤ|総\d+米/,it.color_table={white:"#FFEAEA",red:"#F02840",pink:"#FD7E80",orange:"#FDA708",yellow:"#FFE133",green:"#64DD17",cyan:"#00D4F5",blue:"#4763FF",purple:"#D500F9",black:"#1E1310",white2:"#CCCC99",niconicowhite:"#CCCC99",red2:"#CC0033",truered:"#CC0033",pink2:"#FF33CC",orange2:"#FF6600",passionorange:"#FF6600",yellow2:"#999900",madyellow:"#999900",green2:"#00CC66",elementalgreen:"#00CC66",cyan2:"#00CCCC",blue2:"#3399FF",marineblue:"#3399FF",purple2:"#6633CC",nobleviolet:"#6633CC",black2:"#666666"};class at{static generatePlayerBackgroundURL(){const t=50,e=Math.floor(Math.random()*t)+1;return`/assets/images/player-backgrounds/${e.toString().padStart(2,"0")}.jpg`}static isHEVCVideoSupported(){return"probably"===document.createElement("video").canPlayType('video/mp4; codecs="hvc1.1.6.L123.B0"')}static extractAPIQualityFromDPlayer(t){if(null===t.quality)return null;const e=/streams\/live\/[a-z0-9]*\/(.*)\/(mpegts|ll-hls)/,s=t.quality.url.match(e);return s?s[1]:null}}var nt=s(27484),rt=s.n(nt),ot=(s(76831),s(66607)),lt=s.n(ot),ct=s(79212),_t=s.n(ct),dt=s(37412),ut=s.n(dt);rt().extend(lt()),rt().extend(_t()),rt().extend(ut());class mt{static convertTimestampToISO8601(t){rt().locale("ja");const e=rt()(t).toISOString();return e}static decorateProgramInfo(t,e){if(null!==t&&null!==t[e]){const s=pt.escapeHTML(t[e]),i="新|終|再|交|映|手|声|多|副|字|文|CC|OP|二|S|B|SS|無|無料C|S1|S2|S3|MV|双|デ|D|N|W|P|H|HV|SD|天|解|料|前|後初|生|販|吹|PPV|演|移|他|収|・|英|韓|中|字/日|字/日英|3D|2K|4K|8K|5.1|7.1|22.2|60P|120P|d|HC|HDR|SHV|UHD|VOD|配|初",a=new RegExp("\\((二|字|再)\\)","g"),n=new RegExp(`\\[(${i})\\]`,"g");return s.replace(a,'<span class="decorate-symbol">$1</span>').replace(n,'<span class="decorate-symbol">$1</span>')}{const t=rt()(),s=rt()().hour(0).minute(0).second(0),i=rt()().hour(6).minute(59).second(59),a=rt()().hour(23).minute(0).second(0),n=rt()().hour(23).minute(59).second(59);return t.isSameOrAfter(s)&&t.isSameOrBefore(i)||t.isSameOrAfter(a)&&t.isSameOrBefore(n)?"title"===e?"放送休止":"この時間は放送を休止しています。":"title"===e?"番組情報がありません":"この時間の番組情報を取得できませんでした。"}}static getProgramProgress(t){if(null!==t){const e=rt()(rt()()).diff(t.start_time,"second");return e/t.duration*100}return 0}static getProgramTime(t,e=!1){if(null!==t&&"2000-01-01T00:00:00+09:00"!==t.start_time){rt().locale("ja");const s=rt()(t.start_time);if(t.duration<=0)return!0===e?`${s.format("HH:mm")} ～ --:--`:`${s.format("YYYY/MM/DD (dd) HH:mm")} ～ --:-- (放送時間未定)`;const i=rt()(t.end_time),a=t.duration/60;return!0===e?`${s.format("HH:mm")} ～ ${i.format("HH:mm")}`:`${s.format("YYYY/MM/DD (dd) HH:mm")} ～ ${i.format("HH:mm")} (${a}分)`}return!0===e?"--:-- ～ --:--":"----/--/-- (-) --:-- ～ --:-- (--分)"}static formatString(t){null===mt.format_string_translation_map&&(mt.format_string_translation_map=mt.getFormatStringTranslationTable());for(const e in mt.format_string_translation_map)t=t.replaceAll(e,mt.format_string_translation_map[e]);return t}static getFormatStringTranslationTable(){const t="０１２３４５６７８９ＡＢＣＤＥＦＧＨＩＪＫＬＭＮＯＰＱＲＳＴＵＶＷＸＹＺａｂｃｄｅｆｇｈｉｊｋｌｍｎｏｐｑｒｓｔｕｖｗｘｙｚ",e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",s={};for(let r=0;r<t.length;r++)s[t[r]]=e[r];const i="＂＃＄％＆＇（）＋，－．／：；＜＝＞［＼］＾＿｀｛｜｝　",a="\"#$%&'()+,-./:;<=>[\\]^_`{|} ";for(let r=0;r<i.length;r++)s[i[r]]=a[r];s["!"]="！",s["?"]="？",s["*"]="＊",s["~"]="～",s["@"]="＠",s["♯"]="#",s["〜"]="～";const n={"🅊":"[HV]","🄿":"[P]","🅌":"[SD]","🅆":"[W]","🅋":"[MV]","🈐":"[手]","🈑":"[字]","🈒":"[双]","🈓":"[デ]","🅂":"[S]","🈔":"[二]","🈕":"[多]","🈖":"[解]","🅍":"[SS]","🄱":"[B]","🄽":"[N]","🈗":"[天]","🈘":"[交]","🈙":"[映]","🈚":"[無]","🈛":"[料]","🈜":"[前]","🈝":"[後]","🈞":"[再]","🈟":"[新]","🈠":"[初]","🈡":"[終]","🈢":"[生]","🈣":"[販]","🈤":"[声]","🈥":"[吹]","🅎":"[PPV]","🈀":"[ほか]"};for(const r in n)s[r]=n[r];return s}}mt.format_string_translation_map=null;var pt=z,ht=s(73816),gt=s(5255),vt=s(27690),ft=s(83240),wt=s(31584),bt=s(49007),yt=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"route-container"},[e("Header"),e("main",[e("Navigation"),e("div",{staticClass:"login-container-wrapper d-flex align-center w-100 mb-13"},[e(ht.Z,{staticClass:"login-container px-10 pt-8 pb-11 mx-auto background lighten-1",attrs:{elevation:"10",width:"100%","max-width":"450"}},[e(gt.EB,{staticClass:"login__logo flex-column justify-center"},[e(wt.Z,{attrs:{"max-width":"250",src:"/assets/images/logo.svg"}}),e("h4",{staticClass:"mt-10"},[t._v("ログイン")])],1),e(vt.Z),e(ft.Z,{ref:"login",on:{submit:function(t){t.preventDefault()}}},[e(bt.Z,{staticClass:"mt-12",attrs:{outlined:"",placeholder:"ユーザー名","hide-details":"",autofocus:"",dense:t.is_form_dense},model:{value:t.username,callback:function(e){t.username=e},expression:"username"}}),e(bt.Z,{staticClass:"mt-8",attrs:{outlined:"",placeholder:"パスワード","hide-details":"",dense:t.is_form_dense,type:t.password_showing?"text":"password","append-icon":t.password_showing?"mdi-eye":"mdi-eye-off"},on:{"click:append":function(e){t.password_showing=!t.password_showing}},model:{value:t.password,callback:function(e){t.password=e},expression:"password"}}),e(I.Z,{staticClass:"login-button mt-5",attrs:{color:"secondary",depressed:"",width:"100%",height:"56"},on:{click:function(e){return t.login()}}},[e("Icon",{staticClass:"mr-2",attrs:{icon:"fa:sign-in"}}),t._v("ログイン ")],1)],1)],1)],1)],1)],1)},Ct=[],kt=s(95536),xt=s(60293),St=function(){var t=this,e=t._self._c;return e("header",{staticClass:"header"},[e("router-link",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],staticClass:"konomitv-logo ml-3 ml-md-6",attrs:{to:"/tv/"}},[e("img",{staticClass:"konomitv-logo__image",attrs:{src:"/assets/images/logo.svg",height:"21"}})]),e(kt.Z)],1)},Ot=[],Tt={},It=(0,p.Z)(Tt,St,Ot,!1,null,"84897154",null),jt=It.exports,Zt=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",[e("div",{staticClass:"navigation-container elevation-8"},[e("nav",{staticClass:"navigation"},[e("div",{staticClass:"navigation-scroll"},[e("router-link",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],staticClass:"navigation__link",attrs:{"active-class":"navigation__link--active",to:"/tv/"}},[e("Icon",{staticClass:"navigation__link-icon",attrs:{icon:"fluent:tv-20-regular",width:"26px"}}),e("span",{staticClass:"navigation__link-text"},[t._v("テレビをみる")])],1),e("router-link",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],staticClass:"navigation__link",attrs:{"active-class":"navigation__link--active",to:"/videos/"}},[e("Icon",{staticClass:"navigation__link-icon",attrs:{icon:"fluent:movies-and-tv-20-regular",width:"26px"}}),e("span",{staticClass:"navigation__link-text"},[t._v("ビデオをみる")])],1),e("router-link",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],staticClass:"navigation__link",attrs:{"active-class":"navigation__link--active",to:"/timetable/"}},[e("Icon",{staticClass:"navigation__link-icon",attrs:{icon:"fluent:calendar-ltr-20-regular",width:"26px"}}),e("span",{staticClass:"navigation__link-text"},[t._v("番組表")])],1),e("router-link",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],staticClass:"navigation__link",attrs:{"active-class":"navigation__link--active",to:"/reserves/"}},[e("Icon",{staticClass:"navigation__link-icon",staticStyle:{padding:"0.5px"},attrs:{icon:"fluent:timer-16-regular",width:"26px"}}),e("span",{staticClass:"navigation__link-text"},[t._v("録画予約")])],1),e("router-link",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],staticClass:"navigation__link",attrs:{"active-class":"navigation__link--active",to:"/mylist/"}},[e("Icon",{staticClass:"navigation__link-icon",attrs:{icon:"ic:round-playlist-play",width:"26px"}}),e("span",{staticClass:"navigation__link-text"},[t._v("マイリスト")])],1),e("router-link",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],staticClass:"navigation__link",attrs:{"active-class":"navigation__link--active",to:"/captures/"}},[e("Icon",{staticClass:"navigation__link-icon",attrs:{icon:"fluent:image-multiple-24-regular",width:"26px"}}),e("span",{staticClass:"navigation__link-text"},[t._v("キャプチャ")])],1),e(kt.Z),e("router-link",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],staticClass:"navigation__link",attrs:{"active-class":"navigation__link--active",to:"/settings/"}},[e("Icon",{staticClass:"navigation__link-icon",attrs:{icon:"fluent:settings-20-regular",width:"26px"}}),e("span",{staticClass:"navigation__link-text"},[t._v("設定")])],1),e("a",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"},{name:"tooltip",rawName:"v-tooltip.top",value:t.versionStore.is_update_available?`アップデートがあります (version ${t.versionStore.latest_version})`:"",expression:"versionStore.is_update_available ?\n                        `アップデートがあります (version ${versionStore.latest_version})` : ''",modifiers:{top:!0}}],staticClass:"navigation__link",class:{"navigation__link--version":t.versionStore.is_client_develop_version,"navigation__link--highlight":t.versionStore.is_update_available},attrs:{"active-class":"navigation__link--active",href:"https://github.com/tsukumijima/KonomiTV"}},[e("Icon",{staticClass:"navigation__link-icon",attrs:{icon:"fluent:info-16-regular",width:"26px"}}),e("span",{staticClass:"navigation__link-text"},[t._v("version "+t._s(t.versionStore.client_version))])],1)],1)])]),e("BottomNavigation")],1)},Bt=[],Pt=s(26146),$t=function(){var t=this,e=t._self._c;return e(Pt.Z,{staticClass:"bottom-navigation-container elevation-12",attrs:{color:"primary",grow:""}},[e(I.Z,{staticClass:"bottom-navigation-button",attrs:{to:"/tv/"}},[e("span",{staticClass:"mt-1"},[t._v("テレビをみる")]),e("Icon",{attrs:{icon:"fluent:tv-20-regular",width:"30px"}})],1),e(I.Z,{staticClass:"bottom-navigation-button",attrs:{to:"/videos/"}},[e("span",{staticClass:"mt-1"},[t._v("ビデオをみる")]),e("Icon",{attrs:{icon:"fluent:movies-and-tv-20-regular",width:"30px"}})],1),e(I.Z,{staticClass:"bottom-navigation-button",attrs:{to:"/settings/"}},[e("span",{staticClass:"mt-1"},[t._v("設定")]),e("Icon",{attrs:{icon:"fluent:settings-20-regular",width:"30px"}})],1)],1)},zt=[],At={},Dt=(0,p.Z)(At,$t,zt,!1,null,"3df53df3",null),Lt=Dt.exports;class Nt{static async fetchServerVersion(){const t=await G.get("/version");return"is_error"in t?(G.showGenericError(t,"バージョン情報を取得できませんでした。"),null):t.data}}var Et=Nt;const Kt=(0,a.Q_)("version",{state:()=>({server_version_info:null,last_updated_at:0}),getters:{client_version(){return pt.version},server_version(){return this.server_version_info?.version??null},latest_version(){return this.server_version_info?.latest_version??null},is_client_develop_version(){return this.client_version.includes("-dev")},is_server_develop_version(){return this.server_version?.includes("-dev")??!1},is_update_available(){return null!==this.server_version&&null!==this.latest_version&&(!1===this.is_server_develop_version&&this.server_version!==this.latest_version||!0===this.is_server_develop_version&&this.server_version.replace("-dev","")===this.latest_version)},is_version_mismatch(){return null!==this.server_version&&this.client_version!==this.server_version}},actions:{async fetchServerVersion(t=!1){if(null!==this.server_version_info&&!1===t)return pt.time()-this.last_updated_at>60&&this.fetchServerVersion(!0),this.server_version_info;const e=await Et.fetchServerVersion();return null===e?null:(this.server_version_info=e,this.last_updated_at=pt.time(),this.server_version_info)}}});var Mt=Kt,Ht=o["default"].extend({name:"Navigation",components:{BottomNavigation:Lt},computed:{...(0,a.Kc)(Mt)},async created(){await this.versionStore.fetchServerVersion()}}),Ft=Ht,Vt=(0,p.Z)(Ft,Zt,Bt,!1,null,"5b40940b",null),Rt=Vt.exports,Ut=o["default"].extend({name:"Login",components:{Header:jt,Navigation:Rt},data(){return{is_form_dense:pt.isSmartphoneHorizontal(),username:"",password:"",password_showing:!1}},computed:{...(0,a.Kc)(R)},async created(){await this.userStore.fetchUser(),this.userStore.is_logged_in&&await this.$router.replace({path:"/settings/account"})},methods:{async login(){if(""===this.username||""===this.password)return void this.$message.error("ユーザー名またはパスワードが空です。");const t=await this.userStore.login(this.username,this.password);!1!==t&&await this.$router.replace({path:"/settings/account"})}}}),Gt=Ut,Wt=(0,p.Z)(Gt,yt,Ct,!1,null,"851c3dec",null),qt=Wt.exports,Yt=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"route-container"},[e("Header"),e("main",[e("Navigation"),t._m(0)],1)],1)},Xt=[function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"d-flex justify-center align-center w-100"},[e("div",{staticClass:"d-flex justify-center align-center flex-column"},[e("h1",[t._v("Not Found, or Under Development...")]),e("span",{staticClass:"mt-4 text--text text--darken-1"},[t._v("お探しのページは存在しないか、鋭意開発中です。")])])])}],Jt=o["default"].extend({name:"NotFound",components:{Header:jt,Navigation:Rt}}),Qt=Jt,te=(0,p.Z)(Qt,Yt,Xt,!1,null,"1310cfee",null),ee=te.exports,se=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"route-container"},[e("Header"),e("main",[e("Navigation"),e("div",{staticClass:"register-container-wrapper d-flex align-center w-100 mb-13"},[e(ht.Z,{staticClass:"register-container px-10 pt-8 pb-11 mx-auto background lighten-1",attrs:{elevation:"10",width:"100%","max-width":"450"}},[e(gt.EB,{staticClass:"register__logo flex-column justify-center"},[e(wt.Z,{attrs:{"max-width":"250",src:"/assets/images/logo.svg"}}),e("h4",{staticClass:"mt-10"},[t._v("アカウントを作成")])],1),e(vt.Z),e(ft.Z,{ref:"register",on:{submit:function(t){t.preventDefault()}}},[e(bt.Z,{staticClass:"mt-12",attrs:{outlined:"",placeholder:"ユーザー名",autofocus:"",dense:t.is_form_dense,rules:[t.username_validation]},model:{value:t.username,callback:function(e){t.username=e},expression:"username"}}),e(bt.Z,{staticStyle:{"margin-top":"2px"},attrs:{outlined:"",placeholder:"パスワード",dense:t.is_form_dense,type:t.password_showing?"text":"password","append-icon":t.password_showing?"mdi-eye":"mdi-eye-off",rules:[t.password_validation]},on:{"click:append":function(e){t.password_showing=!t.password_showing}},model:{value:t.password,callback:function(e){t.password=e},expression:"password"}}),e(I.Z,{staticClass:"register-button mt-5",attrs:{color:"secondary",depressed:"",width:"100%",height:"56"},on:{click:function(e){return t.register()}}},[e("Icon",{staticClass:"mr-2",attrs:{icon:"fluent:person-add-20-filled",height:"24"}}),t._v("アカウントを作成 ")],1)],1)],1)],1)],1)],1)},ie=[],ae=o["default"].extend({name:"Register",components:{Header:jt,Navigation:Rt},data(){return{is_form_dense:pt.isSmartphoneHorizontal(),username:null,username_validation:t=>""===t||null===t?"ユーザー名を入力してください。":!1!==/^.{2,}$/.test(t)||"ユーザー名は2文字以上で入力してください。",password:null,password_showing:!0,password_validation:t=>""===t||null===t?"パスワードを入力してください。":!1!==/^[a-zA-Z0-9!-/:-@¥[-`{-~]{4,}$/.test(t)||"パスワードは4文字以上の半角英数記号を入力してください。"}},computed:{...(0,a.Kc)(R)},async created(){await this.userStore.fetchUser(),this.userStore.is_logged_in&&await this.$router.replace({path:"/settings/account"})},methods:{async register(){if(!1===this.$refs.register.validate())return;if(null===this.username||null===this.password)return;const t=await this.userStore.register(this.username,this.password);!1!==t&&await this.$router.replace({path:"/settings/account"})}}}),ne=ae,re=(0,p.Z)(ne,se,ie,!1,null,"6533f3d0",null),oe=re.exports,le=s(93749),ce=s(2780),_e=s(76827),de=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("SettingsBase",[e("h2",{staticClass:"settings__heading"},[e("router-link",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],staticClass:"settings__back-button",attrs:{to:"/settings/"}},[e("Icon",{attrs:{icon:"fluent:arrow-left-12-filled",width:"25px"}})],1),e("Icon",{attrs:{icon:"fluent:person-20-filled",width:"25px"}}),e("span",{staticClass:"ml-2"},[t._v("アカウント")])],1),e("div",{staticClass:"settings__content",class:{"settings__content--loading":t.is_loading}},[null===t.userStore.user?e("div",{staticClass:"account"},[e("div",{staticClass:"account-wrapper"},[e("img",{staticClass:"account__icon",attrs:{src:"/assets/images/account-icon-default.png"}}),e("div",{staticClass:"account__info"},[e("div",{staticClass:"account__info-name"},[e("span",{staticClass:"account__info-name-text"},[t._v("ログインしていません")])]),e("span",{staticClass:"account__info-id"},[t._v("Not logged in")])])]),e(I.Z,{staticClass:"account__login ml-auto",attrs:{color:"secondary",width:"140",height:"56",depressed:"",to:"/login/"}},[e("Icon",{staticClass:"mr-2",attrs:{icon:"fa:sign-in"}}),t._v("ログイン ")],1)],1):t._e(),null!==t.userStore.user?e("div",{staticClass:"account"},[e("div",{staticClass:"account-wrapper"},[e("img",{staticClass:"account__icon",attrs:{src:t.userStore.user_icon_url??""}}),e("div",{staticClass:"account__info"},[e("div",{staticClass:"account__info-name"},[e("span",{staticClass:"account__info-name-text"},[t._v(t._s(t.userStore.user.name))]),t.userStore.user.is_admin?e("span",{staticClass:"account__info-admin"},[t._v("管理者")]):t._e()]),e("span",{staticClass:"account__info-id"},[t._v("User ID: "+t._s(t.userStore.user.id))])])]),e(I.Z,{staticClass:"account__login ml-auto",attrs:{color:"secondary",width:"140",height:"56",depressed:""},on:{click:function(e){return t.userStore.logout()}}},[e("Icon",{staticClass:"mr-2",attrs:{icon:"fa:sign-out"}}),t._v("ログアウト ")],1)],1):t._e(),!1===t.userStore.is_logged_in?e("div",{staticClass:"account-register"},[e("div",{staticClass:"account-register__heading"},[t._v(" KonomiTV アカウントにログインすると、"),e("br"),t._v("より便利な機能が使えます！ ")]),e("div",{staticClass:"account-register__feature"},[e("div",{staticClass:"account-feature"},[e("Icon",{staticClass:"account-feature__icon",attrs:{icon:"bi:chat-left-text-fill"}}),e("div",{staticClass:"account-feature__info"},[e("span",{staticClass:"account-feature__info-heading"},[t._v("ニコニコ実況にコメントする")]),e("span",{staticClass:"account-feature__info-text"},[t._v("テレビを見ながらニコニコ実況にコメントできます。別途、ニコニコアカウントとの連携が必要です。")])])],1),e("div",{staticClass:"account-feature"},[e("Icon",{staticClass:"account-feature__icon",attrs:{icon:"fa-brands:twitter"}}),e("div",{staticClass:"account-feature__info"},[e("span",{staticClass:"account-feature__info-heading"},[t._v("Twitter 連携機能")]),e("span",{staticClass:"account-feature__info-text"},[t._v("テレビを見ながら Twitter にツイートしたり、検索したツイートをリアルタイムで表示できます。別途、Twitter アカウントとの連携が必要です。")])])],1),e("div",{staticClass:"account-feature"},[e("Icon",{staticClass:"account-feature__icon",attrs:{icon:"fluent:arrow-sync-20-filled"}}),e("div",{staticClass:"account-feature__info"},[e("span",{staticClass:"account-feature__info-heading"},[t._v("設定をデバイス間で同期")]),e("span",{staticClass:"account-feature__info-text"},[t._v("ピン留めしたチャンネルなど、ブラウザに保存されている各種設定をブラウザやデバイスをまたいで同期できます。")])])],1),e("div",{staticClass:"account-feature"},[e("Icon",{staticClass:"account-feature__icon",attrs:{icon:"fa-solid:sliders-h"}}),e("div",{staticClass:"account-feature__info"},[e("span",{staticClass:"account-feature__info-heading"},[t._v("サーバー設定をブラウザから変更")]),e("span",{staticClass:"account-feature__info-text"},[t._v("管理者権限があれば、サーバー設定をブラウザから変更できます。一番最初に作成されたアカウントには、自動で管理者権限が付与されます。")])])],1)]),e("div",{staticClass:"account-register__description"},[t._v(" KonomiTV アカウントの作成に必要なものは"),e("br",{staticClass:"smartphone-vertical-only"}),t._v("ユーザー名とパスワードだけです。"),e("br"),t._v(" アカウントはローカルに導入した"),e("br",{staticClass:"smartphone-vertical-only"}),t._v(" KonomiTV サーバーにのみ保存されます。"),e("br"),t._v(" 外部のサービスには保存されませんので、ご安心ください。"),e("br")]),e(I.Z,{staticClass:"account-register__button",attrs:{color:"secondary",width:"100%","max-width":"250",height:"50",depressed:"",to:"/register/"}},[e("Icon",{staticClass:"mr-2",attrs:{icon:"fluent:person-add-20-filled",height:"24"}}),t._v("アカウントを作成 ")],1)],1):t._e(),!0===t.userStore.is_logged_in?e("div",[e("div",{staticClass:"settings__item settings__item--switch"},[e("label",{staticClass:"settings__item-heading",attrs:{for:"sync_settings"}},[t._v("設定をデバイス間で同期する")]),e("label",{staticClass:"settings__item-label",attrs:{for:"sync_settings"}},[t._v(" KonomiTV では、設定を同じアカウントでログインしているデバイス間で同期できます！"),e("br"),t._v(" 同期をオンにすると、同期をオンにしているすべてのデバイスで共通の設定が使えます。ピン留めチャンネルやハッシュタグリストなども同期されます。"),e("br"),t._v(" なお、デバイス固有の設定（画質設定など）は、同期後も各デバイスで個別に反映されます。"),e("br")]),e(_e.Z,{staticClass:"settings__item-switch",attrs:{id:"sync_settings",inset:"","hide-details":""},model:{value:t.sync_settings,callback:function(e){t.sync_settings=e},expression:"sync_settings"}})],1),e(le.Z,{attrs:{"max-width":"530"},model:{value:t.sync_settings_dialog,callback:function(e){t.sync_settings_dialog=e},expression:"sync_settings_dialog"}},[e(ht.Z,[e(gt.EB,{staticClass:"justify-center"},[t._v("設定データの競合")]),e(gt.ZB,[t._v(" このデバイスの設定と、サーバーに保存されている設定が競合しています。"),e("br"),t._v(" 一度上書きすると、元に戻すことはできません。慎重に選択してください。"),e("br")]),e("div",{staticClass:"d-flex flex-column px-4 pb-4 settings__conflict-dialog"},[e(I.Z,{staticClass:"settings__save-button error--text text--lighten-1",attrs:{depressed:""},on:{click:function(e){return t.overrideServerSettingsFromClient()}}},[e("Icon",{staticClass:"mr-2",attrs:{icon:"fluent:document-arrow-up-16-filled",height:"22px"}}),t._v(" サーバーに保存されている設定を、"),e("br",{staticClass:"smartphone-vertical-only"}),t._v("このデバイスの設定で上書きする ")],1),e(I.Z,{staticClass:"settings__save-button error--text text--lighten-1 mt-3",attrs:{depressed:""},on:{click:function(e){return t.overrideClientSettingsFromServer()}}},[e("Icon",{staticClass:"mr-2",attrs:{icon:"fluent:document-arrow-down-16-filled",height:"22px"}}),t._v(" このデバイスの設定を、"),e("br",{staticClass:"smartphone-vertical-only"}),t._v("サーバーに保存されている設定で上書きする ")],1),e(I.Z,{staticClass:"settings__save-button mt-3",attrs:{depressed:""},on:{click:function(e){t.sync_settings_dialog=!1}}},[e("Icon",{staticClass:"mr-2",attrs:{icon:"fluent:dismiss-16-filled",height:"22px"}}),t._v(" キャンセル ")],1)],1)],1)],1),e(ft.Z,{ref:"settings_username",staticClass:"settings__item",on:{submit:function(t){t.preventDefault()}}},[e("div",{staticClass:"settings__item-heading"},[t._v("ユーザー名")]),e("div",{staticClass:"settings__item-label"},[t._v(" KonomiTV アカウントのユーザー名を設定します。アルファベットだけでなく日本語や記号も使えます。"),e("br"),t._v(" 同じ KonomiTV サーバー上の他のアカウントと同じユーザー名には変更できません。"),e("br")]),e(bt.Z,{staticClass:"settings__item-form",attrs:{outlined:"",placeholder:"ユーザー名",dense:t.is_form_dense,rules:[t.settings_username_validation]},model:{value:t.settings_username,callback:function(e){t.settings_username=e},expression:"settings_username"}})],1),e(I.Z,{staticClass:"settings__save-button",attrs:{depressed:""},on:{click:function(e){return t.updateAccountInfo("username")}}},[e("Icon",{staticClass:"mr-2",attrs:{icon:"fluent:save-16-filled",height:"24px"}}),t._v("ユーザー名を更新 ")],1),e(ft.Z,{staticClass:"settings__item",on:{submit:function(t){t.preventDefault()}}},[e("div",{staticClass:"settings__item-heading"},[t._v("アイコン画像")]),e("div",{staticClass:"settings__item-label"},[t._v(" KonomiTV アカウントのアイコン画像を設定します。"),e("br"),t._v(" アップロードされた画像は自動で 400×400 の正方形にリサイズされます。"),e("br")]),e(ce.Z,{staticClass:"settings__item-form",attrs:{outlined:"","hide-details":"",placeholder:"アイコン画像を選択",dense:t.is_form_dense,accept:"image/jpeg, image/png","prepend-icon":"","prepend-inner-icon":"mdi-paperclip"},model:{value:t.settings_icon,callback:function(e){t.settings_icon=e},expression:"settings_icon"}})],1),e(I.Z,{staticClass:"settings__save-button mt-5",attrs:{depressed:""},on:{click:function(e){return t.updateAccountIcon()}}},[e("Icon",{staticClass:"mr-2",attrs:{icon:"fluent:save-16-filled",height:"24px"}}),t._v("アイコン画像を更新 ")],1),e(ft.Z,{ref:"settings_password",staticClass:"settings__item",on:{submit:function(t){t.preventDefault()}}},[e("div",{staticClass:"settings__item-heading"},[t._v("新しいパスワード")]),e("div",{staticClass:"settings__item-label"},[t._v(" KonomiTV アカウントの新しいパスワードを設定します。"),e("br")]),e(bt.Z,{staticClass:"settings__item-form",attrs:{outlined:"",placeholder:"新しいパスワード",dense:t.is_form_dense,type:t.settings_password_showing?"text":"password","append-icon":t.settings_password_showing?"mdi-eye":"mdi-eye-off",rules:[t.settings_password_validation]},on:{"click:append":function(e){t.settings_password_showing=!t.settings_password_showing}},model:{value:t.settings_password,callback:function(e){t.settings_password=e},expression:"settings_password"}})],1),e(I.Z,{staticClass:"settings__save-button",attrs:{depressed:""},on:{click:function(e){return t.updateAccountInfo("password")}}},[e("Icon",{staticClass:"mr-2",attrs:{icon:"fluent:save-16-filled",height:"24px"}}),t._v("パスワードを更新 ")],1),e(vt.Z,{staticClass:"mt-6"}),e("div",{staticClass:"settings__item mt-6"},[e("div",{staticClass:"settings__item-heading error--text text--lighten-1"},[t._v("アカウントを削除")]),e("div",{staticClass:"settings__item-label"},[t._v(" 現在ログインしている KonomiTV アカウントを削除します。"),e("br"),e("b",[t._v("アカウントに紐づくすべてのデータが削除されます。")]),t._v("元に戻すことはできません。"),e("br")])]),e(le.Z,{attrs:{"max-width":"385"},scopedSlots:t._u([{key:"activator",fn:function({on:s}){return[e(I.Z,t._g({staticClass:"settings__save-button error mt-5",attrs:{depressed:""}},s),[e("Icon",{staticClass:"mr-2",attrs:{icon:"fluent:delete-16-filled",height:"24px"}}),t._v("アカウントを削除 ")],1)]}}],null,!1,1849668703),model:{value:t.account_delete_confirm_dialog,callback:function(e){t.account_delete_confirm_dialog=e},expression:"account_delete_confirm_dialog"}},[e(ht.Z,[e(gt.EB,{staticClass:"justify-center pt-6 font-weight-bold"},[t._v("本当にアカウントを削除しますか？")]),e(gt.ZB,{staticClass:"pt-2 pb-0"},[t._v(" アカウントに紐づくすべてのデータが削除されます。元に戻すことはできません。"),e("br"),t._v(" 本当にアカウントを削除しますか？ ")]),e(gt.h7,{staticClass:"pt-4 px-6 pb-5"},[e(kt.Z),e(I.Z,{attrs:{color:"text",text:""},on:{click:function(e){t.account_delete_confirm_dialog=!1}}},[t._v("キャンセル")]),e(I.Z,{attrs:{color:"error"},on:{click:function(e){return t.deleteAccount()}}},[t._v("削除")])],1)],1)],1)],1):t._e()])])},ue=[],me=s(37970),pe=s(81667),he=s(51419),ge=s(33560),ve=s(17316),fe=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"route-container"},[e("Header"),e("main",[e("Navigation"),e(ht.Z,{staticClass:"settings-container d-flex px-5 py-5 mx-auto background",attrs:{elevation:"0",width:"100%","max-width":"1000"}},[e("div",[e(ve.Z,{staticClass:"settings-navigation flex-shrink-0 background",attrs:{permanent:"",width:"195",height:"auto"}},[e(pe.Z,{staticClass:"px-4"},[e(he.km,[e("h1",[t._v("設定")])])],1),e(me.Z,{staticClass:"mt-3 px-0 py-0",attrs:{nav:""}},[e(pe.Z,{staticClass:"px-4 mb-1",attrs:{link:"",color:"primary",to:"/settings/general"}},[e(ge.Z,{staticClass:"mr-4"},[e("Icon",{staticStyle:{padding:"0 3px"},attrs:{icon:"fa-solid:sliders-h",width:"26px"}})],1),e(he.km,[e(he.V9,[t._v("全般")])],1)],1),e(pe.Z,{staticClass:"px-4 mb-1",attrs:{link:"",color:"primary",to:"/settings/caption"}},[e(ge.Z,{staticClass:"mr-4"},[e("Icon",{attrs:{icon:"fluent:subtitles-16-filled",width:"26px"}})],1),e(he.km,[e(he.V9,[t._v("字幕")])],1)],1),e(pe.Z,{staticClass:"px-4 mb-1",attrs:{link:"",color:"primary",to:"/settings/data-broadcasting"}},[e(ge.Z,{staticClass:"mr-4"},[e("svg",{attrs:{width:"26px",height:"26px",viewBox:"0 0 512 512"}},[e("path",{attrs:{fill:"currentColor",d:"M248.039 381.326L355.039 67.8258C367.539 28.3257 395.039 34.3258 406.539 34.3258C431.039 34.3258 453.376 61.3258 441.039 96.8258C362.639 322.426 343.539 375.326 340.539 384.826C338.486 391.326 342.039 391.326 345.539 391.326C377.039 391.326 386.539 418.326 386.539 435.326C386.539 458.826 371.539 477.326 350.039 477.326H214.539C179.039 477.326 85.8269 431.3 88.0387 335.826C91.0387 206.326 192.039 183.326 243.539 183.326H296.539L265.539 272.326H243.539C185.539 272.326 174.113 314.826 176.039 334.326C180.039 374.826 215.039 389.814 237.039 390.326C244.539 390.5 246.039 386.826 248.039 381.326Z"}})])]),e(he.km,[e(he.V9,[t._v("データ放送")])],1)],1),e(pe.Z,{staticClass:"px-4 mb-1",attrs:{link:"",color:"primary",to:"/settings/capture"}},[e(ge.Z,{staticClass:"mr-4"},[e("Icon",{attrs:{icon:"fluent:image-multiple-16-filled",width:"26px"}})],1),e(he.km,[e(he.V9,[t._v("キャプチャ")])],1)],1),e(pe.Z,{staticClass:"px-4 mb-1",attrs:{link:"",color:"primary",to:"/settings/account"}},[e(ge.Z,{staticClass:"mr-4"},[e("Icon",{attrs:{icon:"fluent:person-20-filled",width:"26px"}})],1),e(he.km,[e(he.V9,[t._v("アカウント")])],1)],1),e(pe.Z,{staticClass:"px-4 mb-1",attrs:{link:"",color:"primary",to:"/settings/jikkyo"}},[e(ge.Z,{staticClass:"mr-4"},[e("Icon",{staticStyle:{padding:"0 2px"},attrs:{icon:"bi:chat-left-text-fill",width:"26px"}})],1),e(he.km,[e(he.V9,[t._v("ニコニコ実況")])],1)],1),e(pe.Z,{staticClass:"px-4 mb-1",attrs:{link:"",color:"primary",to:"/settings/twitter"}},[e(ge.Z,{staticClass:"mr-4"},[e("Icon",{staticStyle:{padding:"0 1px"},attrs:{icon:"fa-brands:twitter",width:"26px"}})],1),e(he.km,[e(he.V9,[t._v("Twitter")])],1)],1),e(pe.Z,{staticClass:"px-4 mb-1",attrs:{link:"",color:"primary",to:"/settings/server"}},[e(ge.Z,{staticClass:"mr-4"},[e("Icon",{attrs:{icon:"fluent:server-surface-16-filled",width:"26px"}})],1),e(he.km,[e(he.V9,[t._v("サーバー設定")])],1)],1)],1)],1)],1),e(ht.Z,{staticClass:"settings ml-5 px-7 py-7 lighten-1",attrs:{width:"100%"}},[t._t("default")],2)],1)],1)],1)},we=[],be=o["default"].extend({name:"Settings-Base",components:{Header:jt,Navigation:Rt}}),ye=be,Ce=(0,p.Z)(ye,fe,we,!1,null,"7802007e",null),ke=Ce.exports,xe=o["default"].extend({name:"Settings-Account",components:{SettingsBase:ke},data(){return{is_form_dense:pt.isSmartphoneHorizontal(),is_loading:!0,settings_username:null,settings_username_validation:t=>""===t||null===t?"ユーザー名を入力してください。":!1!==/^.{2,}$/.test(t)||"ユーザー名は2文字以上で入力してください。",settings_password:null,settings_password_showing:!1,settings_password_validation:t=>""===t||null===t?"パスワードを入力してください。":!1!==/^[a-zA-Z0-9!-/:-@¥[-`{-~]{4,}$/.test(t)||"パスワードは4文字以上の半角英数記号を入力してください。",settings_icon:null,account_delete_confirm_dialog:!1,sync_settings:st().settings.sync_settings,sync_settings_dialog:!1}},computed:{...(0,a.Kc)(st,R)},async created(){await this.userStore.fetchUser(),this.is_loading=!1},watch:{async sync_settings(){if(!0===this.sync_settings&&!1===this.sync_settings_dialog){const t=this.settingsStore.getSyncableClientSettings(),e=JSON.stringify(t),s=await q.fetchClientSettings();if(null===s)return void this.$message.error("サーバーから設定データを取得できませんでした。");const i=JSON.stringify(s);e!==i?(this.sync_settings_dialog=!0,this.sync_settings=!1):this.settingsStore.settings.sync_settings=!0}else!1===this.sync_settings&&!1===this.sync_settings_dialog&&(this.settingsStore.settings.sync_settings=!1)}},methods:{async overrideServerSettingsFromClient(){await this.settingsStore.syncClientSettingsToServer(!0),this.settingsStore.settings.sync_settings=!0,this.sync_settings=!0,this.sync_settings_dialog=!1},async overrideClientSettingsFromServer(){await this.settingsStore.syncClientSettingsFromServer(!0),this.settingsStore.settings.sync_settings=!0,this.sync_settings=!0,this.sync_settings_dialog=!1},async updateAccountInfo(t){if("username"===t){if(!1===this.$refs.settings_username.validate())return}else if(!1===this.$refs.settings_password.validate())return;if("username"===t){if(null===this.settings_username)return;await this.userStore.updateUser({username:this.settings_username})}else{if(null===this.settings_password)return;await this.userStore.updateUser({password:this.settings_password})}},async updateAccountIcon(){null!==this.settings_icon?await this.userStore.updateUserIcon(this.settings_icon):this.$message.error("アップロードする画像を選択してください！")},async deleteAccount(){this.account_delete_confirm_dialog=!1,await this.userStore.deleteUser()}}}),Se=xe,Oe=(0,p.Z)(Se,de,ue,!1,null,"3ec6610e",null),Te=Oe.exports,Ie=s(17303),je=s(61013),Ze=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("SettingsBase",[e("h2",{staticClass:"settings__heading"},[e("router-link",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],staticClass:"settings__back-button",attrs:{to:"/settings/"}},[e("Icon",{attrs:{icon:"fluent:arrow-left-12-filled",width:"25px"}})],1),e("Icon",{attrs:{icon:"fluent:subtitles-16-filled",width:"25px"}}),e("span",{staticClass:"ml-3"},[t._v("字幕")])],1),e("div",{staticClass:"settings__content"},[e("div",{staticClass:"settings__item"},[e("label",{staticClass:"settings__item-heading"},[t._v("字幕のフォント")]),e("label",{staticClass:"settings__item-label"},[t._v(" プレイヤーで字幕表示をオンにしているときの、字幕のフォントを設定します。"),e("br")]),e(Ie.Z,{staticClass:"settings__item-form",attrs:{outlined:"","hide-details":"",dense:t.is_form_dense,items:t.caption_font},model:{value:t.settingsStore.settings.caption_font,callback:function(e){t.$set(t.settingsStore.settings,"caption_font",e)},expression:"settingsStore.settings.caption_font"}})],1),e("div",{staticClass:"settings__item settings__item--switch"},[e("label",{staticClass:"settings__item-heading",attrs:{for:"always_border_caption_text"}},[t._v("字幕の文字を常に縁取りする")]),e("label",{staticClass:"settings__item-label",attrs:{for:"always_border_caption_text"}},[t._v(" 字幕表示時、縁取りをオンにすると、字幕が見やすくきれいになります。とくに理由がなければ、オンにしておくのがおすすめです。"),e("br"),t._v(" この設定がオフのときも、字幕データ側で縁取りが指定されていれば、オンのときと同様に縁取り付きで描画されます。"),e("br")]),e(_e.Z,{staticClass:"settings__item-switch",attrs:{id:"always_border_caption_text",inset:"","hide-details":""},model:{value:t.settingsStore.settings.always_border_caption_text,callback:function(e){t.$set(t.settingsStore.settings,"always_border_caption_text",e)},expression:"settingsStore.settings.always_border_caption_text"}})],1),e("div",{staticClass:"settings__item settings__item--switch"},[e("label",{staticClass:"settings__item-heading",attrs:{for:"specify_caption_opacity"}},[t._v("字幕の不透明度を指定する")]),e("label",{staticClass:"settings__item-label",attrs:{for:"specify_caption_opacity"}},[t._v(" 字幕表示時、不透明度を自分で指定するか設定できます。"),e("br"),t._v(" この設定がオフのときは、字幕データ側で指定されている不透明度で描画します。とくに理由がなければ、オフにしておくのがおすすめです。"),e("br")]),e(_e.Z,{staticClass:"settings__item-switch",attrs:{id:"specify_caption_opacity",inset:"","hide-details":""},model:{value:t.settingsStore.settings.specify_caption_opacity,callback:function(e){t.$set(t.settingsStore.settings,"specify_caption_opacity",e)},expression:"settingsStore.settings.specify_caption_opacity"}})],1),e("div",{staticClass:"settings__item",class:{"settings__item--disabled":!1===t.settingsStore.settings.specify_caption_opacity}},[e("label",{staticClass:"settings__item-heading"},[t._v("字幕の不透明度")]),e("label",{staticClass:"settings__item-label"},[t._v(" 上の [字幕の不透明度を指定する] をオンに設定したときのみ有効です。不透明度を 0 に設定すれば、字幕の背景を非表示にできます。"),e("br")]),e("div",{ref:"caption_opacity",staticClass:"settings__item-label"},[e(je.Z,{staticClass:"settings__item-form",attrs:{ticks:"always","thumb-label":"","hide-details":"",min:0,max:1,step:.05,disabled:!1===t.settingsStore.settings.specify_caption_opacity},model:{value:t.settingsStore.settings.caption_opacity,callback:function(e){t.$set(t.settingsStore.settings,"caption_opacity",e)},expression:"settingsStore.settings.caption_opacity"}})],1)]),e(vt.Z,{staticClass:"mt-6"}),e("div",{staticClass:"settings__item settings__item--switch"},[e("label",{staticClass:"settings__item-heading",attrs:{for:"tv_show_superimpose"}},[t._v("テレビをみるときに文字スーパーを表示する")]),e("label",{staticClass:"settings__item-label",attrs:{for:"tv_show_superimpose"}},[t._v(" 文字スーパーは、緊急地震速報の赤テロップや、NHK BS のニュース速報のテロップなどで利用されています。とくに理由がなければ、オンにしておくのがおすすめです。"),e("br")]),e(_e.Z,{staticClass:"settings__item-switch",attrs:{id:"tv_show_superimpose",inset:"","hide-details":""},model:{value:t.settingsStore.settings.tv_show_superimpose,callback:function(e){t.$set(t.settingsStore.settings,"tv_show_superimpose",e)},expression:"settingsStore.settings.tv_show_superimpose"}})],1)],1)])},Be=[],Pe=o["default"].extend({name:"Settings-Caption",components:{SettingsBase:ke},data(){return{is_form_dense:pt.isSmartphoneHorizontal(),caption_font:[{text:"Windows TV ゴシック",value:"Windows TV Gothic"},{text:"Windows TV 丸ゴシック",value:"Windows TV MaruGothic"},{text:"Windows TV 太丸ゴシック",value:"Windows TV FutoMaruGothic"},{text:"ヒラギノTV丸ゴ",value:"Hiragino TV Sans Rd S"},{text:"新丸ゴ ARIB",value:"TT-ShinMGo-regular"},{text:"Rounded M+ 1m for ARIB",value:"Rounded M+ 1m for ARIB"},{text:"Noto Sans JP",value:"Noto Sans JP Caption"},{text:"デフォルトのフォント",value:"sans-serif"}]}},computed:{...(0,a.Kc)(st)}}),$e=Pe,ze=(0,p.Z)($e,Ze,Be,!1,null,null,null),Ae=ze.exports,De=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("SettingsBase",[e("h2",{staticClass:"settings__heading"},[e("router-link",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],staticClass:"settings__back-button",attrs:{to:"/settings/"}},[e("Icon",{attrs:{icon:"fluent:arrow-left-12-filled",width:"25px"}})],1),e("Icon",{attrs:{icon:"fluent:image-multiple-16-filled",width:"26px"}}),e("span",{staticClass:"ml-2"},[t._v("キャプチャ")])],1),e("div",{staticClass:"settings__content"},[e("div",{staticClass:"settings__item settings__item--switch settings__item--sync-disabled"},[e("label",{staticClass:"settings__item-heading",attrs:{for:"capture_copy_to_clipboard"}},[t._v("キャプチャをクリップボードにコピーする")]),e("label",{staticClass:"settings__item-label",attrs:{for:"capture_copy_to_clipboard"}},[t._v(" この設定をオンにすると、撮ったキャプチャ画像がクリップボードにもコピーされます。"),e("br"),t._v(" クリップボードの履歴をサポートしていない OS では、この設定をオンにしてキャプチャを撮ると、以前のクリップボードが上書きされます。注意してください。"),e("br")]),e(_e.Z,{staticClass:"settings__item-switch",attrs:{id:"capture_copy_to_clipboard",inset:"","hide-details":""},model:{value:t.settingsStore.settings.capture_copy_to_clipboard,callback:function(e){t.$set(t.settingsStore.settings,"capture_copy_to_clipboard",e)},expression:"settingsStore.settings.capture_copy_to_clipboard"}})],1),e("div",{staticClass:"settings__item"},[e("div",{staticClass:"settings__item-heading"},[t._v("キャプチャの保存先")]),e("div",{staticClass:"settings__item-label"},[e("p",[t._v(" キャプチャした画像をブラウザでダウンロードするか、KonomiTV サーバーにアップロードするかを設定します。"),e("br"),t._v(" ブラウザでのダウンロードと、KonomiTV サーバーへのアップロードを両方同時に行うこともできます。"),e("br")]),e("p",[t._v(" ブラウザでダウンロードすると、視聴中のデバイスのダウンロードフォルダに保存されます。"),e("br"),t._v(" 視聴中のデバイスにそのまま保存されるためシンプルですが、保存先のフォルダを変更できないこと、PC 版 Chrome では毎回ダウンロードバーが表示されてしまったり、iOS Safari (PWA モード) ではダウンロードするとファイル概要画面が表示され再生が中断してしまったりなど、視聴に支障することがデメリットです (将来的には、iOS / Android アプリ版や拡張機能などで解消される予定) 。"),e("br")]),e("p",[t._v(" KonomiTV サーバーにアップロードすると、サーバー設定で指定されたキャプチャ保存フォルダに保存されます。視聴したデバイスにかかわらず、今までに撮ったキャプチャをひとつのフォルダにまとめて保存できます。"),e("br"),t._v(" 他のデバイスでキャプチャを見るにはキャプチャ保存フォルダをネットワークに共有する必要があること、スマホ・タブレットではネットワーク上のフォルダへのアクセスがやや面倒なことがデメリットです。(将来的には、保存フォルダ内のキャプチャを Google フォトのように表示する機能を追加予定)"),e("br")])]),e(Ie.Z,{staticClass:"settings__item-form",attrs:{outlined:"","hide-details":"",dense:t.is_form_dense,items:t.capture_save_mode},model:{value:t.settingsStore.settings.capture_save_mode,callback:function(e){t.$set(t.settingsStore.settings,"capture_save_mode",e)},expression:"settingsStore.settings.capture_save_mode"}})],1),e("div",{staticClass:"settings__item"},[e("div",{staticClass:"settings__item-heading"},[t._v("字幕表示時のキャプチャの保存モード")]),e("div",{staticClass:"settings__item-label"},[t._v(" 字幕表示時、キャプチャした画像に字幕を合成するかを設定します。"),e("br"),t._v(" 映像のみのキャプチャと、字幕を合成したキャプチャを両方同時に保存することもできます。"),e("br"),t._v(" なお、字幕非表示時は、常に映像のみ (+コメント付きキャプチャではコメントを合成して) 保存されます。"),e("br")]),e(Ie.Z,{staticClass:"settings__item-form",attrs:{outlined:"","hide-details":"",dense:t.is_form_dense,items:t.capture_caption_mode},model:{value:t.settingsStore.settings.capture_caption_mode,callback:function(e){t.$set(t.settingsStore.settings,"capture_caption_mode",e)},expression:"settingsStore.settings.capture_caption_mode"}})],1)])])},Le=[],Ne=o["default"].extend({name:"Settings-Capture",components:{SettingsBase:ke},data(){return{is_form_dense:pt.isSmartphoneHorizontal(),capture_save_mode:[{text:"ブラウザでダウンロード",value:"Browser"},{text:"KonomiTV サーバーにアップロード",value:"UploadServer"},{text:"ブラウザでのダウンロードと、KonomiTV サーバーへのアップロードを両方行う",value:"Both"}],capture_caption_mode:[{text:"映像のみのキャプチャを保存する",value:"VideoOnly"},{text:"字幕を合成したキャプチャを保存する",value:"CompositingCaption"},{text:"映像のみのキャプチャと、字幕を合成したキャプチャを両方保存する",value:"Both"}]}},computed:{...(0,a.Kc)(st)}}),Ee=Ne,Ke=(0,p.Z)(Ee,De,Le,!1,null,null,null),Me=Ke.exports,He=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("SettingsBase",[e("h2",{staticClass:"settings__heading"},[e("router-link",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],staticClass:"settings__back-button",attrs:{to:"/settings/"}},[e("Icon",{attrs:{icon:"fluent:arrow-left-12-filled",width:"25px"}})],1),e("svg",{attrs:{width:"27px",height:"27px",viewBox:"0 0 512 512"}},[e("path",{attrs:{fill:"currentColor",d:"M248.039 381.326L355.039 67.8258C367.539 28.3257 395.039 34.3258 406.539 34.3258C431.039 34.3258 453.376 61.3258 441.039 96.8258C362.639 322.426 343.539 375.326 340.539 384.826C338.486 391.326 342.039 391.326 345.539 391.326C377.039 391.326 386.539 418.326 386.539 435.326C386.539 458.826 371.539 477.326 350.039 477.326H214.539C179.039 477.326 85.8269 431.3 88.0387 335.826C91.0387 206.326 192.039 183.326 243.539 183.326H296.539L265.539 272.326H243.539C185.539 272.326 174.113 314.826 176.039 334.326C180.039 374.826 215.039 389.814 237.039 390.326C244.539 390.5 246.039 386.826 248.039 381.326Z"}})]),e("span",{staticClass:"ml-2"},[t._v("データ放送")])],1),e("div",{staticClass:"settings__content"},[e("div",{staticClass:"settings__item settings__item--switch settings__item--sync-disabled"},[e("label",{staticClass:"settings__item-heading",attrs:{for:"tv_show_data_broadcasting"}},[t._v("テレビをみるときにデータ放送を表示する")]),e("label",{staticClass:"settings__item-label",attrs:{for:"tv_show_data_broadcasting"}},[t._v(" この設定をオンにすると、テレビをみるときにデータ放送機能を利用できます。"),e("br"),t._v(" データ放送そのもののオン/オフは、視聴画面右側のパネルからリモコンを表示した上で、リモコンの d ボタンから切り替えられます。"),e("br")]),e("label",{staticClass:"settings__item-label",attrs:{for:"tv_show_data_broadcasting"}},[t._v(" データ放送機能をオンにすると、負荷が高くなり視聴に支障が出ることがあります。データ放送を利用しない場合や、性能の低い Android デバイスではオフにすることをおすすめします。"),e("br")]),e(_e.Z,{staticClass:"settings__item-switch",attrs:{id:"tv_show_data_broadcasting",inset:"","hide-details":""},model:{value:t.settingsStore.settings.tv_show_data_broadcasting,callback:function(e){t.$set(t.settingsStore.settings,"tv_show_data_broadcasting",e)},expression:"settingsStore.settings.tv_show_data_broadcasting"}})],1),e(vt.Z,{staticClass:"mt-6"}),e(ft.Z,{ref:"data_broadcasting_zip_code",staticClass:"settings__item settings__item--sync-disabled",on:{submit:function(t){t.preventDefault()}}},[e("label",{staticClass:"settings__item-heading"},[t._v("お住まいの郵便番号")]),e("label",{staticClass:"settings__item-label"},[t._v(" ここで設定した郵便番号をもとに、データ放送の地域情報（ニュース・天気予報など）が表示されます。"),e("br"),t._v(" 設定しない場合、データ放送の一部のコンテンツが利用できないことがあります。"),e("br")]),e(bt.Z,{staticClass:"settings__item-form",attrs:{outlined:"",placeholder:"郵便番号",dense:t.is_form_dense,rules:[t.data_broadcasting_zip_code_validation]},model:{value:t.data_broadcasting_zip_code,callback:function(e){t.data_broadcasting_zip_code=e},expression:"data_broadcasting_zip_code"}})],1),e("div",{staticClass:"settings__item settings__item--sync-disabled mt-0"},[e("label",{staticClass:"settings__item-heading"},[t._v("お住まいの都道府県")]),e("label",{staticClass:"settings__item-label"},[t._v(" ここで設定した都道府県をもとに、データ放送の地域情報（ニュース・天気予報など）が表示されます。"),e("br"),t._v(" 設定しない場合、データ放送の一部のコンテンツが利用できないことがあります。"),e("br")]),e(Ie.Z,{staticClass:"settings__item-form",attrs:{outlined:"","hide-details":"",dense:t.is_form_dense,items:t.data_broadcasting_prefectures},model:{value:t.data_broadcasting_prefecture,callback:function(e){t.data_broadcasting_prefecture=e},expression:"data_broadcasting_prefecture"}})],1),e("div",{staticClass:"settings__item"},[e("div",{staticClass:"settings__item-heading error--text text--lighten-1"},[t._v("データ放送の保存データをリセット")]),e("div",{staticClass:"settings__item-label"},[t._v(" このデバイス（ブラウザ）に保存されているデータ放送の保存データを、初期状態にリセット (消去) できます。"),e("br"),t._v(" 保存データには、データ放送内のミニゲームの得点データや、設定データなどが含まれます。"),e("br"),t._v(" 保存データをリセットすると、元に戻すことはできません。十分ご注意ください。"),e("br")])]),e(I.Z,{staticClass:"settings__save-button error mt-5",attrs:{depressed:""},on:{click:function(e){return t.resetNVRAMSettings()}}},[e("Icon",{staticClass:"mr-2",attrs:{icon:"material-symbols:device-reset-rounded",height:"23px"}}),t._v("保存データをリセット ")],1)],1)])},Fe=[];s(82801);const Ve="KonomiTV-BMLBrowser_nvram_prefix=receiverinfo%2F";var Re=o["default"].extend({name:"Settings-DataBroadcasting",components:{SettingsBase:ke},data(){return{is_form_dense:pt.isSmartphoneHorizontal(),data_broadcasting_zip_code:"",data_broadcasting_zip_code_validation:t=>""===t||(null!==t.match(/^[0-9]{3}-[0-9]{4}$/)||"郵便番号は「000-0000」の形式で入力してください。"),data_broadcasting_prefecture:"255-0b0",data_broadcasting_prefectures:[{text:"未設定",value:"255-0b0"},{text:"西北海道",value:"2-0b000101101011"},{text:"東北海道",value:"1-0b000101101011"},{text:"青森県",value:"3-0b010001100111"},{text:"岩手県",value:"4-0b010111010100"},{text:"宮城県",value:"5-0b011101011000"},{text:"秋田県",value:"6-0b101011000110"},{text:"山形県",value:"7-0b111001001100"},{text:"福島県",value:"8-0b000110101110"},{text:"茨城県",value:"9-0b110001101001"},{text:"栃木県",value:"10-0b111000111000"},{text:"群馬県",value:"11-0b100110001011"},{text:"埼玉県",value:"12-0b011001001011"},{text:"千葉県",value:"13-0b000111000111"},{text:"東京都 (島部を除く)",value:"14-0b101010101100"},{text:"東京都島部 (伊豆・小笠原諸島)",value:"49-0b101010101100"},{text:"神奈川県",value:"15-0b010101101100"},{text:"新潟県",value:"16-0b010011001110"},{text:"富山県",value:"17-0b010100111001"},{text:"石川県",value:"18-0b011010100110"},{text:"福井県",value:"19-0b100100101101"},{text:"山梨県",value:"20-0b110101001010"},{text:"長野県",value:"21-0b100111010010"},{text:"岐阜県",value:"22-0b101001100101"},{text:"静岡県",value:"23-0b101001011010"},{text:"愛知県",value:"24-0b100101100110"},{text:"三重県",value:"25-0b001011011100"},{text:"滋賀県",value:"26-0b110011100100"},{text:"京都府",value:"27-0b010110011010"},{text:"大阪府",value:"28-0b110010110010"},{text:"兵庫県",value:"29-0b011001110100"},{text:"奈良県",value:"30-0b101010010011"},{text:"和歌山県",value:"31-0b001110010110"},{text:"鳥取県",value:"32-0b110100100011"},{text:"島根県",value:"33-0b001100011011"},{text:"岡山県",value:"34-0b001010110101"},{text:"広島県",value:"35-0b101100110001"},{text:"山口県",value:"36-0b101110011000"},{text:"徳島県",value:"37-0b111001100010"},{text:"香川県",value:"38-0b100110110100"},{text:"愛媛県",value:"39-0b000110011101"},{text:"高知県",value:"40-0b001011100011"},{text:"福岡県",value:"41-0b011000101101"},{text:"佐賀県",value:"42-0b100101011001"},{text:"長崎県",value:"43-0b101000101011"},{text:"熊本県",value:"44-0b100010100111"},{text:"大分県",value:"45-0b110010001101"},{text:"宮崎県",value:"46-0b110100011100"},{text:"鹿児島県 (南西諸島を除く)",value:"47-0b110101000101"},{text:"鹿児島県島部 (南西諸島の鹿児島県域)",value:"50-0b110101000101"},{text:"沖縄県",value:"48-0b001101110010"}]}},computed:{...(0,a.Kc)(st)},created(){const t=localStorage.getItem(`${Ve}zipcode`);if(t)try{this.data_broadcasting_zip_code=window.atob(t),this.data_broadcasting_zip_code=this.data_broadcasting_zip_code.slice(0,3)+"-"+this.data_broadcasting_zip_code.slice(3)}catch(s){}const e=localStorage.getItem(`${Ve}prefecture`);if(e)try{const t=window.atob(e).charCodeAt(0);for(const e of this.data_broadcasting_prefectures)if(e.value.startsWith(`${t}-`)){this.data_broadcasting_prefecture=e.value;break}}catch(s){}},watch:{data_broadcasting_zip_code(t){if(!1!==this.$refs.data_broadcasting_zip_code.validate())if(""!==t){const e=window.btoa(t.replace("-",""));localStorage.setItem(`${Ve}zipcode`,e)}else localStorage.removeItem(`${Ve}zipcode`)},data_broadcasting_prefecture(t){if("255-0b0"!==t){const e=t.split("-0b"),s=parseInt(e[0]),i=window.btoa(String.fromCharCode(s));localStorage.setItem(`${Ve}prefecture`,i);const a=parseInt(e[1],2),n=window.btoa(String.fromCharCode(a>>8,255&a));localStorage.setItem(`${Ve}regioncode`,n)}else localStorage.removeItem(`${Ve}prefecture`),localStorage.removeItem(`${Ve}regioncode`)}},methods:{resetNVRAMSettings(){for(const t in localStorage)t.startsWith("KonomiTV-BMLBrowser_nvram_")&&localStorage.removeItem(t);this.data_broadcasting_zip_code="",this.data_broadcasting_prefecture="255-0b0",this.$message.success("データ放送の保存データをリセットしました。")}}}),Ue=Re,Ge=(0,p.Z)(Ue,He,Fe,!1,null,null,null),We=Ge.exports,qe=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("SettingsBase",[e("h2",{staticClass:"settings__heading"},[e("router-link",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],staticClass:"settings__back-button",attrs:{to:"/settings/"}},[e("Icon",{attrs:{icon:"fluent:arrow-left-12-filled",width:"25px"}})],1),e("Icon",{attrs:{icon:"fa-solid:sliders-h",width:"19px"}}),e("span",{staticClass:"ml-3"},[t._v("全般")])],1),e("div",{staticClass:"settings__content"},[e("div",{staticClass:"settings__item settings__item--sync-disabled"},[e("div",{staticClass:"settings__item-heading"},[t._v("テレビのデフォルトのストリーミング画質")]),e("div",{staticClass:"settings__item-label"},[t._v(" テレビをライブストリーミングするときのデフォルトの画質を設定します。"),e("br"),t._v(" ストリーミング画質はプレイヤーの設定からいつでも切り替えられます。"),e("br")]),e("div",{staticClass:"settings__item-label"},[t._v(" [1080p (60fps)] は、通常 30fps (60i) の映像を補間し、より滑らか（ぬるぬる）な映像で視聴できます！"),e("br"),t._v(" [1080p (60fps)] で視聴するときは、サーバー設定の [利用するエンコーダー] をハードウェアエンコーダーに設定してください。FFmpeg (ソフトウェアエンコーダー) では、視聴に支障が出ることがあります。"),e("br")]),e(Ie.Z,{staticClass:"settings__item-form",attrs:{outlined:"","hide-details":"",dense:t.is_form_dense,items:t.tv_streaming_quality},model:{value:t.settingsStore.settings.tv_streaming_quality,callback:function(e){t.$set(t.settingsStore.settings,"tv_streaming_quality",e)},expression:"settingsStore.settings.tv_streaming_quality"}})],1),e("div",{staticClass:"settings__item settings__item--switch settings__item--sync-disabled",class:{"settings__item--disabled":!1===t.PlayerUtils.isHEVCVideoSupported()}},[e("label",{staticClass:"settings__item-heading",attrs:{for:"tv_data_saver_mode"}},[t._v("テレビを通信節約モードで視聴する")]),e("label",{staticClass:"settings__item-label",attrs:{for:"tv_data_saver_mode"}},[t._v(" 通信節約モードでは、H.265 / HEVC という圧縮率の高いコーデックを使い、画質はほぼそのまま、通信量を通常の 1/2 程度に抑えながら視聴できます！"),e("br"),t._v(" 通信節約モードで視聴するときは、サーバー設定の [利用するエンコーダー] をハードウェアエンコーダーに設定してください。FFmpeg (ソフトウェアエンコーダー) では、視聴に支障が出る可能性が高いです。"),e("br"),!1===t.PlayerUtils.isHEVCVideoSupported()&&!1===t.Utils.isFirefox()?e("p",{staticClass:"mt-1 mb-0 error--text lighten-1"},[t._v(" このデバイスでは通信節約モードがサポートされていません。 ")]):t._e(),!1===t.PlayerUtils.isHEVCVideoSupported()&&!0===t.Utils.isFirefox()?e("p",{staticClass:"mt-1 mb-0 error--text lighten-1"},[t._v(" お使いの Firefox ブラウザでは通信節約モードがサポートされていません。 ")]):t._e()]),e(_e.Z,{staticClass:"settings__item-switch",attrs:{id:"tv_data_saver_mode",inset:"","hide-details":"",disabled:!1===t.PlayerUtils.isHEVCVideoSupported()},model:{value:t.settingsStore.settings.tv_data_saver_mode,callback:function(e){t.$set(t.settingsStore.settings,"tv_data_saver_mode",e)},expression:"settingsStore.settings.tv_data_saver_mode"}})],1),e("div",{staticClass:"settings__item settings__item--switch settings__item--sync-disabled"},[e("label",{staticClass:"settings__item-heading",attrs:{for:"tv_low_latency_mode"}},[t._v("テレビを低遅延で視聴する")]),e("label",{staticClass:"settings__item-label",attrs:{for:"tv_low_latency_mode"}},[t._v(" 低遅延ストリーミングをオンにすると、"),e("b",[t._v("放送波との遅延を最短 0.9 秒に抑えて視聴できます！")]),e("br"),t._v(" また、約 3 秒以上遅延したときに少しだけ再生速度を早める (1.1x) ことで、滑らかにストリーミングの遅延を取り戻します。"),e("br"),t._v(" 宅外視聴などのネットワークが不安定になりがちな環境では、低遅延ストリーミングをオフにしてみると、映像のカクつきを改善できるかもしれません。"),e("br")]),e(_e.Z,{staticClass:"settings__item-switch",attrs:{id:"tv_low_latency_mode",inset:"","hide-details":""},model:{value:t.settingsStore.settings.tv_low_latency_mode,callback:function(e){t.$set(t.settingsStore.settings,"tv_low_latency_mode",e)},expression:"settingsStore.settings.tv_low_latency_mode"}})],1),e(vt.Z,{staticClass:"mt-6"}),e("div",{staticClass:"settings__item"},[e("div",{staticClass:"settings__item-heading"},[t._v("デフォルトのパネルの表示状態")]),e("div",{staticClass:"settings__item-label"},[t._v(" 視聴画面を開いたときに、右側のパネルをどう表示するかを設定します。"),e("br")]),e(Ie.Z,{staticClass:"settings__item-form",attrs:{outlined:"","hide-details":"",dense:t.is_form_dense,items:t.panel_display_state},model:{value:t.settingsStore.settings.panel_display_state,callback:function(e){t.$set(t.settingsStore.settings,"panel_display_state",e)},expression:"settingsStore.settings.panel_display_state"}})],1),e("div",{staticClass:"settings__item"},[e("div",{staticClass:"settings__item-heading"},[t._v("テレビをみるときにデフォルトで表示されるパネルのタブ")]),e("div",{staticClass:"settings__item-label"},[t._v(" テレビの視聴画面を開いたときに、右側のパネルで最初に表示されるタブを設定します。"),e("br")]),e(Ie.Z,{staticClass:"settings__item-form",attrs:{outlined:"","hide-details":"",dense:t.is_form_dense,items:t.tv_panel_active_tab},model:{value:t.settingsStore.settings.tv_panel_active_tab,callback:function(e){t.$set(t.settingsStore.settings,"tv_panel_active_tab",e)},expression:"settingsStore.settings.tv_panel_active_tab"}})],1),e(vt.Z,{staticClass:"mt-6"}),e("div",{staticClass:"settings__item settings__item--switch"},[e("label",{staticClass:"settings__item-heading",attrs:{for:"tv_show_superimpose"}},[t._v("チャンネル選局のキーボードショートカットを "+t._s(t.Utils.AltOrOption())+" + 数字キー/テンキーに変更する")]),e("label",{staticClass:"settings__item-label",attrs:{for:"tv_show_superimpose"}},[t._v(" この設定をオンにすると、数字キーまたはテンキーに対応するリモコン番号（1～12）のチャンネルに切り替える際、"+t._s(t.Utils.AltOrOption())+" キーを同時に押す必要があります。"),e("br"),t._v(" コメントやツイートを入力しようとして誤って数字キーを押してしまい、チャンネルが変わってしまう事態を避けたい方におすすめです。"),e("br")]),e(_e.Z,{staticClass:"settings__item-switch",attrs:{id:"tv_show_superimpose",inset:"","hide-details":""},model:{value:t.settingsStore.settings.tv_channel_selection_requires_alt_key,callback:function(e){t.$set(t.settingsStore.settings,"tv_channel_selection_requires_alt_key",e)},expression:"settingsStore.settings.tv_channel_selection_requires_alt_key"}})],1),e(vt.Z,{staticClass:"mt-6"}),e("div",{staticClass:"settings__item"},[e("div",{staticClass:"settings__item-heading"},[t._v("設定をエクスポート")]),e("div",{staticClass:"settings__item-label"},[t._v(" このデバイス（ブラウザ）に保存されている設定データを、エクスポート（ダウンロード）できます。"),e("br"),t._v(" ダウンロードした設定データ (KonomiTV-Settings.json) は、[設定をインポート] からインポートできます。異なるサーバーの KonomiTV を同じ設定で使いたいときなどに使ってください。"),e("br")])]),e(I.Z,{staticClass:"settings__save-button mt-4",attrs:{depressed:""},on:{click:function(e){return t.exportSettings()}}},[e("Icon",{staticClass:"mr-3",attrs:{icon:"fa6-solid:download",height:"19px"}}),t._v("設定をエクスポート ")],1),e("div",{staticClass:"settings__item"},[e("div",{staticClass:"settings__item-heading error--text text--lighten-1"},[t._v("設定をインポート")]),e("div",{staticClass:"settings__item-label"},[t._v(" [設定をエクスポート] でダウンロードした設定データを、このデバイス（ブラウザ）にインポートできます。"),e("br"),t._v(" 設定をインポートすると、"),e("b",[t._v("現在のデバイス設定はすべて上書きされます。")]),t._v("元に戻すことはできません。"),e("br"),t._v(" 設定のデバイス間同期がオンのときは、"),e("b",[t._v("同期が有効なすべてのデバイスに反映されます。")]),t._v("十分ご注意ください。"),e("br")]),e(ce.Z,{staticClass:"settings__item-form",attrs:{outlined:"","hide-details":"",placeholder:"設定データ (KonomiTV-Settings.json) を選択",dense:t.is_form_dense,accept:"application/json","prepend-icon":"","prepend-inner-icon":"mdi-paperclip"},model:{value:t.import_settings_file,callback:function(e){t.import_settings_file=e},expression:"import_settings_file"}})],1),e(I.Z,{staticClass:"settings__save-button error mt-5",attrs:{depressed:""},on:{click:function(e){return t.importSettings()}}},[e("Icon",{staticClass:"mr-3",attrs:{icon:"fa6-solid:upload",height:"19px"}}),t._v("設定をインポート ")],1),e("div",{staticClass:"settings__item"},[e("div",{staticClass:"settings__item-heading error--text text--lighten-1"},[t._v("設定を初期状態にリセット")]),e("div",{staticClass:"settings__item-label"},[t._v(" このデバイス（ブラウザ）に保存されている設定データを、初期状態のデフォルト値にリセットできます。"),e("br"),t._v(" 設定をリセットすると、元に戻すことはできません。"),e("br"),t._v(" 設定のデバイス間同期がオンのときは、"),e("b",[t._v("同期が有効なすべてのデバイスに反映されます。")]),t._v("十分ご注意ください。"),e("br")])]),e(I.Z,{staticClass:"settings__save-button error mt-5",attrs:{depressed:""},on:{click:function(e){return t.resetSettings()}}},[e("Icon",{staticClass:"mr-2",attrs:{icon:"material-symbols:device-reset-rounded",height:"23px"}}),t._v("設定をリセット ")],1)],1)])},Ye=[];const Xe=[{text:"1080p (60fps) (約4.50GB/h / 平均10.0Mbps)",value:"1080p-60fps"},{text:"1080p (約4.50GB/h / 平均10.0Mbps)",value:"1080p"},{text:"810p (約2.62GB/h / 平均5.8Mbps)",value:"810p"},{text:"720p (約2.18GB/h / 平均4.9Mbps)",value:"720p"},{text:"540p (約1.52GB/h / 平均3.4Mbps)",value:"540p"},{text:"480p (約1.06GB/h / 平均2.3Mbps)",value:"480p"},{text:"360p (約0.60GB/h / 平均1.3Mbps)",value:"360p"},{text:"240p (約0.35GB/h / 平均0.8Mbps)",value:"240p"}],Je=[{text:"1080p (60fps) (約1.80GB/h / 平均4.0Mbps)",value:"1080p-60fps"},{text:"1080p (約1.37GB/h / 平均3.0Mbps)",value:"1080p"},{text:"810p (約1.05GB/h / 平均2.3Mbps)",value:"810p"},{text:"720p (約0.82GB/h / 平均1.8Mbps)",value:"720p"},{text:"540p (約0.53GB/h / 平均1.2Mbps)",value:"540p"},{text:"480p (約0.46GB/h / 平均1.0Mbps)",value:"480p"},{text:"360p (約0.30GB/h / 平均0.7Mbps)",value:"360p"},{text:"240p (約0.20GB/h / 平均0.4Mbps)",value:"240p"}];var Qe=o["default"].extend({name:"Settings-General",components:{SettingsBase:ke},data(){return{Utils:pt,PlayerUtils:at,is_form_dense:pt.isSmartphoneHorizontal(),tv_streaming_quality:Xe,panel_display_state:[{text:"前回の状態を復元する",value:"RestorePreviousState"},{text:"常に表示する",value:"AlwaysDisplay"},{text:"常に折りたたむ",value:"AlwaysFold"}],tv_panel_active_tab:[{text:"番組情報タブ",value:"Program"},{text:"チャンネルタブ",value:"Channel"},{text:"コメントタブ",value:"Comment"},{text:"Twitter タブ",value:"Twitter"}],import_settings_file:null}},computed:{...(0,a.Kc)(st)},created(){!0===this.settingsStore.settings.tv_data_saver_mode&&(this.tv_streaming_quality=Je)},watch:{"settingsStore.settings.tv_data_saver_mode":{immediate:!0,handler(t){this.tv_streaming_quality=!0===t?Je:Xe}}},methods:{exportSettings(){const t=JSON.stringify(this.settingsStore.settings,null,4),e=new Blob([t],{type:"application/json"});pt.downloadBlobData(e,"KonomiTV-Settings.json"),this.$message.success("設定をエクスポートしました。")},async importSettings(){if(null===this.import_settings_file)return void this.$message.error("インポートする設定データを選択してください！");const t=await this.settingsStore.importClientSettings(this.import_settings_file);!0===t?(this.$message.success("設定をインポートしました。"),window.setTimeout((()=>this.$router.go(0)),300)):this.$message.error("設定データが不正なため、インポートできませんでした。")},async resetSettings(){await this.settingsStore.resetClientSettings(),this.$message.success("設定をリセットしました。"),window.setTimeout((()=>this.$router.go(0)),300)}}}),ts=Qe,es=(0,p.Z)(ts,qe,Ye,!1,null,null,null),ss=es.exports,is=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"route-container"},[e("Header"),e("main",[e("Navigation"),e(ht.Z,{staticClass:"settings-container d-flex px-5 py-5 mx-auto background",attrs:{elevation:"0",width:"100%","max-width":"1000"}},[e(ve.Z,{staticClass:"settings-navigation flex-shrink-0 background",attrs:{permanent:"",width:"100%",height:"auto"}},[e(pe.Z,{staticClass:"px-1"},[e(he.km,[e("h1",[t._v("設定")])])],1),e(me.Z,{staticClass:"mt-2 px-0",attrs:{nav:""}},[e(pe.Z,{staticClass:"px-4",attrs:{link:"",color:"primary",to:"/settings/general"}},[e(ge.Z,{staticClass:"mr-4"},[e("Icon",{staticStyle:{padding:"0 3px"},attrs:{icon:"fa-solid:sliders-h",width:"26px"}})],1),e(he.km,[e(he.V9,[t._v("全般")])],1)],1),e(pe.Z,{staticClass:"px-4",attrs:{link:"",color:"primary",to:"/settings/caption"}},[e(ge.Z,{staticClass:"mr-4"},[e("Icon",{attrs:{icon:"fluent:subtitles-16-filled",width:"26px"}})],1),e(he.km,[e(he.V9,[t._v("字幕")])],1)],1),e(pe.Z,{staticClass:"px-4",attrs:{link:"",color:"primary",to:"/settings/data-broadcasting"}},[e(ge.Z,{staticClass:"mr-4"},[e("svg",{attrs:{width:"26px",height:"26px",viewBox:"0 0 512 512"}},[e("path",{attrs:{fill:"currentColor",d:"M248.039 381.326L355.039 67.8258C367.539 28.3257 395.039 34.3258 406.539 34.3258C431.039 34.3258 453.376 61.3258 441.039 96.8258C362.639 322.426 343.539 375.326 340.539 384.826C338.486 391.326 342.039 391.326 345.539 391.326C377.039 391.326 386.539 418.326 386.539 435.326C386.539 458.826 371.539 477.326 350.039 477.326H214.539C179.039 477.326 85.8269 431.3 88.0387 335.826C91.0387 206.326 192.039 183.326 243.539 183.326H296.539L265.539 272.326H243.539C185.539 272.326 174.113 314.826 176.039 334.326C180.039 374.826 215.039 389.814 237.039 390.326C244.539 390.5 246.039 386.826 248.039 381.326Z"}})])]),e(he.km,[e(he.V9,[t._v("データ放送")])],1)],1),e(pe.Z,{staticClass:"px-4",attrs:{link:"",color:"primary",to:"/settings/capture"}},[e(ge.Z,{staticClass:"mr-4"},[e("Icon",{attrs:{icon:"fluent:image-multiple-16-filled",width:"26px"}})],1),e(he.km,[e(he.V9,[t._v("キャプチャ")])],1)],1),e(pe.Z,{staticClass:"px-4",attrs:{link:"",color:"primary",to:"/settings/account"}},[e(ge.Z,{staticClass:"mr-4"},[e("Icon",{attrs:{icon:"fluent:person-20-filled",width:"26px"}})],1),e(he.km,[e(he.V9,[t._v("アカウント")])],1)],1),e(pe.Z,{staticClass:"px-4",attrs:{link:"",color:"primary",to:"/settings/jikkyo"}},[e(ge.Z,{staticClass:"mr-4"},[e("Icon",{staticStyle:{padding:"0 2px"},attrs:{icon:"bi:chat-left-text-fill",width:"26px"}})],1),e(he.km,[e(he.V9,[t._v("ニコニコ実況")])],1)],1),e(pe.Z,{staticClass:"px-4",attrs:{link:"",color:"primary",to:"/settings/twitter"}},[e(ge.Z,{staticClass:"mr-4"},[e("Icon",{staticStyle:{padding:"0 1px"},attrs:{icon:"fa-brands:twitter",width:"26px"}})],1),e(he.km,[e(he.V9,[t._v("Twitter")])],1)],1),e(pe.Z,{staticClass:"px-4",attrs:{link:"",color:"primary",to:"/settings/server"}},[e(ge.Z,{staticClass:"mr-4"},[e("Icon",{attrs:{icon:"fluent:server-surface-16-filled",width:"26px"}})],1),e(he.km,[e(he.V9,[t._v("サーバー設定")])],1)],1),e(pe.Z,{staticClass:"px-4 settings-navigation-version",class:{"settings-navigation-version--highlight":t.versionStore.is_update_available},attrs:{link:"",color:"primary",href:"https://github.com/tsukumijima/KonomiTV"}},[e(ge.Z,{staticClass:"mr-4"},[e("Icon",{attrs:{icon:"fluent:info-16-regular",width:"26px"}})],1),e(he.km,[e(he.V9,[t._v(" version "+t._s(t.versionStore.client_version)+t._s(t.versionStore.is_update_available?" (Update Available)":"")+" ")])],1)],1)],1)],1)],1)],1)],1)},as=[],ns=o["default"].extend({name:"Settings-Index",components:{Header:jt,Navigation:Rt},computed:{...(0,a.Kc)(Mt)},async created(){await this.versionStore.fetchServerVersion()}}),rs=ns,os=(0,p.Z)(rs,is,as,!1,null,"51859415",null),ls=os.exports,cs=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("SettingsBase",[e("h2",{staticClass:"settings__heading"},[e("router-link",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],staticClass:"settings__back-button",attrs:{to:"/settings/"}},[e("Icon",{attrs:{icon:"fluent:arrow-left-12-filled",width:"25px"}})],1),e("Icon",{attrs:{icon:"bi:chat-left-text-fill",width:"19px"}}),e("span",{staticClass:"ml-3"},[t._v("ニコニコ実況")])],1),e("div",{staticClass:"settings__content",class:{"settings__content--loading":t.is_loading}},[null===t.userStore.user||null===t.userStore.user.niconico_user_id?e("div",{staticClass:"niconico-account niconico-account--anonymous"},[e("div",{staticClass:"niconico-account-wrapper"},[e("Icon",{staticClass:"flex-shrink-0",attrs:{icon:"bi:chat-left-text-fill",width:"45px"}}),e("div",{staticClass:"niconico-account__info ml-4"},[e("div",{staticClass:"niconico-account__info-name"},[e("span",{staticClass:"niconico-account__info-name-text"},[t._v("ニコニコアカウントと連携していません")])]),e("span",{staticClass:"niconico-account__info-description"},[t._v(" ニコニコアカウントと連携すると、テレビを見ながらニコニコ実況にコメントできるようになります。 ")])])],1),e(I.Z,{staticClass:"niconico-account__login ml-auto",attrs:{color:"secondary",width:"130",height:"56",depressed:""},on:{click:function(e){return t.loginNiconicoAccount()}}},[e("Icon",{staticClass:"mr-2",attrs:{icon:"fluent:plug-connected-20-filled",height:"26"}}),t._v("連携する ")],1)],1):t._e(),null!==t.userStore.user&&null!==t.userStore.user.niconico_user_id?e("div",{staticClass:"niconico-account"},[e("div",{staticClass:"niconico-account-wrapper"},[e("img",{staticClass:"niconico-account__icon",attrs:{src:t.userStore.user_niconico_icon_url??""}}),e("div",{staticClass:"niconico-account__info"},[e("div",{staticClass:"niconico-account__info-name"},[e("span",{staticClass:"niconico-account__info-name-text"},[t._v(t._s(t.userStore.user.niconico_user_name)+" と連携しています")])]),e("span",{staticClass:"niconico-account__info-description"},[e("span",{staticClass:"mr-2",staticStyle:{"white-space":"nowrap"}},[t._v("Niconico User ID:")]),e("a",{staticClass:"mr-2",attrs:{href:`https://www.nicovideo.jp/user/${t.userStore.user.niconico_user_id}`,target:"_blank"}},[t._v(t._s(t.userStore.user.niconico_user_id))]),!0===t.userStore.user.niconico_user_premium?e("span",{staticClass:"secondary--text"},[t._v("(Premium)")]):t._e()])])]),e(I.Z,{staticClass:"niconico-account__login ml-auto",attrs:{color:"secondary",width:"130",height:"56",depressed:""},on:{click:function(e){return t.logoutNiconicoAccount()}}},[e("Icon",{staticClass:"mr-2",attrs:{icon:"fluent:plug-disconnected-20-filled",height:"26"}}),t._v("連携解除 ")],1)],1):t._e(),e("div",{staticClass:"settings__item mt-7"},[e("div",{staticClass:"settings__item-heading"},[t._v("コメントのミュート設定")]),e("div",{staticClass:"settings__item-label"},[t._v(" 表示したくないコメントを、映像上やコメントリストに表示しないようにミュートできます。"),e("br")])]),e(I.Z,{staticClass:"settings__save-button mt-4",attrs:{depressed:""},on:{click:function(e){t.comment_mute_settings_modal=!t.comment_mute_settings_modal}}},[e("Icon",{attrs:{icon:"heroicons-solid:filter",height:"19px"}}),e("span",{staticClass:"ml-1"},[t._v("コメントのミュート設定を開く")])],1),e("div",{staticClass:"settings__item"},[e("div",{staticClass:"settings__item-heading"},[t._v("コメントの速さ")]),e("div",{staticClass:"settings__item-label"},[t._v(" プレイヤーに流れるコメントの速さを設定します。"),e("br"),t._v(" たとえば 1.2 に設定すると、コメントが 1.2 倍速く流れます。"),e("br")]),e(je.Z,{staticClass:"settings__item-form",attrs:{ticks:"always","thumb-label":"","hide-details":"",step:.1,min:.5,max:2},model:{value:t.settingsStore.settings.comment_speed_rate,callback:function(e){t.$set(t.settingsStore.settings,"comment_speed_rate",e)},expression:"settingsStore.settings.comment_speed_rate"}})],1),e("div",{staticClass:"settings__item"},[e("div",{staticClass:"settings__item-heading"},[t._v("コメントの文字サイズ")]),e("div",{staticClass:"settings__item-label"},[t._v(" プレイヤーに流れるコメントの文字サイズの基準値を設定します。"),e("br"),t._v(" 実際の文字サイズは画面サイズに合わせて調整されます。デフォルトの文字サイズは 34px です。"),e("br")]),e(je.Z,{staticClass:"settings__item-form",attrs:{ticks:"always","thumb-label":"","hide-details":"",min:20,max:60},model:{value:t.settingsStore.settings.comment_font_size,callback:function(e){t.$set(t.settingsStore.settings,"comment_font_size",e)},expression:"settingsStore.settings.comment_font_size"}})],1),e("div",{staticClass:"settings__item settings__item--switch"},[e("label",{staticClass:"settings__item-heading",attrs:{for:"close_comment_form_after_sending"}},[t._v("コメント送信後にコメント入力フォームを閉じる")]),e("label",{staticClass:"settings__item-label",attrs:{for:"close_comment_form_after_sending"}},[t._v(" この設定をオンにすると、コメントを送信した後に、コメント入力フォームが自動で閉じるようになります。"),e("br"),t._v(" コメント入力フォームが表示されたままだと、大半のショートカットキーが文字入力と競合して使えなくなります。とくに理由がなければ、オンにしておくのがおすすめです。"),e("br")]),e(_e.Z,{staticClass:"settings__item-switch",attrs:{id:"close_comment_form_after_sending",inset:"","hide-details":""},model:{value:t.settingsStore.settings.close_comment_form_after_sending,callback:function(e){t.$set(t.settingsStore.settings,"close_comment_form_after_sending",e)},expression:"settingsStore.settings.close_comment_form_after_sending"}})],1)],1),e("CommentMuteSettings",{model:{value:t.comment_mute_settings_modal,callback:function(e){t.comment_mute_settings_modal=e},expression:"comment_mute_settings_modal"}})],1)},_s=[],ds=function(){var t=this,e=t._self._c;t._self._setupProxy;return e(le.Z,{attrs:{"max-width":"770",transition:"slide-y-transition"},model:{value:t.comment_mute_settings_modal,callback:function(e){t.comment_mute_settings_modal=e},expression:"comment_mute_settings_modal"}},[e(ht.Z,{staticClass:"comment-mute-settings"},[e(gt.EB,{staticClass:"px-5 pt-5 pb-3 d-flex align-center font-weight-bold",staticStyle:{height:"60px"}},[e("Icon",{attrs:{icon:"heroicons-solid:filter",height:"26px"}}),e("span",{staticClass:"ml-3"},[t._v("コメントのミュート設定")]),e(kt.Z),e("div",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],staticClass:"d-flex align-center rounded-circle cursor-pointer px-2 py-2",on:{click:function(e){t.comment_mute_settings_modal=!1}}},[e("Icon",{attrs:{icon:"fluent:dismiss-12-filled",width:"23px",height:"23px"}})],1)],1),e("div",{staticClass:"px-5 pb-5"},[e("div",{staticClass:"text-subtitle-1 d-flex align-center font-weight-bold mt-4"},[e("Icon",{attrs:{icon:"fa-solid:sliders-h",width:"24px",height:"20px"}}),e("span",{staticClass:"ml-2"},[t._v("クイック設定")])],1),e("div",{staticClass:"settings__item settings__item--switch"},[e("label",{staticClass:"settings__item-heading",attrs:{for:"mute_vulgar_comments"}},[t._v(" 露骨な表現を含むコメントをミュートする ")]),e("label",{staticClass:"settings__item-label",attrs:{for:"mute_vulgar_comments"}},[t._v(" 性的な単語などの露骨・下品な表現を含むコメントを、一括でミュートするかを設定します。"),e("br")]),e(_e.Z,{staticClass:"settings__item-switch",attrs:{id:"mute_vulgar_comments",inset:"","hide-details":""},model:{value:t.settingsStore.settings.mute_vulgar_comments,callback:function(e){t.$set(t.settingsStore.settings,"mute_vulgar_comments",e)},expression:"settingsStore.settings.mute_vulgar_comments"}})],1),e("div",{staticClass:"settings__item settings__item--switch"},[e("label",{staticClass:"settings__item-heading",attrs:{for:"mute_abusive_discriminatory_prejudiced_comments"}},[t._v(" ネガティブな表現、差別的な表現、政治的に偏った表現を含むコメントをミュートする ")]),e("label",{staticClass:"settings__item-label",attrs:{for:"mute_abusive_discriminatory_prejudiced_comments"}},[t._v(" 『死ね』『殺す』などのネガティブな表現、特定の国や人々への差別的な表現、政治的に偏った表現を含むコメントを、一括でミュートするかを設定します。"),e("br")]),e(_e.Z,{staticClass:"settings__item-switch",attrs:{id:"mute_abusive_discriminatory_prejudiced_comments",inset:"","hide-details":""},model:{value:t.settingsStore.settings.mute_abusive_discriminatory_prejudiced_comments,callback:function(e){t.$set(t.settingsStore.settings,"mute_abusive_discriminatory_prejudiced_comments",e)},expression:"settingsStore.settings.mute_abusive_discriminatory_prejudiced_comments"}})],1),e("div",{staticClass:"settings__item settings__item--switch"},[e("label",{staticClass:"settings__item-heading",attrs:{for:"mute_big_size_comments"}},[t._v(" 文字サイズが大きいコメントをミュートする ")]),e("label",{staticClass:"settings__item-label",attrs:{for:"mute_big_size_comments"}},[t._v(" 通常より大きい文字サイズで表示されるコメントを、一括でミュートするかを設定します。"),e("br"),t._v(" 文字サイズが大きいコメントには迷惑なコメントが多いです。基本的にはオンにしておくのがおすすめです。"),e("br")]),e(_e.Z,{staticClass:"settings__item-switch",attrs:{id:"mute_big_size_comments",inset:"","hide-details":""},model:{value:t.settingsStore.settings.mute_big_size_comments,callback:function(e){t.$set(t.settingsStore.settings,"mute_big_size_comments",e)},expression:"settingsStore.settings.mute_big_size_comments"}})],1),e("div",{staticClass:"settings__item settings__item--switch"},[e("label",{staticClass:"settings__item-heading",attrs:{for:"mute_fixed_comments"}},[t._v(" 映像の上下に固定表示されるコメントをミュートする ")]),e("label",{staticClass:"settings__item-label",attrs:{for:"mute_fixed_comments"}},[t._v(" 映像の上下に固定された状態で表示されるコメントを、一括でミュートするかを設定します。"),e("br"),t._v(" 固定表示されるコメントが煩わしい方におすすめです。"),e("br")]),e(_e.Z,{staticClass:"settings__item-switch",attrs:{id:"mute_fixed_comments",inset:"","hide-details":""},model:{value:t.settingsStore.settings.mute_fixed_comments,callback:function(e){t.$set(t.settingsStore.settings,"mute_fixed_comments",e)},expression:"settingsStore.settings.mute_fixed_comments"}})],1),e("div",{staticClass:"settings__item settings__item--switch"},[e("label",{staticClass:"settings__item-heading",attrs:{for:"mute_colored_comments"}},[t._v(" 色付きのコメントをミュートする ")]),e("label",{staticClass:"settings__item-label",attrs:{for:"mute_colored_comments"}},[t._v(" 白以外の色で表示される色付きのコメントを、一括でミュートするかを設定します。"),e("br"),t._v(" この設定をオンにしておくと、目立つ色のコメントを一掃できます。"),e("br")]),e(_e.Z,{staticClass:"settings__item-switch",attrs:{id:"mute_colored_comments",inset:"","hide-details":""},model:{value:t.settingsStore.settings.mute_colored_comments,callback:function(e){t.$set(t.settingsStore.settings,"mute_colored_comments",e)},expression:"settingsStore.settings.mute_colored_comments"}})],1),e("div",{staticClass:"settings__item settings__item--switch"},[e("label",{staticClass:"settings__item-heading",attrs:{for:"mute_consecutive_same_characters_comments"}},[t._v(" 8文字以上同じ文字が連続しているコメントをミュートする ")]),e("label",{staticClass:"settings__item-label",attrs:{for:"mute_consecutive_same_characters_comments"}},[t._v(" 『wwwwwwwwwww』『あばばばばばばばばば』など、8文字以上同じ文字が連続しているコメントを、一括でミュートするかを設定します。"),e("br"),t._v(" しばしばあるテンプレコメントが煩わしい方におすすめです。"),e("br")]),e(_e.Z,{staticClass:"settings__item-switch",attrs:{id:"mute_consecutive_same_characters_comments",inset:"","hide-details":""},model:{value:t.settingsStore.settings.mute_consecutive_same_characters_comments,callback:function(e){t.$set(t.settingsStore.settings,"mute_consecutive_same_characters_comments",e)},expression:"settingsStore.settings.mute_consecutive_same_characters_comments"}})],1),e("div",{staticClass:"text-subtitle-1 d-flex align-center font-weight-bold mt-4"},[e("Icon",{attrs:{icon:"fluent:comment-dismiss-20-filled",width:"24px"}}),e("span",{staticClass:"ml-2 mr-2"},[t._v("ミュート済みのキーワード")]),e(I.Z,{staticClass:"ml-auto",attrs:{depressed:""},on:{click:function(e){return t.settingsStore.settings.muted_comment_keywords.push({match:"partial",pattern:""})}}},[e("Icon",{attrs:{icon:"fluent:add-12-filled",height:"17px"}}),e("span",{staticClass:"ml-1"},[t._v("追加")])],1)],1),e("div",{staticClass:"muted-comment-items"},t._l(t.settingsStore.settings.muted_comment_keywords,(function(s,i){return e("div",{key:i,staticClass:"muted-comment-item"},[e(bt.Z,{staticClass:"muted-comment-item__input",attrs:{type:"search",dense:"",outlined:"","hide-details":"",placeholder:"ミュートするキーワードを入力"},model:{value:t.settingsStore.settings.muted_comment_keywords[i].pattern,callback:function(e){t.$set(t.settingsStore.settings.muted_comment_keywords[i],"pattern",e)},expression:"settingsStore.settings.muted_comment_keywords[index].pattern"}}),e(Ie.Z,{staticClass:"muted-comment-item__match-type",attrs:{dense:"",outlined:"","hide-details":"",items:t.muted_comment_keyword_match_type},model:{value:t.settingsStore.settings.muted_comment_keywords[i].match,callback:function(e){t.$set(t.settingsStore.settings.muted_comment_keywords[i],"match",e)},expression:"settingsStore.settings.muted_comment_keywords[index].match"}}),e("button",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],staticClass:"muted-comment-item__delete-button",on:{click:function(e){t.settingsStore.settings.muted_comment_keywords.splice(t.settingsStore.settings.muted_comment_keywords.indexOf(s),1)}}},[e("Icon",{attrs:{icon:"fluent:delete-16-filled",width:"20px"}})],1)],1)})),0),e("div",{staticClass:"text-subtitle-1 d-flex align-center font-weight-bold mt-4"},[e("Icon",{attrs:{icon:"fluent:person-prohibited-20-filled",width:"24px"}}),e("span",{staticClass:"ml-2 mr-2"},[t._v("ミュート済みのニコニコユーザー ID")]),e(I.Z,{staticClass:"ml-auto",attrs:{depressed:""},on:{click:function(e){return t.settingsStore.settings.muted_niconico_user_ids.push("")}}},[e("Icon",{attrs:{icon:"fluent:add-12-filled",height:"17px"}}),e("span",{staticClass:"ml-1"},[t._v("追加")])],1)],1),e("div",{staticClass:"muted-comment-items"},t._l(t.settingsStore.settings.muted_niconico_user_ids,(function(s,i){return e("div",{key:i,staticClass:"muted-comment-item"},[e(bt.Z,{staticClass:"muted-comment-item__input",attrs:{type:"search",dense:"",outlined:"","hide-details":"",placeholder:"ミュートするニコニコユーザー ID を入力"},model:{value:t.settingsStore.settings.muted_niconico_user_ids[i],callback:function(e){t.$set(t.settingsStore.settings.muted_niconico_user_ids,i,e)},expression:"settingsStore.settings.muted_niconico_user_ids[index]"}}),e("button",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],staticClass:"muted-comment-item__delete-button",on:{click:function(e){t.settingsStore.settings.muted_niconico_user_ids.splice(t.settingsStore.settings.muted_niconico_user_ids.indexOf(s),1)}}},[e("Icon",{attrs:{icon:"fluent:delete-16-filled",width:"20px"}})],1)],1)})),0)])],1)],1)},us=[],ms=o["default"].extend({name:"CommentMuteSettings",model:{prop:"showing",event:"change"},props:{showing:{type:Boolean,required:!0}},data(){return{interval_timer_id:0,comment_mute_settings_modal:!1,muted_comment_keyword_match_type:[{text:"部分一致",value:"partial"},{text:"前方一致",value:"forward"},{text:"後方一致",value:"backward"},{text:"完全一致",value:"exact"},{text:"正規表現",value:"regex"}]}},computed:{...(0,a.Kc)(st)},watch:{showing(){this.comment_mute_settings_modal=this.showing},comment_mute_settings_modal(){this.$emit("change",this.comment_mute_settings_modal)}}}),ps=ms,hs=(0,p.Z)(ps,ds,us,!1,null,"2cd59ba0",null),gs=hs.exports;class vs{static async fetchAuthorizationURL(){const t=await G.get("/niconico/auth");return"is_error"in t?(G.showGenericError(t,"ニコニコアカウントとの連携用の認証 URL を取得できませんでした。"),null):t.data.authorization_url}static async logoutAccount(){const t=await G["delete"]("/niconico/logout");return!("is_error"in t)||(G.showGenericError(t,"ニコニコアカウントとの連携を解除できませんでした。"),!1)}}var fs=vs,ws=o["default"].extend({name:"Settings-Jikkyo",components:{SettingsBase:ke,CommentMuteSettings:gs},data(){return{comment_mute_settings_modal:!1,is_loading:!0}},computed:{...(0,a.Kc)(st,R)},async created(){if(await this.userStore.fetchUser(),this.is_loading=!1,""!==location.hash){const t=new URLSearchParams(location.hash.replace("#",""));if(null!==t.get("status")&&null!==t.get("detail")){const e=parseInt(t.get("status")),s=t.get("detail");this.onOAuthCallbackReceived(e,s),history.replaceState(null,""," ")}}},methods:{async loginNiconicoAccount(){if(!1===this.userStore.is_logged_in)return void this.$message.warning("連携をはじめるには、KonomiTV アカウントにログインしてください。");const t=await fs.fetchAuthorizationURL();if(null===t)return;if(!0===pt.isMobileDevice())return void(location.href=t);const e=window.open(t,"KonomiTV-OAuthPopup",pt.getWindowFeatures());if(null===e)return void this.$message.error("ポップアップウインドウを開けませんでした。");const s=async t=>{if(e.closed)return;if("object"!==pt["typeof"](t.data))return;if("KonomiTV-OAuthPopup"in t.data===!1)return;e&&e.close(),window.removeEventListener("message",s);const i=t.data["KonomiTV-OAuthPopup"]["status"],a=t.data["KonomiTV-OAuthPopup"]["detail"];this.onOAuthCallbackReceived(i,a)};window.addEventListener("message",s)},async onOAuthCallbackReceived(t,e){if(console.log(`NiconicoAuthCallbackAPI: Status: ${t} / Detail: ${e}`),200===t)await this.userStore.fetchUser(!0),this.$message.success("ニコニコアカウントと連携しました。");else if(e.startsWith("Authorization was denied (access_denied)"))this.$message.error("ニコニコアカウントとの連携がキャンセルされました。");else if(e.startsWith("Failed to get access token (HTTP Error ")){const t=e.replace("Failed to get access token ","");this.$message.error(`アクセストークンの取得に失敗しました。${t}`)}else if(e.startsWith("Failed to get access token (Connection Timeout)"))this.$message.error("アクセストークンの取得に失敗しました。ニコニコで障害が発生している可能性があります。");else if(e.startsWith("Failed to get user information (HTTP Error ")){const t=e.replace("Failed to get user information ","");this.$message.error(`ニコニコアカウントのユーザー情報の取得に失敗しました。${t}`)}else e.startsWith("Failed to get user information (Connection Timeout)")?this.$message.error("ニコニコアカウントのユーザー情報の取得に失敗しました。ニコニコで障害が発生している可能性があります。"):this.$message.error(`ニコニコアカウントとの連携に失敗しました。(${e})`)},async logoutNiconicoAccount(){const t=await fs.logoutAccount();!1!==t&&(await this.userStore.fetchUser(!0),this.$message.success("ニコニコアカウントとの連携を解除しました。"))}}}),bs=ws,ys=(0,p.Z)(bs,cs,_s,!1,null,"3ff16abd",null),Cs=ys.exports,ks=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("SettingsBase",[e("h2",{staticClass:"settings__heading"},[e("router-link",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],staticClass:"settings__back-button",attrs:{to:"/settings/"}},[e("Icon",{attrs:{icon:"fluent:arrow-left-12-filled",width:"25px"}})],1),e("Icon",{attrs:{icon:"fluent:server-surface-16-filled",width:"22px"}}),e("span",{staticClass:"ml-2"},[t._v("サーバー設定")])],1),e("div",{staticClass:"settings__content"},[e("div",{staticClass:"settings__item"},[e("div",{staticClass:"settings__item-heading"},[t._v("鋭意開発中…")])])])])},xs=[],Ss=o["default"].extend({name:"Settings-Server",components:{SettingsBase:ke}}),Os=Ss,Ts=(0,p.Z)(Os,ks,xs,!1,null,null,null),Is=Ts.exports,js=s(89767),Zs=s(47935),Bs=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("SettingsBase",[e("h2",{staticClass:"settings__heading"},[e("router-link",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],staticClass:"settings__back-button",attrs:{to:"/settings/"}},[e("Icon",{attrs:{icon:"fluent:arrow-left-12-filled",width:"25px"}})],1),e("Icon",{attrs:{icon:"fa-brands:twitter",width:"22px"}}),e("span",{staticClass:"ml-3"},[t._v("Twitter")])],1),e("div",{staticClass:"settings__content",class:{"settings__content--loading":t.is_loading}},[e("div",{staticClass:"twitter-accounts"},[null!==t.userStore.user&&t.userStore.user.twitter_accounts.length>0?e("div",{staticClass:"twitter-accounts__heading"},[e("Icon",{staticClass:"mr-2",attrs:{icon:"fluent:person-board-20-filled",height:"30"}}),t._v("連携中のアカウント ")],1):t._e(),null===t.userStore.user||0===t.userStore.user.twitter_accounts.length?e("div",{staticClass:"twitter-accounts__guide"},[e("Icon",{staticClass:"flex-shrink-0",attrs:{icon:"fa-brands:twitter",width:"45px"}}),e("div",{staticClass:"ml-4"},[e("div",{staticClass:"font-weight-bold text-h6"},[t._v("Twitter アカウントと連携していません")]),e("div",{staticClass:"text--text text--darken-1 text-subtitle-2 mt-1"},[t._v(" Twitter アカウントと連携すると、テレビを見ながら Twitter にツイートしたり、ほかの実況ツイートをリアルタイムで表示できるようになります。 ")])])],1):t._e(),t._l(null!==t.userStore.user?t.userStore.user.twitter_accounts:[],(function(s){return e("div",{key:s.id,staticClass:"twitter-account"},[e("img",{staticClass:"twitter-account__icon",attrs:{src:s.icon_url}}),e("div",{staticClass:"twitter-account__info"},[e("div",{staticClass:"twitter-account__info-name"},[e("span",{staticClass:"twitter-account__info-name-text"},[t._v(t._s(s.name))])]),e("span",{staticClass:"twitter-account__info-screen-name"},[t._v(" @"+t._s(s.screen_name)+" "),!0===s.is_oauth_session?e("span",[t._v("(Legacy Session)")]):t._e()])]),e(I.Z,{staticClass:"twitter-account__logout ml-auto",attrs:{width:"124",height:"52",depressed:""},on:{click:function(e){return t.logoutTwitterAccount(s.screen_name)}}},[e("Icon",{staticClass:"mr-2",attrs:{icon:"fluent:plug-disconnected-20-filled",height:"24"}}),t._v("連携解除 ")],1)],1)})),e(I.Z,{staticClass:"twitter-account__login",attrs:{color:"secondary","max-width":"250",height:"50",depressed:""},on:{click:function(e){return t.loginTwitterAccountWithPasswordForm()}}},[e("Icon",{staticClass:"mr-2",attrs:{icon:"fluent:plug-connected-20-filled",height:"24"}}),t._v("連携するアカウントを追加 ")],1),e(le.Z,{attrs:{"max-width":"600"},model:{value:t.twitter_password_auth_dialog,callback:function(e){t.twitter_password_auth_dialog=e},expression:"twitter_password_auth_dialog"}},[e(ht.Z,[e(gt.EB,{staticClass:"justify-center pt-6 font-weight-bold"},[t._v("Twitter にログイン")]),e(gt.ZB,{staticClass:"pt-2 pb-0"},[e("p",{staticClass:"mb-1"},[t._v("2023/07 以降、Twitter のサードパーティー API の事実上の廃止により、従来のアプリ連携では Twitter にアクセスできなくなりました。")]),e("p",{staticClass:"mb-1"},[t._v("そこで KonomiTV では、代わりに "),e("a",{attrs:{href:"https://github.com/tsukumijima/tweepy-authlib",target:"_blank"}},[t._v("ユーザー名とパスワードでログイン")]),t._v(" することで、これまで通り Twitter 連携ができるようにしています (2要素認証を設定しているアカウントには対応していません) 。")]),e("p",{staticClass:"mb-1"},[t._v("ここで入力したパスワードは一切保存されず、取得した Cookie セッションはローカルの KonomiTV サーバーにのみ保存されます。Cookie セッションが Twitter API 以外の外部サービスに送信されることはありません。")]),e("p",{staticClass:"mb-1"},[t._v("万全は期していますが、非公式な方法のため、使い方次第ではアカウントにペナルティが適用される可能性もあります。自己の責任のもとでご利用ください。")]),e(ft.Z,{ref:"twitter_form",staticClass:"settings__item",on:{submit:function(t){t.preventDefault()}}},[e(bt.Z,{ref:"twitter_screen_name",staticClass:"settings__item-form mt-6",attrs:{outlined:"",label:"ユーザー名 (@ から始まる ID)",placeholder:"screen_name",dense:t.is_form_dense,rules:[t=>!!t||"ユーザー名を入力してください。"]},model:{value:t.twitter_screen_name,callback:function(e){t.twitter_screen_name=e},expression:"twitter_screen_name"}}),e(bt.Z,{staticClass:"settings__item-form",attrs:{outlined:"",label:"パスワード",dense:t.is_form_dense,type:t.twitter_password_showing?"text":"password","append-icon":t.twitter_password_showing?"mdi-eye":"mdi-eye-off",rules:[t=>!!t||"パスワードを入力してください。"]},on:{"click:append":function(e){t.twitter_password_showing=!t.twitter_password_showing}},model:{value:t.twitter_password,callback:function(e){t.twitter_password=e},expression:"twitter_password"}})],1)],1),e(gt.h7,{staticClass:"pt-0 px-6 pb-5"},[e(kt.Z),e(I.Z,{attrs:{color:"text",height:"40",text:""},on:{click:function(e){t.twitter_password_auth_dialog=!1}}},[t._v("キャンセル")]),e(I.Z,{staticClass:"px-4",attrs:{color:"secondary",height:"40"},on:{click:function(e){return t.loginTwitterAccountWithPassword()}}},[t._v("ログイン")])],1)],1)],1)],2),e("div",{staticClass:"settings__item settings__item--switch"},[e("label",{staticClass:"settings__item-heading",attrs:{for:"fold_panel_after_sending_tweet"}},[t._v("ツイート送信後にパネルを折りたたむ")]),e("label",{staticClass:"settings__item-label",attrs:{for:"fold_panel_after_sending_tweet"}},[t._v(" この設定をオンにすると、ツイートを送信した後に、パネルが自動で折りたたまれます。"),e("br"),t._v(" ツイートするとき以外はできるだけ映像を大きくして見たい方におすすめです。"),e("br")]),e(_e.Z,{staticClass:"settings__item-switch",attrs:{id:"fold_panel_after_sending_tweet",inset:"","hide-details":""},model:{value:t.settingsStore.settings.fold_panel_after_sending_tweet,callback:function(e){t.$set(t.settingsStore.settings,"fold_panel_after_sending_tweet",e)},expression:"settingsStore.settings.fold_panel_after_sending_tweet"}})],1),e("div",{staticClass:"settings__item settings__item--switch"},[e("label",{staticClass:"settings__item-heading",attrs:{for:"reset_hashtag_when_program_switches"}},[t._v("番組が切り替わったときにハッシュタグフォームをリセットする")]),e("label",{staticClass:"settings__item-label",attrs:{for:"reset_hashtag_when_program_switches"}},[t._v(" チャンネルを切り替えたときや、視聴中の番組が終了し次の番組の放送が開始されたときに、ハッシュタグフォームをリセットするかを設定します。"),e("br"),t._v(" この設定をオンにしておけば、「誤って前番組のハッシュタグをつけたまま次番組の実況ツイートをしてしまう」といったミスを回避できます。"),e("br")]),e(_e.Z,{staticClass:"settings__item-switch",attrs:{id:"reset_hashtag_when_program_switches",inset:"","hide-details":""},model:{value:t.settingsStore.settings.reset_hashtag_when_program_switches,callback:function(e){t.$set(t.settingsStore.settings,"reset_hashtag_when_program_switches",e)},expression:"settingsStore.settings.reset_hashtag_when_program_switches"}})],1),e("div",{staticClass:"settings__item settings__item--switch"},[e("label",{staticClass:"settings__item-heading",attrs:{for:"auto_add_watching_channel_hashtag"}},[t._v("視聴中のチャンネルに対応する局タグを自動で追加する")]),e("label",{staticClass:"settings__item-label",attrs:{for:"auto_add_watching_channel_hashtag"}},[t._v(" この設定をオンにすると、視聴中のチャンネルに対応する局タグ (#nhk, #tokyomx など) がハッシュタグフォームに自動で追加されます。"),e("br"),t._v(" 現時点で、局タグは三大首都圏の地上波・BS の一部チャンネル・AT-X にのみ対応しています。"),e("br")]),e(_e.Z,{staticClass:"settings__item-switch",attrs:{id:"auto_add_watching_channel_hashtag",inset:"","hide-details":""},model:{value:t.settingsStore.settings.auto_add_watching_channel_hashtag,callback:function(e){t.$set(t.settingsStore.settings,"auto_add_watching_channel_hashtag",e)},expression:"settingsStore.settings.auto_add_watching_channel_hashtag"}})],1),e("div",{staticClass:"settings__item"},[e("div",{staticClass:"settings__item-heading"},[t._v("デフォルトで表示される Twitter タブ内のタブ")]),e("div",{staticClass:"settings__item-label"},[t._v(" 視聴画面を開いたときに、パネルの Twitter タブの中で最初に表示されるタブを設定します。"),e("br")]),e(Ie.Z,{staticClass:"settings__item-form",attrs:{outlined:"","hide-details":"",dense:t.is_form_dense,items:t.twitter_active_tab},model:{value:t.settingsStore.settings.twitter_active_tab,callback:function(e){t.$set(t.settingsStore.settings,"twitter_active_tab",e)},expression:"settingsStore.settings.twitter_active_tab"}})],1),e("div",{staticClass:"settings__item"},[e("div",{staticClass:"settings__item-heading"},[t._v("ツイートにつけるハッシュタグの位置")]),e("div",{staticClass:"settings__item-label"},[t._v(" ツイート本文から見て、ハッシュタグをどの位置につけてツイートするかを設定します。"),e("br")]),e(Ie.Z,{staticClass:"settings__item-form",attrs:{outlined:"","hide-details":"",dense:t.is_form_dense,items:t.tweet_hashtag_position},model:{value:t.settingsStore.settings.tweet_hashtag_position,callback:function(e){t.$set(t.settingsStore.settings,"tweet_hashtag_position",e)},expression:"settingsStore.settings.tweet_hashtag_position"}})],1),e("div",{staticClass:"settings__item"},[e("div",{staticClass:"settings__item-heading"},[t._v("ツイートするキャプチャに番組タイトルの透かしを描画する")]),e("div",{staticClass:"settings__item-label"},[t._v(" ツイートするキャプチャに、透かしとして視聴中の番組タイトルを描画するかを設定します。"),e("br"),t._v(" 透かしの描画位置は 左上・右上・左下・右下 から選択できます。"),e("br")]),e(Ie.Z,{staticClass:"settings__item-form",attrs:{outlined:"","hide-details":"",dense:t.is_form_dense,items:t.tweet_capture_watermark_position},model:{value:t.settingsStore.settings.tweet_capture_watermark_position,callback:function(e){t.$set(t.settingsStore.settings,"tweet_capture_watermark_position",e)},expression:"settingsStore.settings.tweet_capture_watermark_position"}})],1)]),e(js.Z,{attrs:{value:t.is_twitter_password_auth_sending,"z-index":"300"}},[e(Zs.Z,{attrs:{color:"secondary",indeterminate:"",size:"64"}})],1)],1)},Ps=[];class $s{static async fetchAuthorizationURL(){const t=await G.get("/twitter/auth");return"is_error"in t?(G.showGenericError(t,"Twitter アカウントとの連携用の認証 URL を取得できませんでした。"),null):t.data.authorization_url}static async authWithPassword(t){const e=await G.post("/twitter/password-auth",t);if("is_error"in e){if(e.error.message.startsWith("Failed to authenticate with password")){const t=e.error.message.match(/Message: (.+)\)/)[1];N.error(`ログインに失敗しました。${t}`)}else if(e.error.message.startsWith("Unexpected error occurred while authenticate with password")){const t=e.error.message.match(/Message: (.+)\)/)[1];N.error(`ログインフローの途中で予期せぬエラーが発生しました。${t}`)}else e.error.message.startsWith("Failed to get user information")?N.error("Twitter アカウントのユーザー情報の取得に失敗しました。"):G.showGenericError(e,"Twitter アカウントとの連携に失敗しました。");return!1}return!0}static async logoutAccount(t){const e=await G["delete"](`/twitter/accounts/${t}`);return!("is_error"in e)||(G.showGenericError(e,"Twitter アカウントとの連携を解除できませんでした。"),!1)}static async sendTweet(t,e,s){const i=new FormData;i.append("tweet",e);for(const n of s)i.append("images",n);const a=await G.post(`/twitter/accounts/${t}/tweets`,i,{headers:{"Content-Type":"multipart/form-data"}});return"is_error"in a?a.error.message?Number.isNaN(a.status)?{message:`ツイートの送信に失敗しました。(${a.error.message})`,is_error:!0}:{message:`ツイートの送信に失敗しました。(HTTP Error ${a.status} / ${a.error.message})`,is_error:!0}:{message:`ツイートの送信に失敗しました。(HTTP Error ${a.status})`,is_error:!0}:!0===a.data.is_success?{message:a.data.detail,is_error:!1}:{message:a.data.detail,is_error:!0}}}var zs=$s,As=o["default"].extend({name:"Settings-Twitter",components:{SettingsBase:ke},data(){return{is_form_dense:pt.isSmartphoneHorizontal(),twitter_active_tab:[{text:"ツイート検索タブ",value:"Search"},{text:"タイムラインタブ",value:"Timeline"},{text:"キャプチャタブ",value:"Capture"}],tweet_hashtag_position:[{text:"ツイート本文の前に追加する",value:"Prepend"},{text:"ツイート本文の後に追加する",value:"Append"},{text:"ツイート本文の前に追加してから改行する",value:"PrependWithLineBreak"},{text:"ツイート本文の後に改行してから追加する",value:"AppendWithLineBreak"}],tweet_capture_watermark_position:[{text:"透かしを描画しない",value:"None"},{text:"透かしをキャプチャの左上に描画する",value:"TopLeft"},{text:"透かしをキャプチャの右上に描画する",value:"TopRight"},{text:"透かしをキャプチャの左下に描画する",value:"BottomLeft"},{text:"透かしをキャプチャの右下に描画する",value:"BottomRight"}],is_loading:!0,is_twitter_password_auth_sending:!1,twitter_password_auth_dialog:!1,twitter_screen_name:"",twitter_password:"",twitter_password_showing:!1}},computed:{...(0,a.Kc)(st,R)},async created(){await this.userStore.fetchUser(),this.is_loading=!1},methods:{async loginTwitterAccountWithPasswordForm(){if(!1===this.userStore.is_logged_in)return this.$message.warning("連携をはじめるには、KonomiTV アカウントにログインしてください。"),await pt.sleep(.01),void(this.twitter_password_auth_dialog=!1);this.twitter_password_auth_dialog=!0},async loginTwitterAccountWithPassword(){if(!1===this.$refs.twitter_form.validate())return;this.is_twitter_password_auth_sending=!0;const t=await zs.authWithPassword({screen_name:this.twitter_screen_name,password:this.twitter_password});if(this.is_twitter_password_auth_sending=!1,!1===t)return;if(await this.userStore.fetchUser(!0),null===this.userStore.user)return void this.$message.error("アカウント情報を取得できませんでした。");const e=[...this.userStore.user.twitter_accounts].sort(((t,e)=>t.updated_at<e.updated_at?1:t.updated_at>e.updated_at?-1:0))[0];this.$message.success(`Twitter @${e.screen_name} と連携しました。`),this.$refs.twitter_form.reset(),this.twitter_password_auth_dialog=!1},async logoutTwitterAccount(t){const e=await zs.logoutAccount(t);!1!==e&&(await this.userStore.fetchUser(!0),this.$message.success(`Twitter @${t} との連携を解除しました。`))}}}),Ds=As,Ls=(0,p.Z)(Ds,Bs,Ps,!1,null,"61fbe4ed",null),Ns=Ls.exports,Es=s(756),Ks=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"route-container"},[e("Header"),e("main",[e("Navigation"),e("div",{staticClass:"channels-container channels-container--home",class:{"channels-container--loading":t.is_loading}},[e("v-tabs-fix",{staticClass:"channels-tab",attrs:{centered:""},model:{value:t.tab,callback:function(e){t.tab=e},expression:"tab"}},t._l(Array.from(t.channelsStore.channels_list_with_pinned),(function([s]){return e(Es.Z,{key:s,staticClass:"channels-tab__item"},[t._v(" "+t._s(s)+" ")])})),1),e("v-tabs-items-fix",{staticClass:"channels-list",model:{value:t.tab,callback:function(e){t.tab=e},expression:"tab"}},t._l(Array.from(t.channelsStore.channels_list_with_pinned),(function([s,i]){return e("v-tab-item-fix",{key:s,staticClass:"channels-tabitem"},[e("div",{staticClass:"channels",class:`channels--tab-${s} channels--length-${i.length}`},[t._l(i,(function(s){return e("router-link",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],key:s.id,staticClass:"channel",attrs:{to:`/tv/watch/${s.display_channel_id}`}},[e("div",{staticClass:"channel__broadcaster"},[e("img",{staticClass:"channel__broadcaster-icon",attrs:{src:`${t.Utils.api_base_url}/channels/${s.display_channel_id}/logo`}}),e("div",{staticClass:"channel__broadcaster-content"},[e("span",{staticClass:"channel__broadcaster-name"},[t._v("Ch: "+t._s(s.channel_number)+" "+t._s(s.name))]),e("div",{staticClass:"channel__broadcaster-status"},[e("div",{staticClass:"channel__broadcaster-status-force",class:`channel__broadcaster-status-force--${t.ChannelUtils.getChannelForceType(s.jikkyo_force)}`},[e("Icon",{attrs:{icon:"fa-solid:fire-alt",height:"12px"}}),e("span",{staticClass:"ml-1"},[t._v("勢い:")]),e("span",{staticClass:"ml-1"},[t._v(t._s(s.jikkyo_force??"--"))]),e("span",{staticStyle:{"margin-left":"3px"}},[t._v(" コメ/分")])],1),e("div",{staticClass:"channel__broadcaster-status-viewers ml-4"},[e("Icon",{attrs:{icon:"fa-solid:eye",height:"14px"}}),e("span",{staticClass:"ml-1"},[t._v("視聴数:")]),e("span",{staticClass:"ml-1"},[t._v(t._s(s.viewer_count))])],1)])]),e("div",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"},{name:"tooltip",rawName:"v-tooltip",value:t.isPinnedChannel(s.display_channel_id)?"ピン留めを外す":"ピン留めする",expression:"isPinnedChannel(channel.display_channel_id) ? 'ピン留めを外す' : 'ピン留めする'"}],staticClass:"channel__broadcaster-pin",class:{"channel__broadcaster-pin--pinned":t.isPinnedChannel(s.display_channel_id)},on:{click:function(e){e.preventDefault(),e.stopPropagation(),t.isPinnedChannel(s.display_channel_id)?t.removePinnedChannel(s.display_channel_id):t.addPinnedChannel(s.display_channel_id)},mousedown:function(t){t.preventDefault(),t.stopPropagation()}}},[e("Icon",{attrs:{icon:"fluent:pin-20-filled",width:"24px"}})],1)]),e("div",{staticClass:"channel__program-present"},[e("div",{staticClass:"channel__program-present-title-wrapper"},[e("span",{staticClass:"channel__program-present-title",domProps:{innerHTML:t._s(t.ProgramUtils.decorateProgramInfo(s.program_present,"title"))}}),e("span",{staticClass:"channel__program-present-time"},[t._v(t._s(t.ProgramUtils.getProgramTime(s.program_present)))])]),e("span",{staticClass:"channel__program-present-description",domProps:{innerHTML:t._s(t.ProgramUtils.decorateProgramInfo(s.program_present,"description"))}})]),e(kt.Z),e("div",{staticClass:"channel__program-following"},[e("div",{staticClass:"channel__program-following-title"},[e("span",{staticClass:"channel__program-following-title-decorate"},[t._v("NEXT")]),e("Icon",{staticClass:"channel__program-following-title-icon",attrs:{icon:"fluent:fast-forward-20-filled",width:"16px"}}),e("span",{staticClass:"channel__program-following-title-text",domProps:{innerHTML:t._s(t.ProgramUtils.decorateProgramInfo(s.program_following,"title"))}})],1),e("span",{staticClass:"channel__program-following-time"},[t._v(t._s(t.ProgramUtils.getProgramTime(s.program_following)))])]),e("div",{staticClass:"channel__progressbar"},[e("div",{staticClass:"channel__progressbar-progress",style:`width:${t.ProgramUtils.getProgramProgress(s.program_present)}%;`})])],1)})),"ピン留め"===s&&0===i.length?e("div",{staticClass:"pinned-container d-flex justify-center align-center w-100"},[e("div",{staticClass:"d-flex justify-center align-center flex-column"},[e("h2",[t._v("ピン留めされているチャンネルが"),e("br"),t._v("ありません。")]),e("div",{staticClass:"mt-4 text--text text--darken-1"},[t._v("各チャンネルの "),e("Icon",{staticStyle:{position:"relative",bottom:"-5px"},attrs:{icon:"fluent:pin-20-filled",width:"22px"}}),t._v(" アイコンから、よくみる"),e("br"),t._v("チャンネルをこのタブにピン留めできます。")],1),e("div",{staticClass:"mt-2 text--text text--darken-1"},[t._v("チャンネルをピン留めすると、"),e("br"),t._v("このタブが最初に表示されます。")])])]):t._e()],2)])})),1)],1)],1)],1)},Ms=[];const Hs={id:"NID0-SID0-EID0",channel_id:"NID0-SID0",network_id:0,service_id:0,event_id:0,title:"取得中…",description:"取得中…",detail:{},start_time:"2000-01-01T00:00:00+09:00",end_time:"2000-01-01T00:00:00+09:00",duration:0,is_free:!0,genres:[],video_type:"映像1080i(1125i)、アスペクト比16:9 パンベクトルなし",video_codec:"MPEG-2",video_resolution:"1080i",primary_audio_type:"2/0モード(ステレオ)",primary_audio_language:"日本語",primary_audio_sampling_rate:"48kHz",secondary_audio_type:null,secondary_audio_language:null,secondary_audio_sampling_rate:null},Fs={id:"NID0-SID0",display_channel_id:"gr000",network_id:0,service_id:0,transport_stream_id:null,remocon_id:0,channel_number:"---",type:"GR",name:"取得中…",jikkyo_force:null,is_subchannel:!1,is_radiochannel:!1,is_watchable:!0,is_display:!0,viewer_count:0,program_present:Hs,program_following:Hs};class Vs{static async fetchAll(){const t=await G.get("/channels");return"is_error"in t?(G.showGenericError(t,"チャンネル情報を取得できませんでした。"),null):t.data}static async fetch(t){const e=await G.get(`/channels/${t}`);return"is_error"in e?(G.showGenericError(e,"チャンネル情報を取得できませんでした。"),null):e.data}static async fetchJikkyoSession(t){const e=await G.get(`/channels/${t}/jikkyo`);return"is_error"in e?(G.showGenericError(e,"ニコニコ実況のセッション情報を取得できませんでした。"),null):e.data}}var Rs=Vs;const Us=(0,a.Q_)("channels",{state:()=>({display_channel_id:"gr000",channels_list:{GR:[],BS:[],CS:[],CATV:[],SKY:[],STARDIGIO:[]},is_channels_list_initial_updated:!1,last_updated_at:0}),getters:{is_showing_live(){return"gr000"!==this.display_channel_id},channel(){const t=this.channels_list[A.getChannelType(this.display_channel_id)];if(void 0===t||0===t.length)return{previous:Fs,current:Fs,next:Fs};const e=t.findIndex((t=>t.display_channel_id===this.display_channel_id));if(-1===e){const t={...Fs.program_present,display_channel_id:"gr999",title:"チャンネル情報取得エラー",description:"このチャンネル ID のチャンネル情報は存在しません。"},e={...Fs,display_channel_id:"gr999",name:"ERROR",program_present:t,program_following:t};return{previous:e,current:e,next:e}}const s=(()=>{let s=e-1;while(t.length){if(s<=-1&&(s=t.length-1),t[s].is_display)return s;s--}return 0})(),i=(()=>{let s=e+1;while(t.length){if(s>=t.length&&(s=0),t[s].is_display)return s;s++}return 0})();return{previous:t[s],current:t[e],next:t[i]}},channels_list_with_pinned(){const t=st(),e=new Map;if(e.set("ピン留め",[]),e.set("地デジ",[]),!1===this.is_channels_list_initial_updated)return e;e.set("BS",[]),e.set("CS",[]),e.set("CATV",[]),e.set("SKY",[]),e.set("StarDigio",[]);for(const[s,i]of Object.entries(this.channels_list))for(const a of i)if(!1!==a.is_display)switch(t.settings.pinned_channel_ids.includes(a.display_channel_id)&&e.get("ピン留め")?.push(a),a.type){case"GR":e.get("地デジ")?.push(a);break;case"BS":e.get("BS")?.push(a);break;case"CS":e.get("CS")?.push(a);break;case"CATV":e.get("CATV")?.push(a);break;case"SKY":e.get("SKY")?.push(a);break;case"STARDIGIO":e.get("StarDigio")?.push(a);break}for(const s of[...e.get("ピン留め")]){const i=t.settings.pinned_channel_ids.indexOf(s.display_channel_id);e.get("ピン留め")[i]=s}for(const[s,i]of e)"ピン留め"!==s&&0===i.length&&e.delete(s);return 1===e.size&&e.has("ピン留め")&&e.delete("ピン留め"),e},channels_list_with_pinned_for_watch(){const t=new Map([...this.channels_list_with_pinned]);return 0===t.get("ピン留め")?.length&&t.delete("ピン留め"),t}},actions:{getChannel(t){const e=this.channels_list[A.getChannelType(t)];return void 0===e?null:e.find((e=>e.display_channel_id===t))??null},getChannelByRemoconID(t,e){const s=this.channels_list[t],i=s.find((t=>t.remocon_id===e));return i??null},updateChannel(t,e){const s=A.getChannelType(t);if(void 0===this.channels_list[s])return;const i=this.channels_list[s].findIndex((e=>e.display_channel_id===t));-1!==i&&o["default"].set(this.channels_list[s],i,e)},async update(t=!1){const e=async()=>{const t=await Rs.fetchAll();null!==t&&(this.channels_list=t,this.is_channels_list_initial_updated=!0,this.last_updated_at=pt.time())};!0!==this.is_channels_list_initial_updated||!1!==t?await e():pt.time()-this.last_updated_at>60&&e()}}});var Gs=Us,Ws=o["default"].extend({name:"TV-Home",components:{Header:jt,Navigation:Rt},data(){return{Utils:pt,ChannelUtils:A,ProgramUtils:mt,tab:null,is_loading:!0,interval_ids:[]}},computed:{...(0,a.Kc)(Gs,st)},async created(){0===this.settingsStore.settings.pinned_channel_ids.length&&(this.tab=1);const t=60-(new Date).getSeconds();this.interval_ids.push(window.setTimeout((()=>{this.channelsStore.update(!0),this.interval_ids.push(window.setInterval((()=>this.channelsStore.update(!0)),3e4))}),1e3*t)),await this.channelsStore.update(),await pt.sleep(.01),0===this.channelsStore.channels_list_with_pinned.get("ピン留め")?.length&&(this.tab=1),this.is_loading=!1},beforeDestroy(){for(const t of this.interval_ids)window.clearInterval(t)},methods:{addPinnedChannel(t){this.settingsStore.settings.pinned_channel_ids.push(t);const e=this.channelsStore.getChannel(t);e&&this.$message.show(`${e.name}をピン留めしました。`)},removePinnedChannel(t){this.settingsStore.settings.pinned_channel_ids.splice(this.settingsStore.settings.pinned_channel_ids.indexOf(t),1),0===this.channelsStore.channels_list_with_pinned.get("ピン留め")?.length&&(this.tab=1);const e=this.channelsStore.getChannel(t);e&&this.$message.show(`${e.name}のピン留めを外しました。`)},isPinnedChannel(t){return this.settingsStore.settings.pinned_channel_ids.includes(t)}}}),qs=Ws,Ys=(0,p.Z)(qs,Ks,Ms,!1,null,"b22adce6",null),Xs=Ys.exports,Js=s(17024),Qs=s(57894),ti=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"route-container"},[e("main",{staticClass:"watch-container",class:{"watch-container--control-display":t.is_control_display,"watch-container--panel-display":!(!t.Utils.isSmartphoneVertical()&&!t.Utils.isTabletVertical())||t.is_panel_display,"watch-container--fullscreen":t.is_fullscreen}},[e("nav",{staticClass:"watch-navigation",on:{mousemove:function(e){return t.controlDisplayTimer(e)},touchmove:function(e){return t.controlDisplayTimer(e)},click:function(e){return t.controlDisplayTimer(e)}}},[e("router-link",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],staticClass:"watch-navigation__icon",attrs:{to:"/tv/"}},[e("img",{staticClass:"watch-navigation__icon-image",attrs:{src:"/assets/images/icon.svg",width:"23px"}})]),e("router-link",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"},{name:"tooltip",rawName:"v-tooltip.right",value:"テレビをみる",expression:"'テレビをみる'",modifiers:{right:!0}}],staticClass:"watch-navigation__link",attrs:{"active-class":"watch-navigation__link--active",to:"/tv/"}},[e("Icon",{staticClass:"watch-navigation__link-icon",attrs:{icon:"fluent:tv-20-regular",width:"26px"}})],1),e("router-link",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"},{name:"tooltip",rawName:"v-tooltip.right",value:"ビデオをみる",expression:"'ビデオをみる'",modifiers:{right:!0}}],staticClass:"watch-navigation__link",attrs:{"active-class":"watch-navigation__link--active",to:"/videos/"}},[e("Icon",{staticClass:"watch-navigation__link-icon",attrs:{icon:"fluent:movies-and-tv-20-regular",width:"26px"}})],1),e("router-link",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"},{name:"tooltip",rawName:"v-tooltip.right",value:"番組表",expression:"'番組表'",modifiers:{right:!0}}],staticClass:"watch-navigation__link",attrs:{"active-class":"watch-navigation__link--active",to:"/timetable/"}},[e("Icon",{staticClass:"watch-navigation__link-icon",attrs:{icon:"fluent:calendar-ltr-20-regular",width:"26px"}})],1),e("router-link",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"},{name:"tooltip",rawName:"v-tooltip.right",value:"録画予約",expression:"'録画予約'",modifiers:{right:!0}}],staticClass:"watch-navigation__link",attrs:{"active-class":"watch-navigation__link--active",to:"/reserves/"}},[e("Icon",{staticClass:"watch-navigation__link-icon",staticStyle:{padding:"0.5px"},attrs:{icon:"fluent:timer-16-regular",width:"26px"}})],1),e("router-link",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"},{name:"tooltip",rawName:"v-tooltip.right",value:"マイリスト",expression:"'マイリスト'",modifiers:{right:!0}}],staticClass:"watch-navigation__link",attrs:{"active-class":"watch-navigation__link--active",to:"/mylist/"}},[e("Icon",{staticClass:"watch-navigation__link-icon",attrs:{icon:"ic:round-playlist-play",width:"26px"}})],1),e("router-link",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"},{name:"tooltip",rawName:"v-tooltip.right",value:"キャプチャ",expression:"'キャプチャ'",modifiers:{right:!0}}],staticClass:"watch-navigation__link",attrs:{"active-class":"watch-navigation__link--active",to:"/captures/"}},[e("Icon",{staticClass:"watch-navigation__link-icon",attrs:{icon:"fluent:image-multiple-24-regular",width:"26px"}})],1),e(kt.Z),e("router-link",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"},{name:"tooltip",rawName:"v-tooltip.right",value:"設定",expression:"'設定'",modifiers:{right:!0}}],staticClass:"watch-navigation__link",attrs:{"active-class":"watch-navigation__link--active",to:"/settings/"}},[e("Icon",{staticClass:"watch-navigation__link-icon",attrs:{icon:"fluent:settings-20-regular",width:"26px"}})],1)],1),e("div",{staticClass:"watch-content",on:{mousemove:function(e){return t.controlDisplayTimer(e,!0)},touchmove:function(e){return t.controlDisplayTimer(e,!0)},click:function(e){return t.controlDisplayTimer(e,!0)}}},[e("header",{staticClass:"watch-header"},[e("router-link",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],staticClass:"watch-header__back-icon",attrs:{to:"/tv/"}},[e("Icon",{attrs:{icon:"fluent:arrow-left-12-filled",width:"25px"}})],1),e("img",{staticClass:"watch-header__broadcaster",attrs:{src:`${t.Utils.api_base_url}/channels/${t.channelsStore.display_channel_id}/logo`}}),e("span",{staticClass:"watch-header__program-title",domProps:{innerHTML:t._s(t.ProgramUtils.decorateProgramInfo(t.channelsStore.channel.current.program_present,"title"))}}),e("span",{staticClass:"watch-header__program-time"},[t._v(" "+t._s(t.ProgramUtils.getProgramTime(t.channelsStore.channel.current.program_present,!0))+" ")]),e(kt.Z),e("span",{staticClass:"watch-header__now"},[t._v(t._s(t.time))])],1),e("div",{staticClass:"watch-player",class:{"watch-player--loading":t.is_loading,"watch-player--virtual-keyboard-display":t.is_virtual_keyboard_display&&t.Utils.hasActiveElementClass("dplayer-comment-input")}},[e("div",{staticClass:"watch-player__background-wrapper"},[e("div",{staticClass:"watch-player__background",class:{"watch-player__background--display":t.is_background_display},style:{backgroundImage:`url(${t.background_url})`}},[e("img",{staticClass:"watch-player__background-logo",attrs:{src:"/assets/images/logo.svg"}})])]),e(Zs.Z,{staticClass:"watch-player__buffering",class:{"watch-player__buffering--display":t.is_video_buffering&&(t.is_loading||null!==t.player&&!t.player.video.paused)},attrs:{indeterminate:"",size:"60",width:"6"}}),e("div",{staticClass:"watch-player__dplayer"}),e("div",{staticClass:"watch-player__button",on:{mousemove:function(e){return t.controlDisplayTimer(e)},touchmove:function(e){return t.controlDisplayTimer(e)},click:function(e){return t.controlDisplayTimer(e)}}},[e("div",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"},{name:"tooltip",rawName:"v-tooltip.top",value:"前のチャンネル",expression:"'前のチャンネル'",modifiers:{top:!0}}],staticClass:"switch-button switch-button-up",on:{click:function(e){t.is_zapping=!0,t.$router.push({path:`/tv/watch/${t.channelsStore.channel.previous.display_channel_id}`})}}},[e("Icon",{staticClass:"switch-button-icon",attrs:{icon:"fluent:ios-arrow-left-24-filled",width:"32px",rotate:"1"}})],1),e("div",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],staticClass:"switch-button switch-button-panel switch-button-panel--open",on:{click:function(e){t.is_panel_display=!t.is_panel_display}}},[e("Icon",{staticClass:"switch-button-icon",attrs:{icon:"fluent:navigation-16-filled",width:"32px"}})],1),e("div",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"},{name:"tooltip",rawName:"v-tooltip.bottom",value:"次のチャンネル",expression:"'次のチャンネル'",modifiers:{bottom:!0}}],staticClass:"switch-button switch-button-down",on:{click:function(e){t.is_zapping=!0,t.$router.push({path:`/tv/watch/${t.channelsStore.channel.next.display_channel_id}`})}}},[e("Icon",{staticClass:"switch-button-icon",attrs:{icon:"fluent:ios-arrow-right-24-filled",width:"33px",rotate:"1"}})],1)])],1)]),e("div",{staticClass:"watch-panel",on:{mousemove:function(e){return t.controlDisplayTimer(e)}}},[e("div",{staticClass:"watch-panel__header"},[e("div",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],staticClass:"panel-close-button",on:{click:function(e){t.is_panel_display=!1}}},[e("Icon",{staticClass:"panel-close-button__icon",attrs:{icon:"akar-icons:chevron-right",width:"25px"}}),e("span",{staticClass:"panel-close-button__text"},[t._v("閉じる")])],1),e(kt.Z),e("div",{staticClass:"panel-broadcaster"},[e("img",{staticClass:"panel-broadcaster__icon",attrs:{src:`${t.Utils.api_base_url}/channels/${t.channelsStore.display_channel_id}/logo`}}),e("div",{staticClass:"panel-broadcaster__number"},[t._v(t._s(t.channelsStore.channel.current.channel_number))]),e("div",{staticClass:"panel-broadcaster__name"},[t._v(t._s(t.channelsStore.channel.current.name))])])],1),e("div",{staticClass:"watch-panel__content-container"},[e("Program",{staticClass:"watch-panel__content",class:{"watch-panel__content--active":"Program"===t.tv_panel_active_tab}}),e("Channel",{staticClass:"watch-panel__content",class:{"watch-panel__content--active":"Channel"===t.tv_panel_active_tab}}),e("Comment",{ref:"Comment",staticClass:"watch-panel__content",class:{"watch-panel__content--active":"Comment"===t.tv_panel_active_tab},attrs:{channel:t.channelsStore.channel.current,player:t.player}}),e("Twitter",{ref:"Twitter",staticClass:"watch-panel__content",class:{"watch-panel__content--active":"Twitter"===t.tv_panel_active_tab},attrs:{player:t.player,is_virtual_keyboard_display:t.is_virtual_keyboard_display},on:{panel_folding_requested:function(e){t.is_panel_display=!1}}}),e("button",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],staticClass:"watch-panel__content-remocon-button elevation-8",class:{"watch-panel__content-remocon-button--active":"Program"===t.tv_panel_active_tab||"Channel"===t.tv_panel_active_tab},on:{click:function(e){t.is_remocon_display=!t.is_remocon_display}}},[e("Icon",{staticClass:"panel-close-button__icon",attrs:{icon:"material-symbols:remote-gen",width:"25px"}})],1),e("Remocon",{staticClass:"watch-panel__remocon",attrs:{showing:("Program"===t.tv_panel_active_tab||"Channel"===t.tv_panel_active_tab)&&!0===t.is_remocon_display},on:{close:function(e){t.is_remocon_display=!1}}})],1),e("div",{staticClass:"watch-panel__navigation"},[e("div",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],staticClass:"panel-navigation-button",class:{"panel-navigation-button--active":"Program"===t.tv_panel_active_tab},on:{click:function(e){t.tv_panel_active_tab="Program"}}},[e("Icon",{staticClass:"panel-navigation-button__icon",attrs:{icon:"fa-solid:info-circle",width:"33px"}}),e("span",{staticClass:"panel-navigation-button__text"},[t._v("番組情報")])],1),e("div",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],staticClass:"panel-navigation-button",class:{"panel-navigation-button--active":"Channel"===t.tv_panel_active_tab},on:{click:function(e){t.tv_panel_active_tab="Channel"}}},[e("Icon",{staticClass:"panel-navigation-button__icon",attrs:{icon:"fa-solid:broadcast-tower",width:"34px"}}),e("span",{staticClass:"panel-navigation-button__text"},[t._v("チャンネル")])],1),e("div",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],staticClass:"panel-navigation-button",class:{"panel-navigation-button--active":"Comment"===t.tv_panel_active_tab},on:{click:function(e){t.tv_panel_active_tab="Comment"}}},[e("Icon",{staticClass:"panel-navigation-button__icon",attrs:{icon:"bi:chat-left-text-fill",width:"29px"}}),e("span",{staticClass:"panel-navigation-button__text"},[t._v("コメント")])],1),e("div",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],staticClass:"panel-navigation-button",class:{"panel-navigation-button--active":"Twitter"===t.tv_panel_active_tab},on:{click:function(e){t.tv_panel_active_tab="Twitter"}}},[e("Icon",{staticClass:"panel-navigation-button__icon",attrs:{icon:"fa-brands:twitter",width:"34px"}}),e("span",{staticClass:"panel-navigation-button__text"},[t._v("Twitter")])],1)])])]),e(le.Z,{attrs:{"max-width":"1050",transition:"slide-y-transition"},model:{value:t.shortcut_key_modal,callback:function(e){t.shortcut_key_modal=e},expression:"shortcut_key_modal"}},[e(ht.Z,[e(gt.EB,{staticClass:"px-5 pt-4 pb-3 d-flex align-center font-weight-bold"},[e("Icon",{attrs:{icon:"fluent:keyboard-20-filled",height:"28px"}}),e("span",{staticClass:"ml-3"},[t._v("キーボードショートカット")]),e(kt.Z),e("div",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],staticClass:"d-flex align-center rounded-circle cursor-pointer px-2 py-2",on:{click:function(e){t.shortcut_key_modal=!1}}},[e("Icon",{attrs:{icon:"fluent:dismiss-12-filled",width:"23px",height:"23px"}})],1)],1),e("div",{staticClass:"px-5 pb-4"},[e(Qs.Z,t._l(t.shortcut_key_list,(function(s,i){return e(Js.Z,{key:i,attrs:{cols:"6"}},t._l(s,(function(s){return e("div",{key:s.name,staticClass:"mt-3"},[e("div",{staticClass:"text-subtitle-1 d-flex align-center font-weight-bold"},[e("Icon",{attrs:{icon:s.icon,height:s.icon_height}}),e("span",{staticClass:"ml-2"},[t._v(t._s(s.name))])],1),t._l(s.shortcuts,(function(s){return e("div",{key:s.name,staticClass:"mt-3"},[e("div",{staticClass:"text-subtitle-2 mt-2 d-flex align-center font-weight-medium"},[e("span",{staticClass:"mr-2",domProps:{innerHTML:t._s(s.name)}}),e("div",{staticClass:"ml-auto d-flex align-center flex-shrink-0"},t._l(s.keys,(function(i,a){return e("div",{key:i.name,staticClass:"ml-auto d-flex align-center"},[e("span",{staticClass:"shortcut-key"},[t._l(i.name.split(";"),(function(t){return e("Icon",{directives:[{name:"show",rawName:"v-show",value:!0===i.icon,expression:"key.icon === true"}],key:t,attrs:{icon:t,height:"18px"}})})),!1===i.icon?e("span",{domProps:{innerHTML:t._s(i.name)}}):t._e()],2),a<s.keys.length-1?e("span",{staticClass:"shortcut-key-plus"},[t._v("+")]):t._e()])})),0)])])}))],2)})),0)})),1)],1)],1)],1),e("BottomNavigation")],1)},ei=[],si=s(5953),ii=s.n(si),ai=s(82527),ni=s.n(ai),ri=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"channels-container channels-container--watch"},[e("v-tabs-fix",{staticClass:"channels-tab",attrs:{centered:"","show-arrows":""},model:{value:t.tab,callback:function(e){t.tab=e},expression:"tab"}},t._l(Array.from(t.channelsStore.channels_list_with_pinned_for_watch),(function([s]){return e(Es.Z,{key:s,staticClass:"channels-tab__item"},[t._v(" "+t._s(s)+" ")])})),1),e("div",{staticClass:"channels-list-container"},[e("v-tabs-items-fix",{staticClass:"channels-list",model:{value:t.tab,callback:function(e){t.tab=e},expression:"tab"}},t._l(Array.from(t.channelsStore.channels_list_with_pinned_for_watch),(function([s,i]){return e("v-tab-item-fix",{key:s,staticClass:"channels"},t._l(i,(function(s){return e("router-link",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],key:s.id,staticClass:"channel",attrs:{to:`/tv/watch/${s.display_channel_id}`}},[e("div",{staticClass:"channel__broadcaster"},[e("img",{staticClass:"channel__broadcaster-icon",attrs:{src:`${t.Utils.api_base_url}/channels/${s.display_channel_id}/logo`}}),e("div",{staticClass:"channel__broadcaster-content"},[e("span",{staticClass:"channel__broadcaster-name"},[t._v("Ch: "+t._s(s.channel_number)+" "+t._s(s.name))]),e("div",{staticClass:"channel__broadcaster-force",class:`channel__broadcaster-force--${t.ChannelUtils.getChannelForceType(s.jikkyo_force)}`},[e("Icon",{attrs:{icon:"fa-solid:fire-alt",height:"11px"}}),e("span",{staticClass:"ml-1"},[t._v(t._s(s.jikkyo_force??"--"))])],1)])]),e("div",{staticClass:"channel__program-present"},[e("span",{staticClass:"channel__program-present-title",domProps:{innerHTML:t._s(t.ProgramUtils.decorateProgramInfo(s.program_present,"title"))}}),e("span",{staticClass:"channel__program-present-time"},[t._v(t._s(t.ProgramUtils.getProgramTime(s.program_present)))])]),e("div",{staticClass:"channel__program-following"},[e("div",{staticClass:"channel__program-following-title"},[e("span",{staticClass:"channel__program-following-title-decorate"},[t._v("NEXT")]),e("Icon",{staticClass:"channel__program-following-title-icon",attrs:{icon:"fluent:fast-forward-20-filled",width:"16px"}}),e("span",{staticClass:"channel__program-following-title-text",domProps:{innerHTML:t._s(t.ProgramUtils.decorateProgramInfo(s.program_following,"title"))}})],1),e("span",{staticClass:"channel__program-following-time"},[t._v(t._s(t.ProgramUtils.getProgramTime(s.program_following)))])]),e("div",{staticClass:"channel__progressbar"},[e("div",{staticClass:"channel__progressbar-progress",style:`width:${t.ProgramUtils.getProgramProgress(s.program_present)}%;`})])])})),1)})),1)],1)],1)},oi=[],li=o["default"].extend({name:"Panel-ChannelTab",data(){return{Utils:pt,ChannelUtils:A,ProgramUtils:mt,tab:null}},computed:{...(0,a.Kc)(Gs)}}),ci=li,_i=(0,p.Z)(ci,ri,oi,!1,null,"1773876a",null),di=_i.exports,ui=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"comment-container"},[e("section",{staticClass:"comment-header"},[e("h2",{staticClass:"comment-header__title"},[e("Icon",{staticClass:"comment-header__title-icon",attrs:{icon:"bi:chat-left-text-fill",height:"18.5px"}}),e("span",{staticClass:"comment-header__title-text"},[t._v("コメント")])],1),e("button",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],staticClass:"comment-header__button ml-auto",on:{click:function(e){t.comment_mute_settings_modal=!t.comment_mute_settings_modal}}},[e("Icon",{attrs:{icon:"heroicons-solid:filter",height:"11px"}}),e("span",{staticClass:"ml-1"},[t._v("ミュート設定")])],1)]),e("section",{ref:"comment_list_wrapper",staticClass:"comment-list-wrapper"},[e("div",{staticClass:"comment-list-dropdown",class:{"comment-list-dropdown--display":t.is_comment_list_dropdown_display},style:{"--comment-list-dropdown-top":`${t.comment_list_dropdown_top}px`}},[e(me.Z,{staticStyle:{background:"var(--v-background-lighten1)"}},[e(pe.Z,{staticStyle:{"min-height":"30px"},attrs:{dense:""},on:{click:function(e){return t.addMutedKeywords()}}},[e(he.V9,{staticClass:"d-flex align-center"},[e("Icon",{attrs:{icon:"fluent:comment-dismiss-20-filled",width:"20px"}}),e("span",{staticClass:"ml-2"},[t._v("このコメントをミュート")])],1)],1),e(pe.Z,{staticStyle:{"min-height":"30px"},attrs:{dense:""},on:{click:function(e){return t.addMutedNiconicoUserIds()}}},[e(he.V9,{staticClass:"d-flex align-center"},[e("Icon",{attrs:{icon:"fluent:person-prohibited-20-filled",width:"20px"}}),e("span",{staticClass:"ml-2"},[t._v("このコメントの投稿者をミュート")])],1)],1)],1)],1),e("div",{staticClass:"comment-list-cover",class:{"comment-list-cover--display":t.is_comment_list_dropdown_display},on:{click:function(e){return t.hideCommentListDropdown()}}}),e("DynamicScroller",{staticClass:"comment-list",attrs:{direction:"vertical",items:t.comment_list,"min-item-size":34},scopedSlots:t._u([{key:"default",fn:function({item:s,active:i}){return[e("DynamicScrollerItem",{attrs:{item:s,active:i,"size-dependencies":[s.text]}},[e("div",{staticClass:"comment",class:{"comment--my-post":s.my_post}},[e("span",{staticClass:"comment__text"},[t._v(t._s(s.text))]),e("span",{staticClass:"comment__time"},[t._v(t._s(s.time))]),e("div",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple",value:!t.Utils.isTouchDevice(),expression:"!Utils.isTouchDevice()"}],staticClass:"comment__icon",on:{mouseup:function(e){return t.showCommentListDropdown(e,s)},touchend:function(e){return t.showCommentListDropdown(e,s)}}},[e("Icon",{attrs:{icon:"fluent:more-vertical-20-filled",width:"20px"}})],1)])])]}}])}),null===t.initialize_failed_message&&0===t.comment_list.length?e("div",{staticClass:"comment-announce"},[e("div",{staticClass:"comment-announce__heading"},[t._v("まだコメントがありません。")]),t._m(0)]):t._e(),null!==t.initialize_failed_message&&0===t.comment_list.length?e("div",{staticClass:"comment-announce"},[e("div",{staticClass:"comment-announce__heading"},[t._v("コメントがありません。")]),e("div",{staticClass:"comment-announce__text"},[e("p",{staticClass:"mt-0 mb-0"},[t._v(t._s(t.initialize_failed_message))])])]):t._e()],1),e("div",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],staticClass:"comment-scroll-button elevation-5",class:{"comment-scroll-button--display":t.is_manual_scroll},on:{click:function(e){t.is_manual_scroll=!1,t.scrollCommentList(!0)}}},[e("Icon",{attrs:{icon:"fluent:arrow-down-12-filled",height:"29px"}})],1),e("CommentMuteSettings",{model:{value:t.comment_mute_settings_modal,callback:function(e){t.comment_mute_settings_modal=e},expression:"comment_mute_settings_modal"}})],1)},mi=[function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"comment-announce__text"},[e("p",{staticClass:"mt-0 mb-0"},[t._v("このチャンネルに対応するニコニコ実況のコメントが、リアルタイムで表示されます。")])])}];class pi{constructor(t){this.watch_session=null,this.comment_session=null,this.vpos_base_timestamp=0,this.keep_seat_interval_id=null,this.abort_controller=new AbortController,this.player=t.player,this.display_channel_id=t.display_channel_id,this.on_initial_comments_received=t.on_initial_comments_received,this.on_comment_received=t.on_comment_received}async initSession(){const t=await this.initWatchSession();return!1===t.is_success?{is_success:!1,detail:t.detail}:(this.initCommentSession(t),{is_success:!0,detail:"視聴セッションを初期化しました。"})}async initWatchSession(){let t=!1;const e=await Rs.fetchJikkyoSession(this.display_channel_id);return null===e?{is_success:!1,detail:"ニコニコ実況のセッション情報を取得できませんでした。"}:!1===e.is_success?(console.error(`[LiveCommentManager][WatchSession] Error: ${e.detail}`),"このチャンネルはニコニコ実況に対応していません。"!==e.detail&&"現在放送中のニコニコ実況がありません。"!==e.detail&&this.player.notice(e.detail,void 0,void 0,"#FF6F6A"),{is_success:!1,detail:e.detail}):(this.watch_session=new WebSocket(e.audience_token),this.watch_session.addEventListener("open",(()=>{this.watch_session?.send(JSON.stringify({type:"startWatching",data:{reconnect:!1}}))}),{signal:this.abort_controller.signal}),this.watch_session.addEventListener("close",(async e=>{!0!==t&&(console.error(`[LiveCommentManager][WatchSession] Connection closed. (Code: ${e.code})`),this.player.notice(`ニコニコ実況との接続が切断されました。(Code: ${e.code})`,void 0,void 0,"#FF6F6A"),await pt.sleep(10),await this.reconnect())}),{signal:this.abort_controller.signal}),this.watch_session.addEventListener("message",(async e=>{if(null===this.watch_session)return;const s=JSON.parse(e.data);switch(s.type){case"seat":if(null!==this.keep_seat_interval_id)break;this.keep_seat_interval_id=window.setInterval((()=>{this.watch_session&&this.watch_session.readyState===WebSocket.OPEN?this.watch_session.send(JSON.stringify({type:"keepSeat"})):window.clearInterval(this.keep_seat_interval_id??0)}),1e3*s.data.keepIntervalSec);break;case"ping":this.watch_session.send(JSON.stringify({type:"pong"}));break;case"error":{if("COMMENT_POST_NOT_ALLOWED"===s.data.code||"INVALID_MESSAGE"===s.data.code)break;let t=`ニコニコ実況でエラーが発生しています。(Code: ${s.data.code})`;switch(s.data.code){case"CONNECT_ERROR":t="ニコニコ実況のコメントサーバーに接続できません。";break;case"CONTENT_NOT_READY":t="ニコニコ実況が配信できない状態です。";break;case"NO_THREAD_AVAILABLE":t="ニコニコ実況のコメントスレッドを取得できません。";break;case"NO_ROOM_AVAILABLE":t="ニコニコ実況のコメント部屋を取得できません。";break;case"NO_PERMISSION":t="ニコニコ実況の API にアクセスする権限がありません。";break;case"NOT_ON_AIR":t="ニコニコ実況が放送中ではありません。";break;case"BROADCAST_NOT_FOUND":t="ニコニコ実況の配信情報を取得できません。";break;case"INTERNAL_SERVERERROR":t="ニコニコ実況でサーバーエラーが発生しています。";break}console.error(`[LiveCommentManager][WatchSession] Error occurred. (Code: ${s.data.code})`),this.player.notice(t,void 0,void 0,"#FF6F6A"),await pt.sleep(5),await this.reconnect();break}case"reconnect":await this.reconnect();break;case"disconnect":{t=!0;let e=`ニコニコ実況との接続が切断されました。(${s.data.reason})`;switch(s.data.reason){case"TAKEOVER":e="ニコニコ実況の番組から追い出されました。";break;case"NO_PERMISSION":e="ニコニコ実況の番組の座席を取得できませんでした。";break;case"END_PROGRAM":e="ニコニコ実況がリセットされたか、コミュニティの番組が終了しました。";break;case"PING_TIMEOUT":e="コメントサーバーとの接続生存確認に失敗しました。";break;case"TOO_MANY_CONNECTIONS":e="ニコニコ実況の同一ユーザからの接続数上限を越えています。";break;case"TOO_MANY_WATCHINGS":e="ニコニコ実況の同一ユーザからの視聴番組数上限を越えています。";break;case"CROWDED":e="ニコニコ実況の番組が満席です。";break;case"MAINTENANCE_IN":e="ニコニコ実況はメンテナンス中です。";break;case"SERVICE_TEMPORARILY_UNAVAILABLE":e="ニコニコ実況で一時的にサーバーエラーが発生しています。";break}console.error(`[LiveCommentManager][WatchSession] Disconnected. (Reason: ${s.data.reason})`),this.player.notice(e),await pt.sleep(5),await this.reconnect();break}}}),{signal:this.abort_controller.signal}),new Promise((t=>{this.watch_session.addEventListener("message",(async e=>{const s=JSON.parse(e.data);if("room"===s.type)return this.vpos_base_timestamp=rt()(s.data.vposBaseTime).valueOf(),console.log(`[LiveCommentManager][WatchSession] Connected.\nThread ID: ${s.data.threadId}\n`),t({is_success:!0,detail:"視聴セッションを取得しました。",message_server_url:s.data.messageServer.uri,thread_id:s.data.threadId,your_post_key:s.data.yourPostKey?s.data.yourPostKey:null})}),{signal:this.abort_controller.signal})})))}initCommentSession(t){const e=[];let s=!1;this.comment_session=new WebSocket(t.message_server_url),this.comment_session.addEventListener("open",(()=>{null!==this.comment_session&&this.comment_session.send(JSON.stringify([{ping:{content:"rs:0"}},{ping:{content:"ps:0"}},{thread:{version:"20061206",thread:t.thread_id,threadkey:t.your_post_key,user_id:"",res_from:-50}},{ping:{content:"pf:0"}},{ping:{content:"rf:0"}}]))}),{signal:this.abort_controller.signal}),this.comment_session.addEventListener("message",(async t=>{const i=JSON.parse(t.data);if(void 0!==i.thread&&0!==i.thread.resultcode)return void console.error(`[LiveCommentManager][CommentSession] Connection failed. (Code: ${i.thread.resultcode})`);if(void 0!==i.ping&&"rf:0"===i.ping.content)return s=!0,void this.on_initial_comments_received(e);const a=i.chat;if(void 0===a||void 0===a.content||""===a.content||a.yourpost&&1===a.yourpost)return;const{color:n,position:r,size:o}=it.parseCommentCommand(a.mail);if(it.isMutedComment(a.content,a.user_id,n,r,o))return;const l={id:a.no,text:a.content,time:rt()(1e3*a.date).format("HH:mm:ss"),user_id:a.user_id,my_post:!1};if(!1===s)return void e.push(l);let c=0;this.player.video.buffered.length>=1&&(c=this.player.video.buffered.end(0));const _=c-this.player.video.currentTime;await pt.sleep(_),this.on_comment_received(l),!1===this.player.video.paused&&this.player.danmaku.draw({text:a.content,color:n,type:r,size:o})}),{signal:this.abort_controller.signal})}sendComment(t){const e={"#FFEAEA":"white","#F02840":"red","#FD7E80":"pink","#FDA708":"orange","#FFE133":"yellow","#64DD17":"green","#00D4F5":"cyan","#4763FF":"blue"},s={top:"ue",right:"naka",bottom:"shita"},i=Math.round((rt()().valueOf()-this.vpos_base_timestamp)/10);if(null===this.watch_session||this.watch_session.readyState!==WebSocket.OPEN)return console.error("[LiveCommentManager][WatchSession] Comment sending failed. (Connection is not established.)"),void t.error("コメントの送信に失敗しました。WebSocket 接続が確立されていません。");this.watch_session.send(JSON.stringify({type:"postComment",data:{text:t.data.text,color:e[t.data.color.toUpperCase()],position:s[t.data.type],size:t.data.size,vpos:i,isAnonymous:!0}}));const a=new AbortController;this.watch_session.addEventListener("message",(e=>{const s=JSON.parse(e.data);switch(s.type){case"postCommentResult":t.success(),a.abort();break;case"error":{let e=`コメントの送信に失敗しました。(${s.data.code})`;switch(s.data.code){case"COMMENT_POST_NOT_ALLOWED":e="コメントが許可されていません。";break;case"INVALID_MESSAGE":e="コメント内容が無効です。";break}console.error(`[LiveCommentManager][WatchSession] Comment sending failed. (Code: ${s.data.code})`),t.error(e),a.abort();break}}}),{signal:a.signal})}async reconnect(){console.warn("[LiveCommentManager][WatchSession] Reconnecting..."),this.player.notice("ニコニコ実況に再接続しています…"),this.destroy();const t=await this.initSession();!1===t.is_success&&(console.error("[LiveCommentManager][WatchSession] Reconnection failed."),this.player.notice(t.detail,void 0,void 0,"#FF6F6A"))}destroy(){this.abort_controller.abort(),this.abort_controller=new AbortController,null!==this.watch_session&&(this.watch_session.close(),this.watch_session=null),null!==this.comment_session&&(this.comment_session.close(),this.comment_session=null),null!==this.keep_seat_interval_id&&(window.clearInterval(this.keep_seat_interval_id),this.keep_seat_interval_id=null),this.vpos_base_timestamp=0,console.log("[LiveCommentManager][WatchSession] Destroyed.")}}var hi=pi,gi=o["default"].extend({name:"Panel-CommentTab",components:{CommentMuteSettings:gs},data(){return{Utils:pt,is_manual_scroll:!1,is_auto_scrolling:!1,comment_list:[],comment_list_element:null,is_comment_list_dropdown_display:!1,comment_list_dropdown_top:0,comment_list_dropdown_comment:null,live_comment_manager:null,initialize_failed_message:null,visibilitychange_listener:null,resize_observer:null,comment_mute_settings_modal:!1,player:null}},computed:{...(0,a.Kc)(R)},created(){this.userStore.fetchUser()},mounted(){null===this.comment_list_element&&(this.comment_list_element=this.$el.querySelector(".comment-list"));let t=!1;this.comment_list_element.onmousedown=e=>{if(null===this.comment_list_element)return;const s=e.clientX-this.comment_list_element.getBoundingClientRect().left;s>this.comment_list_element.clientWidth&&(t=!0)},this.comment_list_element.onmouseup=e=>{if(null===this.comment_list_element)return;const s=e.clientX-this.comment_list_element.getBoundingClientRect().left;s>this.comment_list_element.clientWidth&&(t=!1)};const e=()=>{t=!0,window.setTimeout((()=>t=!1),100)};let s=!1;this.comment_list_element.ontouchstart=()=>s=!0,this.comment_list_element.ontouchend=()=>s=!1,this.comment_list_element.ontouchmove=()=>!0===s?e():"",this.comment_list_element.onwheel=e,this.comment_list_element.onscroll=async()=>{null!==this.comment_list_element&&!1===this.is_auto_scrolling&&!0===t&&(this.is_manual_scroll=!0,await pt.sleep(.1),this.comment_list_element.scrollTop+this.comment_list_element.offsetHeight>this.comment_list_element.scrollHeight-10&&(this.is_manual_scroll=!1))}},beforeDestroy(){this.destroy(),null!==this.resize_observer&&this.resize_observer.disconnect()},methods:{showCommentListDropdown(t,e){const s=this.$refs.comment_list_wrapper.getBoundingClientRect(),i=76,a=t.currentTarget.getBoundingClientRect();this.comment_list_dropdown_top=a.top-s.top,this.comment_list_dropdown_top+i>s.height&&(this.comment_list_dropdown_top=this.comment_list_dropdown_top-i+a.height),this.comment_list_dropdown_comment=e,this.is_comment_list_dropdown_display=!0},hideCommentListDropdown(){this.is_comment_list_dropdown_display=!1,this.comment_list=this.comment_list.filter((t=>!1===it.isMutedComment(t.text,t.user_id)))},addMutedKeywords(){null!==this.comment_list_dropdown_comment&&(it.addMutedKeywords(this.comment_list_dropdown_comment.text),this.hideCommentListDropdown())},addMutedNiconicoUserIds(){null!==this.comment_list_dropdown_comment&&(it.addMutedNiconicoUserIDs(this.comment_list_dropdown_comment.user_id),this.hideCommentListDropdown())},async scrollCommentList(t=!1){if(null!==this.comment_list_element&&(!0===this.is_comment_list_dropdown_display&&(this.is_manual_scroll=!0),!0!==this.is_manual_scroll)){this.is_auto_scrolling=!0;for(let e=0;e<3;e++)await pt.sleep(.01),!0===t?this.comment_list_element.scrollTo({top:this.comment_list_element.scrollHeight,left:0,behavior:"smooth"}):this.comment_list_element.scrollTo(0,this.comment_list_element.scrollHeight);await pt.sleep(.1),this.is_auto_scrolling=!1}},initReserveObserver(){null!==this.resize_observer&&this.resize_observer.disconnect();const t=document.querySelector(".watch-player"),e=()=>{const e=this.player?.template.danmaku,s=e.clientWidth,i=e.clientWidth*(9/16);if(null===t||null===t.clientHeight)return;const a=(t.clientHeight-i)/2,n=pt.isSmartphoneVertical()?0:window.matchMedia("(max-height: 450px)").matches?50:66;if(a<n){const t=2*(n-a),r=s,o=i-t,l=(t,e)=>0===e?t:l(e,t%e),c=l(r,o),_=`${r/c} / ${o/c}`;e.style.transition="none",e.style.setProperty("--comment-area-aspect-ratio",_),e.style.setProperty("--comment-area-vertical-margin",`${t}px`),window.setTimeout((()=>{e.style.transition=""}),200)}else e.style.removeProperty("--comment-area-aspect-ratio"),e.style.removeProperty("--comment-area-vertical-margin")};this.resize_observer=new ResizeObserver(e),this.resize_observer.observe(t),window.setTimeout(e,600)},async initSession(t,e){this.player=t,this.initReserveObserver();const s=[],i=500;this.live_comment_manager=new hi({player:t,display_channel_id:e,on_initial_comments_received:async t=>{this.comment_list.push(...t),this.scrollCommentList()},on_comment_received:async t=>{"hidden"!==document.visibilityState?(this.comment_list.length>=i&&!1===this.is_manual_scroll&&this.comment_list.splice(0,Math.max(0,this.comment_list.length-i)),this.comment_list.push(t),this.scrollCommentList()):s.push(t)}}),this.visibilitychange_listener=()=>{if("visible"===document.visibilityState){const t=this.comment_list.length+s.length;t>=i&&!1===this.is_manual_scroll&&this.comment_list.splice(0,Math.max(0,t-i)),this.comment_list.push(...s),s.length=0,this.scrollCommentList()}},document.addEventListener("visibilitychange",this.visibilitychange_listener);const a=await this.live_comment_manager.initSession();!1===a.is_success&&(this.initialize_failed_message=a.detail)},sendComment(t){null===this.initialize_failed_message?null!==this.userStore.user?null!==this.userStore.user.niconico_user_id?!1!==this.userStore.user.niconico_user_premium||"top"!==t.data.type&&"bottom"!==t.data.type?!1!==this.userStore.user.niconico_user_premium||"big"!==t.data.size?this.live_comment_manager?.sendComment(t):t.error("コメントサイズを大きめに設定するには、ニコニコアカウントのプレミアム会員登録が必要です。"):t.error("コメントを上下に固定するには、ニコニコアカウントのプレミアム会員登録が必要です。"):t.error("コメントするには、ニコニコアカウントと連携してください。"):t.error("コメントするには、KonomiTV アカウントにログインしてください。"):t.error(this.initialize_failed_message)},destroy(){null!==this.visibilitychange_listener&&(document.removeEventListener("visibilitychange",this.visibilitychange_listener),this.visibilitychange_listener=null),null!==this.live_comment_manager&&(this.live_comment_manager.destroy(),this.live_comment_manager=null),this.initialize_failed_message=null,this.comment_list=[]}}}),vi=gi,fi=(0,p.Z)(vi,ui,mi,!1,null,"df07fabe",null),wi=fi.exports,bi=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"program-container"},[e("section",{staticClass:"program-broadcaster"},[e("img",{staticClass:"program-broadcaster__icon",attrs:{src:`${t.Utils.api_base_url}/channels/${t.channelsStore.display_channel_id}/logo`}}),e("div",{staticClass:"program-broadcaster__number"},[t._v("Ch: "+t._s(t.channelsStore.channel.current.channel_number))]),e("div",{staticClass:"program-broadcaster__name"},[t._v(t._s(t.channelsStore.channel.current.name))])]),e("section",{staticClass:"program-info"},[e("h1",{staticClass:"program-info__title",domProps:{innerHTML:t._s(t.ProgramUtils.decorateProgramInfo(t.channelsStore.channel.current.program_present,"title"))}}),e("div",{staticClass:"program-info__time"},[t._v(" "+t._s(t.ProgramUtils.getProgramTime(t.channelsStore.channel.current.program_present))+" ")]),e("div",{staticClass:"program-info__description",domProps:{innerHTML:t._s(t.ProgramUtils.decorateProgramInfo(t.channelsStore.channel.current.program_present,"description"))}}),e("div",{staticClass:"program-info__genre-container"},t._l(t.channelsStore.channel.current.program_present?.genres??[],(function(s,i){return e("div",{key:i,staticClass:"program-info__genre"},[t._v(" "+t._s(s.major)+" / "+t._s(s.middle)+" ")])})),0),e("div",{staticClass:"program-info__next"},[e("span",{staticClass:"program-info__next-decorate"},[t._v("NEXT")]),e("Icon",{staticClass:"program-info__next-icon",attrs:{icon:"fluent:fast-forward-20-filled",width:"16px"}})],1),e("span",{staticClass:"program-info__next-title",domProps:{innerHTML:t._s(t.ProgramUtils.decorateProgramInfo(t.channelsStore.channel.current.program_following,"title"))}}),e("div",{staticClass:"program-info__next-time"},[t._v(" "+t._s(t.ProgramUtils.getProgramTime(t.channelsStore.channel.current.program_following))+" ")]),e("div",{staticClass:"program-info__status"},[e("div",{staticClass:"program-info__status-force",class:`program-info__status-force--${t.ChannelUtils.getChannelForceType(t.channelsStore.channel.current.jikkyo_force)}`},[e("Icon",{attrs:{icon:"fa-solid:fire-alt",height:"14px"}}),e("span",{staticClass:"ml-2"},[t._v("勢い:")]),e("span",{staticClass:"ml-2"},[t._v(t._s(t.channelsStore.channel.current.jikkyo_force??"--")+" コメ/分")])],1),e("div",{staticClass:"program-info__status-viewers ml-5"},[e("Icon",{attrs:{icon:"fa-solid:eye",height:"14px"}}),e("span",{staticClass:"ml-2"},[t._v("視聴数:")]),e("span",{staticClass:"ml-1"},[t._v(t._s(t.channelsStore.channel.current.viewer_count))])],1)])]),e("section",{staticClass:"program-detail-container"},t._l(t.channelsStore.channel.current.program_present?.detail??{},(function(s,i){return e("div",{key:i,staticClass:"program-detail"},[e("h2",{staticClass:"program-detail__heading"},[t._v(t._s(i))]),e("div",{staticClass:"program-detail__text",domProps:{innerHTML:t._s(t.Utils.URLtoLink(s))}})])})),0)])},yi=[],Ci=o["default"].extend({name:"Panel-ProgramTab",data(){return{Utils:pt,ChannelUtils:A,ProgramUtils:mt}},computed:{...(0,a.Kc)(Gs)}}),ki=Ci,xi=(0,p.Z)(ki,bi,yi,!1,null,"710b8382",null),Si=xi.exports,Oi=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"remote-control-container",class:{"remote-control-container--showing":t.showing},on:{click:function(e){return t.$emit("close")}}},[e("div",{staticClass:"remote-control elevation-6",on:{click:function(t){t.stopPropagation()}}},[e("div",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],staticClass:"remote-control__close d-flex align-center rounded-circle cursor-pointer px-2 py-2",on:{click:function(e){return t.$emit("close")}}},[e("Icon",{attrs:{icon:"fluent:dismiss-12-filled",width:"23px",height:"23px"}})],1),e("div",{staticClass:"remote-control-data-broadcasting remote-control-data-broadcasting--disabled"},[e(Zs.Z,{staticClass:"remote-control__loading",attrs:{indeterminate:"",size:"60",width:"6"}}),e("div",{staticClass:"remote-control__directional-key"},[e("button",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],staticClass:"remote-control-button-up",attrs:{"data-arib-key-code":"1"}},[e("Icon",{attrs:{icon:"fluent:chevron-up-12-filled",width:"26px",height:"26px"}})],1),e("button",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],staticClass:"remote-control-button-left",attrs:{"data-arib-key-code":"3"}},[e("Icon",{attrs:{icon:"fluent:chevron-left-12-filled",width:"26px",height:"26px"}})],1),e("button",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],staticClass:"remote-control-button-select",attrs:{"data-arib-key-code":"18"}},[t._v(" 決定 ")]),e("button",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],staticClass:"remote-control-button-right",attrs:{"data-arib-key-code":"4"}},[e("Icon",{attrs:{icon:"fluent:chevron-right-12-filled",width:"26px",height:"26px"}})],1),e("button",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],staticClass:"remote-control-button-down",attrs:{"data-arib-key-code":"2"}},[e("Icon",{attrs:{icon:"fluent:chevron-down-12-filled",width:"26px",height:"26px"}})],1)]),e("div",{staticClass:"remote-control__control-key"},[e("button",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],staticClass:"remote-control-button-data",attrs:{"data-arib-key-code":"20"}},[e("svg",{attrs:{width:"20px",height:"20px",viewBox:"0 0 512 512"}},[e("path",{attrs:{fill:"currentColor",d:"M248.039 381.326L355.039 67.8258C367.539 28.3257 395.039 34.3258 406.539 34.3258C431.039 34.3258 453.376 61.3258 441.039 96.8258C362.639 322.426 343.539 375.326 340.539 384.826C338.486 391.326 342.039 391.326 345.539 391.326C377.039 391.326 386.539 418.326 386.539 435.326C386.539 458.826 371.539 477.326 350.039 477.326H214.539C179.039 477.326 85.8269 431.3 88.0387 335.826C91.0387 206.326 192.039 183.326 243.539 183.326H296.539L265.539 272.326H243.539C185.539 272.326 174.113 314.826 176.039 334.326C180.039 374.826 215.039 389.814 237.039 390.326C244.539 390.5 246.039 386.826 248.039 381.326Z"}})]),e("span",{staticClass:"ml-1"},[t._v("データ")])]),e("button",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],staticClass:"remote-control-button-back",attrs:{"data-arib-key-code":"19"}},[e("Icon",{attrs:{icon:"fluent:arrow-left-12-filled",width:"20px"}}),e("span",{staticClass:"ml-1"},[t._v("戻る")])],1),e("button",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],staticClass:"remote-control-button-blue blue darken-3",attrs:{"data-arib-key-code":"21"}},[t._v("青")]),e("button",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],staticClass:"remote-control-button-red red darken-3",attrs:{"data-arib-key-code":"22"}},[t._v("赤")]),e("button",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],staticClass:"remote-control-button-green green darken-3",attrs:{"data-arib-key-code":"23"}},[t._v("緑")]),e("button",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],staticClass:"remote-control-button-yellow yellow darken-3",attrs:{"data-arib-key-code":"24"}},[t._v("黄")])])],1),e("div",{staticClass:"remote-control__number-key"},[e("button",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],attrs:{"data-remocon-id":"1","data-arib-key-code":"6"}},[t._v("1")]),e("button",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],attrs:{"data-remocon-id":"2","data-arib-key-code":"7"}},[t._v("2")]),e("button",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],attrs:{"data-remocon-id":"3","data-arib-key-code":"8"}},[t._v("3")]),e("button",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],attrs:{"data-remocon-id":"4","data-arib-key-code":"9"}},[t._v("4")]),e("button",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],attrs:{"data-remocon-id":"5","data-arib-key-code":"10"}},[t._v("5")]),e("button",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],attrs:{"data-remocon-id":"6","data-arib-key-code":"11"}},[t._v("6")]),e("button",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],attrs:{"data-remocon-id":"7","data-arib-key-code":"12"}},[t._v("7")]),e("button",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],attrs:{"data-remocon-id":"8","data-arib-key-code":"13"}},[t._v("8")]),e("button",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],attrs:{"data-remocon-id":"9","data-arib-key-code":"14"}},[t._v("9")]),e("button",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],attrs:{"data-remocon-id":"10","data-arib-key-code":"15"}},[t._v("10")]),e("button",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],attrs:{"data-remocon-id":"11","data-arib-key-code":"16"}},[t._v("11")]),e("button",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],attrs:{"data-remocon-id":"12","data-arib-key-code":"17"}},[t._v("12")])])])])},Ti=[],Ii=o["default"].extend({name:"Panel-Remocon",props:{showing:{type:Boolean,required:!0}}}),ji=Ii,Zi=(0,p.Z)(ji,Oi,Ti,!1,null,"b659b524",null),Bi=Zi.exports,Pi=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"twitter-container"},[e(le.Z,{attrs:{"content-class":"zoom-capture-modal-container","max-width":"980",transition:"slide-y-transition"},model:{value:t.zoom_capture_modal,callback:function(e){t.zoom_capture_modal=e},expression:"zoom_capture_modal"}},[e("div",{staticClass:"zoom-capture-modal"},[e("img",{staticClass:"zoom-capture-modal__image",attrs:{src:t.zoom_capture?t.zoom_capture.image_url:""}}),e("a",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],staticClass:"zoom-capture-modal__download",attrs:{href:t.zoom_capture?t.zoom_capture.image_url:"",download:t.zoom_capture?t.zoom_capture.filename:""}},[e("Icon",{attrs:{icon:"fa6-solid:download",width:"45px"}})],1)])]),e("div",{staticClass:"tab-container"},[e("div",{staticClass:"tab-content tab-content--search",class:{"tab-content--active":"Search"===t.twitter_active_tab}},[e("div",{staticClass:"search px-4"},[t._v(" リアルタイム検索機能は鋭意開発中です。 ")])]),e("div",{staticClass:"tab-content tab-content--timeline",class:{"tab-content--active":"Timeline"===t.twitter_active_tab}},[e("div",{staticClass:"search px-4"},[t._v(" タイムライン機能は鋭意開発中です。 ")])]),e("div",{staticClass:"tab-content tab-content--capture",class:{"tab-content--active":"Capture"===t.twitter_active_tab}},[e("div",{staticClass:"captures"},t._l(t.captures,(function(s){return e("div",{key:s.image_url,staticClass:"capture",class:{"capture--selected":s.selected,"capture--focused":s.focused,"capture--disabled":!s.selected&&t.tweet_captures.length>=4},on:{click:function(e){return t.clickCapture(s)}}},[e("img",{staticClass:"capture__image",attrs:{src:s.image_url}}),e("div",{staticClass:"capture__disabled-cover"}),e("div",{staticClass:"capture__selected-number"},[t._v(t._s(t.tweet_captures.findIndex((t=>t===s.blob))+1))]),e("Icon",{staticClass:"capture__selected-checkmark",attrs:{icon:"fluent:checkmark-circle-16-filled"}}),e("div",{staticClass:"capture__selected-border"}),e("div",{staticClass:"capture__focused-border"}),e("div",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],staticClass:"capture__zoom",on:{click:function(e){e.preventDefault(),e.stopPropagation(),t.zoom_capture_modal=!0,t.zoom_capture=s},mousedown:function(t){t.preventDefault(),t.stopPropagation()}}},[e("Icon",{attrs:{icon:"fluent:zoom-in-16-regular",width:"32px"}})],1)],1)})),0),e("div",{directives:[{name:"show",rawName:"v-show",value:0===t.captures.length,expression:"captures.length === 0"}],staticClass:"capture-announce"},[e("div",{staticClass:"capture-announce__heading"},[t._v("まだキャプチャがありません。")]),t._m(0)])])]),e("div",{staticClass:"tab-button-container"},[e("div",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],staticClass:"tab-button",class:{"tab-button--active":"Search"===t.twitter_active_tab},on:{click:function(e){t.twitter_active_tab="Search"}}},[e("Icon",{attrs:{icon:"fluent:search-16-filled",height:"18px"}}),e("span",{staticClass:"tab-button__text"},[t._v("ツイート検索")])],1),e("div",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],staticClass:"tab-button",class:{"tab-button--active":"Timeline"===t.twitter_active_tab},on:{click:function(e){t.twitter_active_tab="Timeline"}}},[e("Icon",{attrs:{icon:"fluent:home-16-regular",height:"18px"}}),e("span",{staticClass:"tab-button__text"},[t._v("タイムライン")])],1),e("div",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],staticClass:"tab-button",class:{"tab-button--active":"Capture"===t.twitter_active_tab},on:{click:function(e){t.twitter_active_tab="Capture"}}},[e("Icon",{attrs:{icon:"fluent:image-copy-20-regular",height:"18px"}}),e("span",{staticClass:"tab-button__text"},[t._v("キャプチャ")])],1)]),e("div",{staticClass:"tweet-form",class:{"tweet-form--focused":t.is_tweet_hashtag_form_focused||t.is_tweet_text_form_focused,"tweet-form--virtual-keyboard-display":t.is_virtual_keyboard_display&&(t.Utils.hasActiveElementClass("tweet-form__hashtag-form")||t.Utils.hasActiveElementClass("tweet-form__textarea"))&&(()=>(t.is_hashtag_list_display=!1,!0))()}},[e("div",{staticClass:"tweet-form__hashtag"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.tweet_hashtag,expression:"tweet_hashtag"}],staticClass:"tweet-form__hashtag-form",attrs:{type:"search",placeholder:"#ハッシュタグ",spellcheck:"false"},domProps:{value:t.tweet_hashtag},on:{input:[function(e){e.target.composing||(t.tweet_hashtag=e.target.value)},function(e){return t.updateTweetLetterCount()}],focus:function(e){t.is_tweet_hashtag_form_focused=!0},blur:function(e){t.is_tweet_hashtag_form_focused=!1},change:function(e){t.tweet_hashtag=t.formatHashtag(t.tweet_hashtag),t.updateTweetLetterCount()}}}),e("div",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],staticClass:"tweet-form__hashtag-list-button",on:{click:function(e){return t.clickHashtagListButton()}}},[e("Icon",{attrs:{icon:"fluent:clipboard-text-ltr-32-regular",height:"22px"}})],1)]),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.tweet_text,expression:"tweet_text"}],ref:"tweet_text",staticClass:"tweet-form__textarea",attrs:{placeholder:"ツイート",spellcheck:"false"},domProps:{value:t.tweet_text},on:{input:[function(e){e.target.composing||(t.tweet_text=e.target.value)},function(e){return t.updateTweetLetterCount()}],paste:function(e){return t.pasteClipboardData(e)},focus:function(e){t.is_tweet_text_form_focused=!0},blur:function(e){t.is_tweet_text_form_focused=!1}}}),e("div",{staticClass:"tweet-form__control"},[e("div",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],staticClass:"account-button",class:{"account-button--no-login":!t.is_logged_in_twitter},on:{click:function(e){return t.clickAccountButton()}}},[e("img",{staticClass:"account-button__icon",attrs:{src:t.is_logged_in_twitter?t.selected_twitter_account?.icon_url:"/assets/images/account-icon-default.png"}}),e("span",{staticClass:"account-button__screen-name"},[t._v(" "+t._s(t.is_logged_in_twitter?`@${t.selected_twitter_account?.screen_name}`:"連携されていません")+" ")]),e("Icon",{staticClass:"account-button__menu",attrs:{icon:"fluent:more-circle-20-regular",width:"22px"}})],1),e("div",{staticClass:"limit-meter"},[e("div",{staticClass:"limit-meter__content",class:{"limit-meter__content--yellow":t.tweet_letter_count<=20,"limit-meter__content--red":t.tweet_letter_count<=0}},[e("Icon",{staticStyle:{"margin-right":"-2px"},attrs:{icon:"fa-brands:twitter",width:"12px"}}),e("span",[t._v(t._s(t.tweet_letter_count))])],1),e("div",{staticClass:"limit-meter__content"},[e("Icon",{attrs:{icon:"fluent:image-16-filled",width:"14px"}}),e("span",[t._v(t._s(t.tweet_captures.length)+"/4")])],1)]),e("button",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],staticClass:"tweet-button",attrs:{disabled:!t.is_logged_in_twitter||t.tweet_letter_count<0||140===t.tweet_letter_count&&0===t.tweet_captures.length},on:{click:function(e){return t.sendTweet()},touchstart:function(e){return t.sendTweet()}}},[e("Icon",{attrs:{icon:"fa-brands:twitter",height:"16px"}}),e("span",{staticClass:"ml-1"},[t._v("ツイート")])],1)])]),e("div",{staticClass:"hashtag-list",class:{"hashtag-list--display":t.is_hashtag_list_display,"hashtag-list--virtual-keyboard-display":t.is_virtual_keyboard_display&&t.Utils.hasActiveElementClass("hashtag__input")}},[e("div",{staticClass:"hashtag-heading"},[e("div",{staticClass:"hashtag-heading__text"},[e("Icon",{attrs:{icon:"charm:hash",width:"17px"}}),e("span",{staticClass:"ml-1"},[t._v("ハッシュタグリスト")])],1),e("button",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],staticClass:"hashtag-heading__add-button",on:{click:function(e){t.saved_twitter_hashtags.push({id:t.Utils.time(),text:"#ここにハッシュタグを入力",editing:!1})}}},[e("Icon",{attrs:{icon:"fluent:add-12-filled",width:"17px"}}),e("span",{staticClass:"ml-1"},[t._v("追加")])],1)]),e("draggable",{staticClass:"hashtag-container",attrs:{handle:".hashtag__sort-handle"},model:{value:t.saved_twitter_hashtags,callback:function(e){t.saved_twitter_hashtags=e},expression:"saved_twitter_hashtags"}},t._l(t.saved_twitter_hashtags,(function(s){return e("div",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple",value:!s.editing,expression:"!hashtag.editing"}],key:s.id,staticClass:"hashtag",class:{"hashtag--editing":s.editing},on:{click:function(e){return t.clickHashtag(s)}}},[e("input",{directives:[{name:"model",rawName:"v-model",value:s.text,expression:"hashtag.text"}],staticClass:"hashtag__input",attrs:{type:"search",spellcheck:"false",disabled:!s.editing},domProps:{value:s.text},on:{click:function(t){t.stopPropagation()},input:function(e){e.target.composing||t.$set(s,"text",e.target.value)}}}),e("button",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],staticClass:"hashtag__edit-button",on:{click:function(e){e.preventDefault(),e.stopPropagation(),s.editing=!s.editing,s.text=t.formatHashtag(s.text,!0),t.updateTweetLetterCount()}}},[e("Icon",{attrs:{icon:s.editing?"fluent:checkmark-16-filled":"fluent:edit-16-filled",width:"17px"}})],1),e("button",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],staticClass:"hashtag__delete-button",on:{click:function(e){e.preventDefault(),e.stopPropagation(),t.saved_twitter_hashtags.splice(t.saved_twitter_hashtags.indexOf(s),1)}}},[e("Icon",{attrs:{icon:"fluent:delete-16-filled",width:"17px"}})],1),e("div",{staticClass:"hashtag__sort-handle"},[e("Icon",{attrs:{icon:"material-symbols:drag-handle-rounded",width:"17px"}})],1)])})),0)],1),e("div",{staticClass:"twitter-account-list",class:{"twitter-account-list--display":t.is_twitter_account_list_display}},t._l(t.userStore.user?t.userStore.user.twitter_accounts:[],(function(s){return e("div",{directives:[{def:xt.Z,name:"ripple",rawName:"v-ripple"}],key:s.id,staticClass:"twitter-account",on:{click:function(e){return t.updateSelectedTwitterAccount(s)}}},[e("img",{staticClass:"twitter-account__icon",attrs:{src:s.icon_url}}),e("div",{staticClass:"twitter-account__info"},[e("div",{staticClass:"twitter-account__name"},[t._v(t._s(s.name))]),e("div",{staticClass:"twitter-account__screen-name"},[t._v("@"+t._s(s.screen_name))])]),e("Icon",{directives:[{name:"show",rawName:"v-show",value:s.id===t.settingsStore.settings.selected_twitter_account_id,expression:"twitter_account.id === settingsStore.settings.selected_twitter_account_id"}],staticClass:"twitter-account__check",attrs:{icon:"fluent:checkmark-16-filled",width:"24px"}})],1)})),0)],1)},$i=[function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"capture-announce__text"},[e("p",{staticClass:"mt-0 mb-0"},[t._v("プレイヤーのキャプチャボタンやショートカットキーでキャプチャを撮ると、ここに表示されます。")]),e("p",{staticClass:"mt-2 mb-0"},[t._v("表示されたキャプチャを選択してからツイートすると、キャプチャを付けてツイートできます。")])])}],zi=s(9980),Ai=s.n(zi),Di=o["default"].extend({name:"Panel-TwitterTab",components:{draggable:Ai()},props:{player:{type:null,required:!0},is_virtual_keyboard_display:{type:Boolean,required:!0}},data(){return{Utils:pt,is_logged_in_twitter:!1,selected_twitter_account:null,is_twitter_account_list_display:!1,saved_twitter_hashtags:st().settings.saved_twitter_hashtags.map(((t,e)=>({id:pt.time()+e,text:t,editing:!1}))),is_hashtag_list_display:!1,twitter_active_tab:st().settings.twitter_active_tab,zoom_capture_modal:!1,zoom_capture:null,captures:[],captures_element:null,is_tweet_hashtag_form_focused:!1,is_tweet_text_form_focused:!1,tweet_hashtag:"",tweet_text:"",tweet_captures:[],tweet_letter_count:140,is_tweet_sending:!1}},computed:{...(0,a.Kc)(Gs,st,R)},async created(){if(await this.userStore.fetchUser(),!0===this.userStore.is_logged_in&&this.userStore.user&&this.userStore.user.twitter_accounts.length>0){this.is_logged_in_twitter=!0,null!==this.settingsStore.settings.selected_twitter_account_id&&this.userStore.user.twitter_accounts.some((t=>t.id===this.settingsStore.settings.selected_twitter_account_id))||(this.settingsStore.settings.selected_twitter_account_id=this.userStore.user.twitter_accounts[0].id);const t=this.userStore.user.twitter_accounts.findIndex((t=>t.id===this.settingsStore.settings.selected_twitter_account_id));this.selected_twitter_account=this.userStore.user.twitter_accounts[t]}this.tweet_hashtag=this.formatHashtag(this.tweet_hashtag),this.updateTweetLetterCount()},beforeDestroy(){for(const t of this.captures)URL.revokeObjectURL(t.image_url)},watch:{saved_twitter_hashtags:{deep:!0,handler(){this.settingsStore.settings.saved_twitter_hashtags=this.saved_twitter_hashtags.map((t=>t.text))}}},methods:{updateTweetLetterCount(){this.tweet_letter_count=140-[...this.tweet_hashtag].length-[...this.tweet_text].length},pasteClipboardData(t){if(null!==t.clipboardData)for(const e of t.clipboardData.items)if(e.type.startsWith("image/")){const t=e.getAsFile();t&&this.addCaptureList(t,t.name)}},clickHashtagListButton(){this.is_hashtag_list_display=!this.is_hashtag_list_display;for(const t of this.saved_twitter_hashtags)t.editing=!1},clickHashtag(t){this.tweet_hashtag=t.text,this.tweet_hashtag=this.formatHashtag(this.tweet_hashtag),this.updateTweetLetterCount(),window.setTimeout((()=>this.is_hashtag_list_display=!1),150)},clickAccountButton(){if(!this.is_logged_in_twitter)return document.fullscreenElement&&document.exitFullscreen(),void this.$router.push({path:"/settings/twitter"});this.is_twitter_account_list_display=!this.is_twitter_account_list_display,!0===this.is_twitter_account_list_display&&(this.is_hashtag_list_display=!1)},updateSelectedTwitterAccount(t){this.settingsStore.settings.selected_twitter_account_id=t.id,this.selected_twitter_account=t,window.setTimeout((()=>this.is_twitter_account_list_display=!1),150)},clickCapture(t){if(this.tweet_captures.length<4&&!1===t.selected)t.selected=!0,this.tweet_captures.push(t.blob);else{const e=this.tweet_captures.findIndex((e=>e===t.blob));e>-1&&this.tweet_captures.splice(e,1),t.selected=!1}},async addCaptureList(t,e){null===this.captures_element&&(this.captures_element=this.$el.querySelector(".tab-content--capture")),this.captures.length>50&&(URL.revokeObjectURL(this.captures[0].image_url),this.captures.shift());const s=URL.createObjectURL(t);this.captures.push({blob:t,filename:e,image_url:s,selected:!1,focused:!1}),this.$nextTick((()=>{null!==this.captures_element&&this.captures_element.scrollTo({top:this.captures_element.scrollHeight,behavior:"smooth"})}))},async drawProgramTitleOnCapture(t){const e=await createImageBitmap(t),s="OffscreenCanvas"in window?new OffscreenCanvas(e.width,e.height):document.createElement("canvas"),i=s.getContext("2d",{alpha:!1,desynchronized:!0,willReadFrequently:!1});i.drawImage(e,0,0),e.close(),i.font='bold 22px "YakuHanJPs", "Open Sans", "Hiragino Sans", "Noto Sans JP", sans-serif',i.fillStyle="rgba(255, 255, 255, 70%)",i.shadowColor="rgba(0, 0, 0, 100%)",i.shadowBlur=4,i.shadowOffsetX=0,i.shadowOffsetY=0;const a=this.channelsStore.channel.current.program_present?.title??"放送休止";switch(this.settingsStore.settings.tweet_capture_watermark_position){case"TopLeft":i.textAlign="left",i.textBaseline="top",i.fillText(a,16,12);break;case"TopRight":i.textAlign="right",i.textBaseline="top",i.fillText(a,s.width-16,12);break;case"BottomLeft":i.textAlign="left",i.textBaseline="bottom",i.fillText(a,16,s.height-12);break;case"BottomRight":i.textAlign="right",i.textBaseline="bottom",i.fillText(a,s.width-16,s.height-12);break}return s instanceof OffscreenCanvas?await s.convertToBlob({type:"image/jpeg",quality:1}):new Promise(((t,e)=>s.toBlob((s=>{null===s?e():t(s)}),"image/jpeg",1)))},getChannelHashtag(t){return t.startsWith("NHK総合")?"#nhk":t.startsWith("NHKEテレ")?"#etv":t.startsWith("日テレ")?"#ntv":t.startsWith("読売テレビ")?"#ytv":t.startsWith("中京テレビ")?"#chukyotv":t.startsWith("テレビ朝日")?"#tvasahi":t.startsWith("ABCテレビ")?"#abc":t.startsWith("メ~テレ")?"#nagoyatv":t.startsWith("TBS")&&!t.includes("TBSチャンネル")?"#tbs":t.startsWith("MBS")?"#mbs":t.startsWith("CBC")?"#cbc":t.startsWith("テレビ東京")?"#tvtokyo":t.startsWith("テレビ大阪")?"#tvo":t.startsWith("テレビ愛知")?"#tva":t.startsWith("フジテレビ")?"#fujitv":t.startsWith("関西テレビ")?"#kantele":t.startsWith("東海テレビ")?"#tokaitv":t.startsWith("TOKYO MX")?"#tokyomx":t.startsWith("tvk")?"#tvk":t.startsWith("チバテレ")?"#chibatv":t.startsWith("テレ玉")?"#teletama":t.startsWith("サンテレビ")?"#suntv":t.startsWith("KBS京都")?"#kbs":t.startsWith("NHKBS1")?"#nhkbs1":t.startsWith("NHKBSプレミアム")?"#nhkbsp":t.startsWith("BS日テレ")?"#bsntv":t.startsWith("BS朝日")?"#bsasahi":t.startsWith("BS-TBS")?"#bstbs":t.startsWith("BSテレ東")?"#bstvtokyo":t.startsWith("BSフジ")?"#bsfuji":t.startsWith("BS11イレブン")?"#bs11":t.startsWith("BS12トゥエルビ")?"#bs12":t.startsWith("AT-X")?"#at_x":null},formatHashtag(t,e=!1){const s=t.trim().replaceAll("♯","#").replaceAll("＃","#").replace(/#{2,}/g,"#").replaceAll("　"," ").replaceAll(/ +/g," ").split(" ").filter((t=>""!==t));for(let i in s)s[i].startsWith("#")||(s[i]=`#${s[i]}`);if(!0===this.settingsStore.settings.auto_add_watching_channel_hashtag&&!1===e){const t=this.getChannelHashtag(this.channelsStore.channel.current.name);null!==t&&!1===s.includes(t)&&s.push(t)}return s.join(" ")},async sendTweet(){if(null===this.selected_twitter_account)return;if(!0===this.is_tweet_sending)return;this.is_tweet_sending=!0,this.tweet_hashtag=this.formatHashtag(this.tweet_hashtag),this.updateTweetLetterCount();const t=this.tweet_hashtag;let e=this.tweet_text;if(""!==t)switch(this.settingsStore.settings.tweet_hashtag_position){case"Prepend":e=`${t} ${this.tweet_text}`;break;case"Append":e=`${this.tweet_text} ${t}`;break;case"PrependWithLineBreak":e=`${t}\n${this.tweet_text}`;break;case"AppendWithLineBreak":e=`${this.tweet_text}\n${t}`;break}const s=[];for(let i of this.tweet_captures)"None"!==this.settingsStore.settings.tweet_capture_watermark_position&&(i=await this.drawProgramTitleOnCapture(i)),s.push(i);zs.sendTweet(this.selected_twitter_account.screen_name,e,s).then((t=>{this.player.notice(t.message,void 0,void 0,t.is_error?"#FF6F6A":void 0)}));for(const i of this.captures)i.selected=!1,i.focused=!1;this.tweet_captures=[],this.tweet_text="",this.is_tweet_sending=!1,!0===this.settingsStore.settings.fold_panel_after_sending_tweet&&(this.$emit("panel_folding_requested"),this.$refs.tweet_text.blur())}}}),Li=Di,Ni=(0,p.Z)(Li,Pi,$i,!1,null,"51116497",null),Ei=Ni.exports,Ki=(s(23767),s(8585),s(68696),s(59908)),Mi=s(88488);class Hi{static async uploadCapture(t,e){const s=new FormData;s.append("image",t,e);const i=await G.post("/captures",s,{headers:{"Content-Type":"multipart/form-data"}});if("is_error"in i)switch(i.error.message){case"Permission denied to save the file":N.error("キャプチャのアップロードに失敗しました。保存先フォルダに書き込み権限がありません。");break;case"No space left on the device":N.error("キャプチャのアップロードに失敗しました。保存先フォルダに空き容量がありません。");break;case"Unexpected error occurred while saving the file":N.error("キャプチャのアップロードに失敗しました。保存中に予期しないエラーが発生しました。");break;default:G.showGenericError(i,"キャプチャのアップロードに失敗しました。");break}else;}}var Fi=Hi;let Vi=null,Ri=null;class Ui{constructor(t){this.settings_store=st(),this.player=t.player,this.player_container=this.player.container,this.captured_callback=t.captured_callback,this.player_container.querySelector(".dplayer-icons.dplayer-icons-right").insertAdjacentHTML("afterbegin",'\n            <div class="dplayer-icon dplayer-comment-capture-icon" aria-label="コメントを付けてキャプチャ"\n                data-balloon-nofocus="" data-balloon-pos="up">\n                <span class="dplayer-icon-content">\n                    <svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 32 32"><path d="M16 23c-3.309 0-6-2.691-6-6s2.691-6 6-6 6 2.691 6 6-2.691 6-6 6zM16 13c-2.206 0-4 1.794-4 4s1.794 4 4 4c2.206 0 4-1.794 4-4s-1.794-4-4-4zM27 28h-22c-1.654 0-3-1.346-3-3v-16c0-1.654 1.346-3 3-3h3c0.552 0 1 0.448 1 1s-0.448 1-1 1h-3c-0.551 0-1 0.449-1 1v16c0 0.552 0.449 1 1 1h22c0.552 0 1-0.448 1-1v-16c0-0.551-0.448-1-1-1h-11c-0.552 0-1-0.448-1-1s0.448-1 1-1h11c1.654 0 3 1.346 3 3v16c0 1.654-1.346 3-3 3zM24 10.5c0 0.828 0.672 1.5 1.5 1.5s1.5-0.672 1.5-1.5c0-0.828-0.672-1.5-1.5-1.5s-1.5 0.672-1.5 1.5zM15 4c0 0.552-0.448 1-1 1h-4c-0.552 0-1-0.448-1-1v0c0-0.552 0.448-1 1-1h4c0.552 0 1 0.448 1 1v0z"></path></svg>\n                </span>\n            </div>\n        '),this.player_container.querySelector(".dplayer-icons.dplayer-icons-right").insertAdjacentHTML("afterbegin",'\n            <div class="dplayer-icon dplayer-capture-icon" aria-label="キャプチャ"\n                data-balloon-nofocus="" data-balloon-pos="up">\n                <span class="dplayer-icon-content">\n                    <svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 32 32"><path d="M16 23c-3.309 0-6-2.691-6-6s2.691-6 6-6 6 2.691 6 6-2.691 6-6 6zM16 13c-2.206 0-4 1.794-4 4s1.794 4 4 4c2.206 0 4-1.794 4-4s-1.794-4-4-4zM27 28h-22c-1.654 0-3-1.346-3-3v-16c0-1.654 1.346-3 3-3h3c0.552 0 1 0.448 1 1s-0.448 1-1 1h-3c-0.551 0-1 0.449-1 1v16c0 0.552 0.449 1 1 1h22c0.552 0 1-0.448 1-1v-16c0-0.551-0.448-1-1-1h-11c-0.552 0-1-0.448-1-1s0.448-1 1-1h11c1.654 0 3 1.346 3 3v16c0 1.654-1.346 3-3 3zM24 10.5c0 0.828 0.672 1.5 1.5 1.5s1.5-0.672 1.5-1.5c0-0.828-0.672-1.5-1.5-1.5s-1.5 0.672-1.5 1.5zM15 4c0 0.552-0.448 1-1 1h-4c-0.552 0-1-0.448-1-1v0c0-0.552 0.448-1 1-1h4c0.552 0 1 0.448 1 1v0z"></path></svg>\n                </span>\n            </div>\n        '),this.comment_capture_button=this.player_container.querySelector(".dplayer-comment-capture-icon"),this.capture_button=this.player_container.querySelector(".dplayer-capture-icon"),(async()=>{const t="https://cdn.jsdelivr.net/npm/noto-sans-japanese@1.0.0/fonts/NotoSansJP-Bold.woff2",e="https://cdn.jsdelivr.net/npm/open-sans-all@0.1.3/fonts/open-sans-700.woff2",s="data:font/woff2;base64,";if(null===Vi){const e=(await G.get(t,{responseType:"arraybuffer"})).data;Vi=s+D.Buffer.from(e).toString("base64")}if(null===Ri){const t=(await G.get(e,{responseType:"arraybuffer"})).data;Ri=s+D.Buffer.from(t).toString("base64")}})()}async captureAndSave(t){const e=pt.time(),s=Gs(),i=s.is_showing_live?s.channel.current:null;if(null!==i&&!0===i.is_radiochannel)return void this.player.notice("ラジオチャンネルはキャプチャできません。",void 0,void 0,"#FF6F6A");if(0===this.player.video.videoWidth&&0===this.player.video.videoHeight)return void this.player.notice("読み込み中はキャプチャできません。",void 0,void 0,"#FF6F6A");if(!0===t&&!1===this.player.danmaku.showing)return void this.player.notice("コメントを付けてキャプチャするには、コメント表示をオンにしてください。",void 0,void 0,"#FF6F6A");this.addHighlight(t);const a=`Capture_${rt()().format("YYYYMMDD-HHmmss")}`,n=`${a}.jpg`,r=`${a}_caption.jpg`,o=this.player.plugins.aribb24Caption,l=this.player.plugins.aribb24Superimpose??null,c=o.getRawCanvas(),_=l?.getRawCanvas()??null,d=!0===o.isShowing&&o.isPresent(),u=l&&!0===l.isShowing&&l.isPresent(),m=d?o.getTextContent():null;let p;p=null!==i?{network_id:i.network_id,service_id:i.service_id,event_id:i.program_present?.event_id??-1,title:i.program_present?.title??"放送休止",description:i.program_present?.description??"",start_time:i.program_present?.start_time??"2000-01-01T00:00:00+09:00",end_time:i.program_present?.end_time??"2000-01-01T00:00:00+09:00",duration:i.program_present?.duration??0,caption_text:m,is_caption_composited:!1,is_comment_composited:!1}:{network_id:-1,service_id:-1,event_id:-1,title:"録画番組",description:"",start_time:"2000-01-01T00:00:00+09:00",end_time:"2000-01-01T00:00:00+09:00",duration:0,caption_text:m,is_caption_composited:!1,is_comment_composited:!1};const h=async(t,e,s)=>{const i=pt.time();let a;try{a=await this.exportToBlob(t)}catch(n){return console.log(n),this.player.notice("キャプチャの保存に失敗しました。",void 0,void 0,"#FF6F6A"),!1}return console.log("[CaptureManager] Export to Blob:",pt.mathFloor(pt.time()-i,3),"sec"),a=await this.setEXIFDataToCapture(a,s),["Browser","Both"].includes(this.settings_store.settings.capture_save_mode)&&pt.downloadBlobData(a,e),["UploadServer","Both"].includes(this.settings_store.settings.capture_save_mode)&&Fi.uploadCapture(a,e),a};let g=null,v=null;const f=await createImageBitmap(this.player.video);if(!1!==t||!1!==u||!1!==d&&"VideoOnly"!==this.settings_store.settings.capture_caption_mode){const e=[],s="OffscreenCanvas"in window?new OffscreenCanvas(this.player.video.videoWidth,this.player.video.videoHeight):document.createElement("canvas");s.width=this.player.video.videoWidth,s.height=this.player.video.videoHeight;const i=s.getContext("2d",{alpha:!1,desynchronized:!0,willReadFrequently:!1});i.drawImage(f,0,0,s.width,s.height),_&&!0===u&&i.drawImage(_,0,0,s.width,s.height);let a=null;!0===t&&(a=await this.createCommentsImage(),await this.drawComments(s,i,a)),(["VideoOnly","Both"].includes(this.settings_store.settings.capture_caption_mode)||!1===d)&&e.push((async()=>{const e="CompositingCaption"===this.settings_store.settings.capture_caption_mode?r:n,i=await h(s,e,{...p,is_caption_composited:!1,is_comment_composited:t});g=!1!==i&&{blob:i,filename:e},!1!==g&&this.captured_callback(g.blob,g.filename)})()),["CompositingCaption","Both"].includes(this.settings_store.settings.capture_caption_mode)&&!0===d&&e.push((async()=>{!0===t&&(i.drawImage(f,0,0,s.width,s.height),_&&!0===u&&i.drawImage(_,0,0,s.width,s.height)),f.close(),i.drawImage(c,0,0,s.width,s.height),!0===t&&null!==a&&await this.drawComments(s,i,a);const e=await h(s,r,{...p,is_caption_composited:!0,is_comment_composited:t});if(v=!1!==e&&{blob:e,filename:r},!1!==v){if("Both"===this.settings_store.settings.capture_caption_mode)while(null===g)await pt.sleep(.01);this.captured_callback(v.blob,v.filename)}})()),await Promise.all(e)}else{const t="OffscreenCanvas"in window?new OffscreenCanvas(f.width,f.height):document.createElement("canvas");t.width=f.width,t.height=f.height;const e=t.getContext("bitmaprenderer",{alpha:!1});e.transferFromImageBitmap(f),f.close();const s="CompositingCaption"===this.settings_store.settings.capture_caption_mode?r:n,i=await h(t,s,{...p,is_caption_composited:!1,is_comment_composited:!1});g=!1!==i&&{blob:i,filename:s},!1!==g&&this.captured_callback(g.blob,g.filename)}console.log("[CaptureManager] Total:",pt.mathFloor(pt.time()-e,3),"sec"),this.removeHighlight(t);for(const b of[g,v])if(this.settings_store.settings.capture_copy_to_clipboard&&null!==b&&"object"===typeof b)try{await(0,Ki.FH)(await(0,Ki.BD)(b.blob))}catch(w){this.player.notice("クリップボードへのキャプチャのコピーに失敗しました。",void 0,void 0,"#FF6F6A"),console.error(w)}}addHighlight(t=!1){t?this.comment_capture_button.classList.add("dplayer-capturing"):this.capture_button.classList.add("dplayer-capturing")}removeHighlight(t=!1){t?this.comment_capture_button.classList.remove("dplayer-capturing"):this.capture_button.classList.remove("dplayer-capturing")}async commentsHTMLtoSVGImage(t,e,s){const i="http://www.w3.org/2000/svg",a=document.createElementNS(i,"svg");a.setAttribute("width",`${e}`),a.setAttribute("height",`${s}`),a.setAttribute("viewBox",`0 0 ${e} ${s}`);const n=document.createElementNS(i,"foreignObject");n.setAttribute("width","100%"),n.setAttribute("height","100%"),n.setAttribute("x","0"),n.setAttribute("y","0"),n.setAttribute("externalResourcesRequired","true"),a.appendChild(n);const r=document.createElement("body");n.appendChild(r);const o=document.createElement("style");o.appendChild(document.createTextNode(`\n            @font-face {\n                font-family: 'Noto Sans JP';\n                font-weight: bold;\n                src: url(${Vi}) format('woff2');\n            }\n            @font-face {\n                font-family: 'Open Sans';\n                font-weight: bold;\n                src: url(${Ri}) format('woff2');\n            }\n            .dplayer-danmaku {\n                position: absolute;\n                top: 0;\n                left: 0;\n                right: 0;\n                bottom: 0;\n                color: #fff;\n                font-size: 29px;\n                font-family: 'Open Sans', 'Hiragino Sans', 'Noto Sans JP', sans-serif;\n            }\n            .dplayer-danmaku .dplayer-danmaku-item {\n                display: inline-block;\n                line-height: 1;\n                font-weight: bold;\n                font-size: var(--dplayer-danmaku-font-size);\n                opacity: var(--dplayer-danmaku-opacity);\n                text-shadow: 1.2px 1.2px 4px rgba(0, 0, 0, 0.9);\n                white-space: nowrap;\n            }\n            .dplayer-danmaku .dplayer-danmaku-item--demo {\n                position: absolute;\n                visibility: hidden;\n            }\n            .dplayer-danmaku .dplayer-danmaku-item span {\n                box-decoration-break: clone;\n                -webkit-box-decoration-break: clone;\n            }\n            .dplayer-danmaku .dplayer-danmaku-item.dplayer-danmaku-size-big {\n                font-size: calc(var(--dplayer-danmaku-font-size) * 1.25);\n            }\n            .dplayer-danmaku .dplayer-danmaku-item.dplayer-danmaku-size-small {\n                font-size: calc(var(--dplayer-danmaku-font-size) * 0.8);\n            }\n            .dplayer-danmaku .dplayer-danmaku-right {\n                position: absolute;\n                right: 0;\n            }\n            .dplayer-danmaku .dplayer-danmaku-top, .dplayer-danmaku .dplayer-danmaku-bottom {\n                position: absolute;\n                left: 50%;\n                transform: translateX(-50%);\n            }\n        `)),r.appendChild(o);const l=document.createElement("div");l.innerHTML=t,r.appendChild(l.childNodes[0]);const c=new Image,_=(new XMLSerializer).serializeToString(a);return c.src=`data:image/svg+xml;charset=utf-8,${encodeURIComponent(_)}`,await new Promise(((t,e)=>{c.onload=t,c.onerror=e})),await c.decode(),c}async createCommentsImage(){let t=this.player.template.danmaku.outerHTML;for(const e of this.player_container.querySelectorAll(".dplayer-danmaku-move")){const s=e.getBoundingClientRect().left-this.player.video.getBoundingClientRect().left;t=t.replace(/transform: translateX\(.*?\);/,`left: ${s}px;`).replaceAll("border: 2px solid #E64F97;","")}return await this.commentsHTMLtoSVGImage(t,this.player.template.danmaku.offsetWidth,this.player.template.danmaku.offsetHeight)}async drawComments(t,e,s){const i=t.width/this.player.template.danmaku.offsetWidth,a=this.player.template.danmaku.offsetHeight*i;e.drawImage(s,0,0,t.width,a)}async exportToBlob(t){if("OffscreenCanvas"in window&&t instanceof OffscreenCanvas)return await t.convertToBlob({type:"image/jpeg",quality:.99});if(t instanceof HTMLCanvasElement)return new Promise(((e,s)=>{t.toBlob((t=>{null!==t?e(t):s(new Error("Failed to convert canvas to blob"))}),"image/jpeg",.99)}));throw new Error("Failed to convert canvas to blob")}async setEXIFDataToCapture(t,e){const s=rt()().diff(rt()(e.start_time),"second",!0),i={captured_at:rt()().format("YYYY-MM-DDTHH:mm:ss+09:00"),captured_playback_position:s,network_id:e.network_id,service_id:e.service_id,event_id:e.event_id,title:e.title,description:e.description,start_time:e.start_time,end_time:e.end_time,duration:e.duration,caption_text:e.caption_text,is_caption_composited:e.is_caption_composited,is_comment_composited:e.is_comment_composited},a=rt()().format("YYYY:MM:DD HH:mm:ss"),n={"0th":{[Mi.TagValues.ImageIFD.XResolution]:[72,1],[Mi.TagValues.ImageIFD.YResolution]:[72,1],[Mi.TagValues.ImageIFD.ResolutionUnit]:2,[Mi.TagValues.ImageIFD.YCbCrPositioning]:1,[Mi.TagValues.ImageIFD.DateTime]:a,[Mi.TagValues.ImageIFD.Software]:`KonomiTV version ${pt.version}`,[Mi.TagValues.ImageIFD.XPComment]:[...D.Buffer.from(JSON.stringify(i),"ucs2")]},Exif:{[Mi.TagValues.ExifIFD.ExifVersion]:"0230",[Mi.TagValues.ExifIFD.ComponentsConfiguration]:"\0",[Mi.TagValues.ExifIFD.FlashpixVersion]:"0100",[Mi.TagValues.ExifIFD.ColorSpace]:1,[Mi.TagValues.ExifIFD.DateTimeOriginal]:a,[Mi.TagValues.ExifIFD.DateTimeDigitized]:a}},r=Mi.dump(n),o=await new Promise(((e,s)=>{const i=new FileReader;i.onload=()=>e(i.result),i.onerror=s,i.readAsBinaryString(t)})),l=Mi.insert(r,o),c=new Uint8Array(l.length);for(let _=0;_<c.length;_++)c[_]=255&l.charCodeAt(_);return new Blob([c],{type:t.type})}}var Gi,Wi=Ui,qi=s(70655),Yi=s(54375),Xi=s(22918),Ji=s(50060);const Qi=new Worker(new URL(s.p+s.u(531),s.b)),ta=Yi.Ud(Qi);class ea{constructor(t){this.container_element=null,this.remocon_button_event_abort_controller=null,this.resize_observer=null,Gi.set(this,null),this.bml_browser_width=960,this.bml_browser_height=540,this.is_bml_browser_using_numeric_key=!1,this.is_bml_browser_destroying=!1,this.is_video_element_moved_to_bml_browser=!1,this.live_psi_archived_data_decoder=null,this.player=t.player,this.display_channel_id=t.display_channel_id,this.media_element=this.player.template.videoWrapAspect,this.remocon_element=document.querySelector(".remote-control"),this.remocon_data_broadcasting_element=this.remocon_element.querySelector(".remote-control-data-broadcasting")}async init(){const t=Gs(),e=st().settings.tv_show_data_broadcasting;if(console.log("[LiveDataBroadcastingManager] BMLBrowser: "+(e?"enabled":"disabled")),this.initRemoconButtons(),!0===e){this.container_element=document.createElement("div"),this.container_element.classList.add("dplayer-bml-browser"),this.container_element=this.player.template.videoWrap.insertAdjacentElement("afterbegin",this.container_element),this.toggleRemoconButtonsEnabled(!0),this.toggleRemoconButtonsLoading(!0);const e=this;(0,qi.YH)(this,Gi,new Xi.kN({mediaElement:document.createElement("p"),containerElement:this.container_element,storagePrefix:"KonomiTV-BMLBrowser_",nvramPrefix:"nvram_",broadcasterDatabasePrefix:"",videoPlaneModeEnabled:!0,fonts:{roundGothic:ea.round_gothic,squareGothic:ea.square_gothic},indicator:{setUrl(t,s){e.toggleRemoconButtonsLoading(s)},setNetworkingGetStatus(t){e.toggleRemoconButtonsLoading(t)},setNetworkingPostStatus(t){e.toggleRemoconButtonsLoading(t)},setReceivingStatus(t){},setEventName(t){}},greg:{getReg(t){let e;return e=null===window.sessionStorage.getItem("KonomiTV-BMLBrowser-Greg")?[...new Array(64)].map((t=>"")):JSON.parse(window.sessionStorage.getItem("KonomiTV-BMLBrowser-Greg")),e[t]??""},setReg(t,e){let s;s=null===window.sessionStorage.getItem("KonomiTV-BMLBrowser-Greg")?[...new Array(64)].map((t=>"")):JSON.parse(window.sessionStorage.getItem("KonomiTV-BMLBrowser-Greg")),s[t]=e,window.sessionStorage.setItem("KonomiTV-BMLBrowser-Greg",JSON.stringify(s))}},epg:{tune(s,i,a){if(t.channel.current.network_id===s&&t.channel.current.service_id===a)return(async()=>{await e.destroy(),await e.init()})(),!0;for(const e of Object.values(t.channels_list))for(const t of e)if(t.network_id===s&&t.service_id===a)return pt.sleep(.3).then((()=>_a.push({path:`/tv/watch/${t.display_channel_id}`}))),!0;return console.error(`[LiveDataBroadcastingManager] Channel not found (network_id: ${s} / service_id: ${a})`),e.player.notice(`切り替え先のチャンネルが見つかりませんでした。(network_id: ${s} / service_id: ${a})`,3e3,void 0,"#FF6F6A"),pt.sleep(3).then((async()=>{await e.destroy(),await e.init()})),!1}},ip:{getConnectionType(){return 403},isIPConnected(){return 0}},showErrorMessage(t,s,i){e.player.notice(`${t}<br>${s} (${i})`,3e3,void 0,"#FF6F6A")}}),"f"),this.bml_browser_width=960,this.bml_browser_height=540,console.log("[LiveDataBroadcastingManager] BMLBrowser initialized."),(0,qi.Q_)(this,Gi,"f").addEventListener("load",(t=>{console.log("[LiveDataBroadcastingManager] BMLBrowser: load",t.detail),this.bml_browser_width=t.detail.resolution.width,this.bml_browser_height=t.detail.resolution.height,this.container_element?.style.setProperty("--bml-browser-width",`${this.bml_browser_width}px`),this.container_element?.style.setProperty("--bml-browser-height",`${this.bml_browser_height}px`),this.calculateBMLBrowserScaleFactor(this.player.template.videoWrap.clientWidth,this.player.template.videoWrap.clientHeight),this.moveVideoElementToBMLBrowser()})),(0,qi.Q_)(this,Gi,"f").addEventListener("invisible",(t=>{!0===t.detail?(console.log("[LiveDataBroadcastingManager] BMLBrowser: invisible"),this.moveVideoElementToDPlayer()):(console.log("[LiveDataBroadcastingManager] BMLBrowser: visible"),this.moveVideoElementToBMLBrowser())})),(0,qi.Q_)(this,Gi,"f").addEventListener("usedkeylistchanged",(t=>{this.is_bml_browser_using_numeric_key=[...t.detail.usedKeyList].includes("numeric-tuning")})),this.resize_observer=new ResizeObserver((t=>{const e=t[0];this.calculateBMLBrowserScaleFactor(e.contentRect.width,e.contentRect.height)})),this.resize_observer.observe(this.player.template.videoWrap)}const s=at.extractAPIQualityFromDPlayer(this.player),i=`${pt.api_base_url}/streams/live/${this.display_channel_id}/${s}/psi-archived-data`;this.live_psi_archived_data_decoder=await new ta(i),this.live_psi_archived_data_decoder.run(Yi.sj((async e=>{if("pmt"===e.type&&null!==(0,qi.Q_)(this,Gi,"f")){const t=e.components.some((t=>void 0!==t.bxmlInfo));console.log("[LiveDataBroadcastingManager] BMLBrowser: "+(t?"available":"unavailable")),!1===t?(this.toggleRemoconButtonsLoading(!1),this.toggleRemoconButtonsEnabled(!1)):this.toggleRemoconButtonsEnabled(!0)}if("programInfo"===e.type&&null!=t.channel.current.program_present&&(e.eventId&&(t.channel.current.program_present.event_id=e.eventId),e.eventName&&(t.channel.current.program_present.title=mt.formatString(e.eventName)),e.startTimeUnixMillis)){const s=mt.convertTimestampToISO8601(e.startTimeUnixMillis);t.channel.current.program_present.start_time=s,e.durationSeconds?(t.channel.current.program_present.end_time=rt()(s).add(e.durationSeconds,"seconds").toISOString(),t.channel.current.program_present.duration=e.durationSeconds):(t.channel.current.program_present.end_time=s,t.channel.current.program_present.duration=-1)}null!==(0,qi.Q_)(this,Gi,"f")&&(0,qi.Q_)(this,Gi,"f").emitMessage(e)})))}initRemoconButtons(){const t=Gs();this.remocon_button_event_abort_controller=new AbortController;const e=this.remocon_element.querySelectorAll("button");for(const s of e)s.addEventListener("click",(async()=>{const e=parseInt(s.dataset.aribKeyCode),i=s.dataset.remoconId?parseInt(s.dataset.remoconId):null;if(null===i||!1!==this.is_bml_browser_using_numeric_key)null!==(0,qi.Q_)(this,Gi,"f")&&(10===i&&((0,qi.Q_)(this,Gi,"f").content.processKeyDown(Ji.I5.Digit0),(0,qi.Q_)(this,Gi,"f").content.processKeyUp(Ji.I5.Digit0),await pt.sleep(.1)),(0,qi.Q_)(this,Gi,"f").content.processKeyDown(e),(0,qi.Q_)(this,Gi,"f").content.processKeyUp(e));else{const e=t.channel.current.type,s=t.getChannelByRemoconID(e,i);null!==s&&s.display_channel_id!==t.display_channel_id&&_a.push({path:`/tv/watch/${s.display_channel_id}`})}}),{signal:this.remocon_button_event_abort_controller.signal})}toggleRemoconButtonsLoading(t){!0===t?this.remocon_data_broadcasting_element.classList.add("remote-control-data-broadcasting--loading"):this.remocon_data_broadcasting_element.classList.remove("remote-control-data-broadcasting--loading")}toggleRemoconButtonsEnabled(t){!0===t?this.remocon_data_broadcasting_element.classList.remove("remote-control-data-broadcasting--disabled"):this.remocon_data_broadcasting_element.classList.add("remote-control-data-broadcasting--disabled")}calculateBMLBrowserScaleFactor(t,e){const s=t/(16*this.bml_browser_height/9),i=e/this.bml_browser_height,a=Math.min(s,i),n=16*this.bml_browser_height/9/this.bml_browser_width;this.container_element?.style.setProperty("--bml-browser-scale-factor-width",""+a*n),this.container_element?.style.setProperty("--bml-browser-scale-factor-height",`${a}`)}moveVideoElementToBMLBrowser(){if(!this.is_bml_browser_destroying&&null!==(0,qi.Q_)(this,Gi,"f")?.getVideoElement()){(0,qi.Q_)(this,Gi,"f")?.getVideoElement()?.firstElementChild instanceof HTMLParagraphElement&&(0,qi.Q_)(this,Gi,"f")?.getVideoElement()?.firstElementChild?.remove(),(0,qi.Q_)(this,Gi,"f")?.getVideoElement()?.appendChild(this.media_element),this.media_element.style.width="100%",this.media_element.style.height="100%";for(const t of this.media_element.children)if(t.style.display="block",t.style.visibility="visible",t instanceof HTMLVideoElement)if(t.style.width="100%",t.style.height="100%",this.bml_browser_width/this.bml_browser_height!==16/9){const e=16*this.bml_browser_height/9/this.bml_browser_width;t.style.transform=`scaleY(${e})`,t.style.transformOrigin="center center"}else t.style.transform="",t.style.transformOrigin="";this.is_video_element_moved_to_bml_browser=!0}}moveVideoElementToDPlayer(){if(!this.is_bml_browser_destroying&&!1!==this.is_video_element_moved_to_bml_browser){null!==this.container_element&&this.player.template.videoWrap.insertBefore(this.media_element,this.container_element.nextElementSibling),this.media_element.style.width="",this.media_element.style.height="";for(const t of this.media_element.children)t.style.display="",t.style.visibility="",t instanceof HTMLVideoElement&&(t.style.width="",t.style.height="",t.style.transform="",t.style.transformOrigin="");this.is_video_element_moved_to_bml_browser=!1}}async destroy(){null!==this.live_psi_archived_data_decoder&&(this.live_psi_archived_data_decoder.destroy(),this.live_psi_archived_data_decoder=null),null!==this.remocon_button_event_abort_controller&&(this.remocon_button_event_abort_controller.abort(),this.remocon_button_event_abort_controller=null),null!==(0,qi.Q_)(this,Gi,"f")&&(this.toggleRemoconButtonsEnabled(!1),this.toggleRemoconButtonsLoading(!0),null!==this.resize_observer&&(this.resize_observer.disconnect(),this.resize_observer=null),this.moveVideoElementToDPlayer(),this.is_bml_browser_destroying=!0,await(0,qi.Q_)(this,Gi,"f").destroy(),this.is_bml_browser_destroying=!1,(0,qi.YH)(this,Gi,null,"f"),console.log("[LiveDataBroadcastingManager] BMLBrowser destroyed."),this.container_element?.remove())}}Gi=new WeakMap,ea.round_gothic={source:'url("https://cdn.jsdelivr.net/gh/googlefonts/kosugi-maru@main/fonts/webfonts/KosugiMaru-Regular.woff2"), local("sans-serif")'},ea.square_gothic={source:'url("https://cdn.jsdelivr.net/gh/googlefonts/kosugi@main/fonts/webfonts/Kosugi-Regular.woff2"), local("sans-serif")'};var sa=ea;const ia=.7,aa=5;var na=o["default"].extend({name:"TV-Watch",components:{BottomNavigation:Lt,Channel:di,Comment:wi,Program:Si,Remocon:Bi,Twitter:Ei},data(){return{Utils:pt,ProgramUtils:mt,time:rt()().format("YYYY/MM/DD HH:mm:ss"),tv_panel_active_tab:st().settings.tv_panel_active_tab,background_url:"",is_loading:!0,is_video_buffering:!0,is_background_display:!1,is_control_display:!0,is_remocon_display:!1,is_panel_display:(()=>{const t=st();switch(t.settings.panel_display_state){case"AlwaysDisplay":return!0;case"AlwaysFold":return!1;case"RestorePreviousState":return t.settings.showed_panel_last_time}})(),is_fullscreen:!1,is_ime_composing:!1,is_virtual_keyboard_display:!1,is_comment_send_just_did:!1,interval_ids:[],control_interval_id:0,is_zapping:!1,is_zapping_continuously:!1,player:null,player_can_be_destroyed:!1,is_mpegts_supported:!0===ni().isSupported()&&!1===pt.isSafari(),is_offline:!1,romsounds_context:null,romsounds_buffers:[],eventsource:null,fullscreen_handler:null,capture_manager:null,data_broadcasting_manager:null,shortcut_key_handler:null,shortcut_key_pressed_at:pt.time(),shortcut_key_modal:!1,shortcut_key_list:{left_column:[{name:"全般",icon:"fluent:home-20-filled",icon_height:"22px",shortcuts:[{name:"数字キー/テンキーに対応するリモコン番号 (1~12) の地デジチャンネルに切り替える",keys:[{name:"1~9, 0, -(=), ^(~)",icon:!1}]},{name:"数字キー/テンキーに対応するリモコン番号 (1~12) の BS チャンネルに切り替える",keys:[{name:"Shift",icon:!1},{name:"1~9, 0, -(=), ^(~)",icon:!1}]},{name:"前のチャンネルに切り替える",keys:[{name:"fluent:arrow-up-12-filled",icon:!0}]},{name:"次のチャンネルに切り替える",keys:[{name:"fluent:arrow-down-12-filled",icon:!0}]},{name:"キーボードショートカットの一覧を表示する",keys:[{name:"／(？)",icon:!1}]}]},{name:"プレイヤー",icon:"fluent:play-20-filled",icon_height:"20px",shortcuts:[{name:"再生 / 一時停止の切り替え",keys:[{name:"Space",icon:!1}]},{name:"再生 / 一時停止の切り替え (キャプチャタブ表示時)",keys:[{name:"Shift",icon:!1},{name:"Space",icon:!1}]},{name:"プレイヤーの音量を上げる",keys:[{name:pt.CtrlOrCmd(),icon:!1},{name:"fluent:arrow-up-12-filled",icon:!0}]},{name:"プレイヤーの音量を下げる",keys:[{name:pt.CtrlOrCmd(),icon:!1},{name:"fluent:arrow-down-12-filled",icon:!0}]},{name:"停止して0.5秒早戻し",keys:[{name:pt.CtrlOrCmd(),icon:!1},{name:"fluent:arrow-left-12-filled",icon:!0}]},{name:"停止して0.5秒早送り",keys:[{name:pt.CtrlOrCmd(),icon:!1},{name:"fluent:arrow-right-12-filled",icon:!0}]},{name:"フルスクリーンの切り替え",keys:[{name:"F",icon:!1}]},{name:"ライブストリームの同期",keys:[{name:"W",icon:!1}]},{name:"Picture-in-Picture の表示切り替え",keys:[{name:"E",icon:!1}]},{name:"字幕の表示切り替え",keys:[{name:"S",icon:!1}]},{name:"コメントの表示切り替え",keys:[{name:"D",icon:!1}]},{name:"映像をキャプチャする",keys:[{name:"C",icon:!1}]},{name:"映像をコメントを付けてキャプチャする",keys:[{name:"V",icon:!1}]},{name:"コメント入力フォームにフォーカスする",keys:[{name:"M",icon:!1}]},{name:"コメント入力フォームを閉じる",keys:[{name:pt.CtrlOrCmd(),icon:!1},{name:"M",icon:!1}]}]}],right_column:[{name:"パネル",icon:"fluent:panel-right-20-filled",icon_height:"24px",shortcuts:[{name:"パネルの表示切り替え",keys:[{name:"P",icon:!1}]},{name:"番組情報タブを表示する",keys:[{name:"K",icon:!1}]},{name:"チャンネルタブを表示する",keys:[{name:"L",icon:!1}]},{name:"コメントタブを表示する",keys:[{name:"；(＋)",icon:!1}]},{name:"Twitter タブを表示する",keys:[{name:"：(＊)",icon:!1}]}]},{name:"Twitter",icon:"fa-brands:twitter",icon_height:"22px",shortcuts:[{name:"ツイート検索タブを表示する",keys:[{name:"［ (「)",icon:!1}]},{name:"タイムラインタブを表示する",keys:[{name:"］ (」)",icon:!1}]},{name:"キャプチャタブを表示する",keys:[{name:"＼(￥)",icon:!1}]},{name:"ツイート入力フォームにフォーカスを当てる/フォーカスを外す",keys:[{name:"Tab",icon:!1}]},{name:"キャプチャにフォーカスする",keys:[{name:"キャプチャタブを表示",icon:!1},{name:"fluent:arrow-up-12-filled;fluent:arrow-down-12-filled;fluent:arrow-left-12-filled;fluent:arrow-right-12-filled",icon:!0}]},{name:"キャプチャを拡大表示する/<br>キャプチャの拡大表示を閉じる",keys:[{name:"キャプチャにフォーカス",icon:!1},{name:"Enter",icon:!1}]},{name:"キャプチャを選択する/<br>キャプチャの選択を解除する",keys:[{name:"キャプチャにフォーカス",icon:!1},{name:"Space",icon:!1}]},{name:"クリップボード内の画像を<br>キャプチャとして取り込む",keys:[{name:"ツイート入力<br>フォームにフォーカス",icon:!1},{name:pt.CtrlOrCmd(),icon:!1},{name:"V",icon:!1}]},{name:"ツイートを送信する",keys:[{name:"Twitter タブを表示",icon:!1},{name:pt.CtrlOrCmd(),icon:!1},{name:"Enter",icon:!1}]}]}]}}},computed:{...(0,a.Kc)(Gs,st)},async created(){!0===this.settingsStore.settings.tv_channel_selection_requires_alt_key&&(this.shortcut_key_list.left_column[0].shortcuts[0].keys.unshift({name:pt.AltOrOption(),icon:!1}),this.shortcut_key_list.left_column[0].shortcuts[1].keys.unshift({name:pt.AltOrOption(),icon:!1})),this.channelsStore.display_channel_id=this.$route.params.display_channel_id,"virtualKeyboard"in navigator&&(navigator.virtualKeyboard.overlaysContent=!0,navigator.virtualKeyboard.ongeometrychange=t=>{0===t.target.boundingRect.width&&0===t.target.boundingRect.height?this.is_virtual_keyboard_display=!1:this.is_virtual_keyboard_display=!0}),this.init(),this.romsounds_context=new AudioContext;for(let t=1;t<=14;t++){const e=`/assets/romsounds/${t.toString().padStart(2,"0")}.wav`,s=await G.get(e,{baseURL:"",responseType:"arraybuffer"});this.romsounds_buffers.push(await this.romsounds_context.decodeAudioData(s.data))}},beforeDestroy(){"virtualKeyboard"in navigator&&(navigator.virtualKeyboard.overlaysContent=!1),"gr999"!==this.channelsStore.channel.current.display_channel_id&&this.destroy(!0),null!==this.romsounds_context&&this.romsounds_context.close(),this.channelsStore.display_channel_id="gr000"},beforeRouteUpdate(t,e,s){const i=this.destroy(!1,this.is_zapping_continuously);this.is_zapping_continuously=!0,this.channelsStore.display_channel_id=t.params.display_channel_id,!0===this.settingsStore.settings.reset_hashtag_when_program_switches&&(this.$refs.Twitter.tweet_hashtag=""),(async()=>{!0===this.is_zapping?(this.is_zapping=!1,this.interval_ids.push(window.setTimeout((()=>{this.is_zapping_continuously=!1,i.then((()=>this.init()))}),500))):(this.is_zapping_continuously=!1,i.then((()=>this.init())))})(),s()},watch:{"channelsStore.channel":{immediate:!0,handler(t,e){if(void 0===e)return;const s=this.$refs.Twitter;if(t.current.display_channel_id!==e.current.display_channel_id){const t=s.getChannelHashtag(e.current.name)??"";s.tweet_hashtag=s.formatHashtag(s.tweet_hashtag.replaceAll(t,"")),s.updateTweetLetterCount()}(t.current.id!==e.current.id||null!==t.current.program_present&&null===e.current.program_present||null===t.current.program_present&&null!==e.current.program_present||null!==t.current.program_present&&null!==e.current.program_present&&t.current.program_present.id!==e.current.program_present.id)&&!0===this.settingsStore.settings.reset_hashtag_when_program_switches&&(s.tweet_hashtag=s.formatHashtag(""),s.updateTweetLetterCount())}},is_panel_display(){this.settingsStore.settings.showed_panel_last_time=this.is_panel_display}},methods:{async init(){this.background_url=at.generatePlayerBackgroundURL(),this.controlDisplayTimer(),this.interval_ids.push(window.setInterval((()=>this.time=rt()().format("YYYY/MM/DD HH:mm:ss")),1e3));const t=60-(new Date).getSeconds();this.interval_ids.push(window.setTimeout((()=>{this.channelsStore.update(!0),this.update(),this.interval_ids.push(window.setInterval((()=>{this.channelsStore.update(!0),this.update()}),3e4))}),1e3*t)),await this.channelsStore.update(),this.update()},async update(){if(void 0!==this.$route.params.display_channel_id)if("gr999"!==this.channelsStore.channel.current.display_channel_id){if(null!==this.player&&!0!==this.player_can_be_destroyed||(this.initPlayer(),await this.initEventHandler(),this.initCaptureManager(),document.removeEventListener("keydown",this.shortcut_key_handler),this.initShortcutKeyHandler()),null!==this.player){if(null===this.channelsStore.channel.current.program_present||"1/0+1/0モード(デュアルモノ)"!==this.channelsStore.channel.current.program_present.primary_audio_type&&null===this.channelsStore.channel.current.program_present.secondary_audio_type){if(this.player.template.audioItem[1].classList.add("dplayer-setting-audio-item--disabled"),void 0!==this.player.plugins.mpegts||void 0!==this.player.plugins.liveLLHLSForKonomiTV){while(null===this.player)await pt.sleep(.1);this.player.template.audioItem[0].classList.add("dplayer-setting-audio-current"),this.player.template.audioItem[1].classList.remove("dplayer-setting-audio-current"),this.player.template.audioValue.textContent=this.player.tran("Primary audio");try{void 0!==this.player.plugins.mpegts&&this.player.plugins.mpegts instanceof ni().MSEPlayer&&this.player.plugins.mpegts.switchPrimaryAudio(),void 0!==this.player.plugins.liveLLHLSForKonomiTV&&this.player.plugins.liveLLHLSForKonomiTV.switchPrimaryAudio()}catch(t){}}}else this.player.template.audioItem[1].classList.remove("dplayer-setting-audio-item--disabled");if("mediaSession"in navigator){const t=[{src:"/assets/images/icons/icon-maskable-192px.png",sizes:"192x192",type:"image/png"},{src:"/assets/images/icons/icon-maskable-512px.png",sizes:"512x512",type:"image/png"}];navigator.mediaSession.metadata=new MediaMetadata({title:this.channelsStore.channel.current.program_present?.title??"放送休止",artist:this.channelsStore.channel.current.name,artwork:t}),"setPositionState"in navigator.mediaSession&&navigator.mediaSession.setPositionState({duration:0,playbackRate:1}),navigator.mediaSession.setActionHandler("play",null),navigator.mediaSession.setActionHandler("pause",null),navigator.mediaSession.setActionHandler("previoustrack",null),navigator.mediaSession.setActionHandler("nexttrack",null),navigator.mediaSession.setActionHandler("play",(()=>this.player?.play())),navigator.mediaSession.setActionHandler("pause",(()=>this.player?.pause())),navigator.mediaSession.setActionHandler("previoustrack",(async()=>{navigator.mediaSession.metadata=new MediaMetadata({title:this.channelsStore.channel.previous.program_present?.title??"放送休止",artist:this.channelsStore.channel.previous.name,artwork:t}),await this.$router.push({path:`/tv/watch/${this.channelsStore.channel.previous.display_channel_id}`})})),navigator.mediaSession.setActionHandler("nexttrack",(async()=>{navigator.mediaSession.metadata=new MediaMetadata({title:this.channelsStore.channel.next.program_present?.title??"放送休止",artist:this.channelsStore.channel.next.name,artwork:t}),await this.$router.push({path:`/tv/watch/${this.channelsStore.channel.next.display_channel_id}`})}))}}}else this.$router.push({path:"/not-found/"})},controlDisplayTimer(t=null,e=!1){const s=/iPhone|iPad|iPod|Windows|Macintosh|Android|Mobile/i.test(navigator.userAgent)&&"ontouchend"in document;if(!0===s&&null!==t&&"mousemove"===t.type)return;if(!1===s&&null!==t&&("touchmove"===t.type||"click"===t.type))return;window.clearTimeout(this.control_interval_id);const i=()=>{null!==this.player&&this.player.template.controller.classList.contains("dplayer-controller-comment")?this.control_interval_id=window.setTimeout(i,3e3):(this.is_control_display=!1,null!==this.player&&(this.player.controller.hide(),this.player.setting.hide()))};!0===s&&!0===e?this.player?.controller.isShow()?(this.is_control_display=!0,this.player.controller.show(),this.control_interval_id=window.setTimeout(i,3e3)):(this.is_control_display=!1,this.player?.controller.hide(),this.player?.setting.hide()):(this.is_control_display=!0,null!==this.player&&this.player.controller.show(),this.control_interval_id=window.setTimeout(i,3e3))},initPlayer(){if(window.mpegts=ni(),null!==this.player&&!0===this.player_can_be_destroyed){try{this.player.destroy()}catch(a){void 0!==this.player.plugins.mpegts&&this.player.plugins.mpegts.destroy()}this.player_can_be_destroyed=!1,this.player=null}const t=this.settingsStore.settings.tv_low_latency_mode?ia:aa;this.player=new(ii())({container:this.$el.querySelector(".watch-player__dplayer"),theme:"#E64F97",lang:"ja-jp",live:!0,liveSyncMinBufferSize:this.is_mpegts_supported?t-.1:0,loop:!1,airplay:!1,autoplay:!0,hotkey:!1,screenshot:!1,crossOrigin:"anonymous",volume:1,video:{defaultQuality:this.channelsStore.channel.current.is_radiochannel?"48kHz/192kbps":this.settingsStore.settings.tv_streaming_quality,quality:(()=>{const t=[];if(this.channelsStore.channel.current.is_radiochannel)!0===this.is_mpegts_supported?t.push({name:"48kHz/192kbps",type:"mpegts",url:`${pt.api_base_url}/streams/live/${this.channelsStore.display_channel_id}/1080p/mpegts`}):t.push({name:"48kHz/192kbps",type:"live-llhls-for-KonomiTV",url:`${pt.api_base_url}/streams/live/${this.channelsStore.display_channel_id}/1080p/ll-hls`});else{let e="";at.isHEVCVideoSupported()&&!0===this.settingsStore.settings.tv_data_saver_mode&&(e="-hevc");for(const s of["1080p-60fps","1080p","810p","720p","540p","480p","360p","240p"])!0===this.is_mpegts_supported?t.push({name:"1080p-60fps"===s?"1080p (60fps)":s,type:"mpegts",url:`${pt.api_base_url}/streams/live/${this.channelsStore.display_channel_id}/${s}${e}/mpegts`}):t.push({name:"1080p-60fps"===s?"1080p (60fps)":s,type:"live-llhls-for-KonomiTV",url:`${pt.api_base_url}/streams/live/${this.channelsStore.display_channel_id}/${s}${e}/ll-hls`})}return t})()},danmaku:{user:"KonomiTV",speedRate:this.settingsStore.settings.comment_speed_rate,fontSize:this.settingsStore.settings.comment_font_size,closeCommentFormAfterSend:this.settingsStore.settings.close_comment_form_after_sending},apiBackend:{read:t=>{t.success([])},send:async t=>{this.$refs.Comment.sendComment(t)}},pluginOptions:{mpegts:{config:{enableWorker:!0,enableMSEWorker:window.MediaSource&&!0===window.MediaSource.canConstructInDedicatedWorker,enableStashBuffer:!1,liveSync:this.settingsStore.settings.tv_low_latency_mode,liveSyncMaxLatency:3,liveSyncTargetLatency:t,liveSyncPlaybackRate:1.1}},aribb24:{disableSuperimposeRenderer:!1===this.settingsStore.settings.tv_show_superimpose,normalFont:`"${this.settingsStore.settings.caption_font}", "Rounded M+ 1m for ARIB", sans-serif`,forceStrokeColor:this.settingsStore.settings.always_border_caption_text,forceBackgroundColor:(()=>{if(!0===this.settingsStore.settings.specify_caption_opacity){const t=this.settingsStore.settings.caption_opacity;return`rgba(0, 0, 0, ${t})`}})(),drcsReplacement:!0,enableRawCanvas:!0,useStroke:!0,usePUA:(()=>{const t=this.settingsStore.settings.caption_font,e=document.createElement("canvas").getContext("2d");return e.font='10px "Rounded M+ 1m for ARIB"',e.fillText("Test",0,0),e.font=`10px "${t}"`,e.fillText("Test",0,0),!!t.startsWith("Windows TV")})(),PRACallback:async t=>{if(!1===this.settingsStore.settings.tv_show_superimpose)return;"suspended"===this.romsounds_context.state&&await this.romsounds_context.resume();const e=this.romsounds_context.createBufferSource();e.buffer=this.romsounds_buffers[t];const s=this.romsounds_context.createGain();e.connect(s),s.connect(this.romsounds_context.destination),s.gain.value=3,e.start(0)}}},subtitle:{type:"aribb24"}}),window.player=this.player,this.player.controller.setAutoHide=t=>{},this.$refs.Comment.initSession(this.player,this.channelsStore.display_channel_id),this.player.template.commentInput.addEventListener("keydown",(t=>{"Enter"===t.code&&(this.is_comment_send_just_did=!0,setTimeout((()=>this.is_comment_send_just_did=!1),100))}));const e=/iPhone|iPad|iPod|Macintosh|Android|Mobile/i.test(navigator.userAgent)&&"ontouchend"in document;!1===e&&(this.player.template.settingOriginPanel.insertAdjacentHTML("beforeend",'\n                <div class="dplayer-setting-item dplayer-setting-keyboard-shortcut">\n                    <span class="dplayer-label">キーボードショートカット</span>\n                    <div class="dplayer-toggle">\n                        <svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 32 32">\n                            <path d="M22 16l-10.105-10.6-1.895 1.987 8.211 8.613-8.211 8.612 1.895 1.988 8.211-8.613z"></path>\n                        </svg>\n                    </div>\n                </div>'),this.$el.querySelector(".dplayer-setting-keyboard-shortcut").addEventListener("click",(()=>{this.player?.setting.hide(),this.shortcut_key_modal=!0})));const s=document.querySelector(".v-application");this.fullscreen_handler=()=>{this.is_fullscreen=!0===this.player?.fullScreen.isFullScreen()},void 0!==s.onfullscreenchange?s.addEventListener("fullscreenchange",this.fullscreen_handler):s.addEventListener("webkitfullscreenchange",this.fullscreen_handler),this.player.fullScreen.isFullScreen=t=>!(!document.fullscreenElement&&!document.webkitFullscreenElement),this.player.fullScreen.request=t=>{null!==this.player&&(this.player.fullScreen.isFullScreen()?this.player.fullScreen.cancel():(s.requestFullscreen=s.requestFullscreen||s.webkitRequestFullscreen,s.requestFullscreen?(s.requestFullscreen(),screen.orientation&&screen.orientation.lock("landscape").catch((()=>{}))):this.player.notice("iPhone Safari は動画のフルスクリーン表示に対応していません。",void 0,void 0,"#FF6F6A")))},this.player.fullScreen.cancel=t=>{document.exitFullscreen=document.exitFullscreen||document.webkitExitFullscreen,document.exitFullscreen&&document.exitFullscreen(),screen.orientation&&screen.orientation.unlock()};const i=()=>{this.player?.setting.hide(),this.controlDisplayTimer()};this.player.on("play",i),this.player.on("pause",i),this.player.on("quality_start",(async()=>{this.background_url=at.generatePlayerBackgroundURL(),null!==this.eventsource&&(this.eventsource.close(),this.eventsource=null),await this.initEventHandler()})),!0===this.is_mpegts_supported?this.interval_ids.push(window.setInterval((()=>{null!==this.player&&this.player.video.paused&&this.player.video.buffered.length>=1&&this.player.video.buffered.end(0)-this.player.video.currentTime>30&&this.player.sync()}),6e4)):this.interval_ids.push(window.setInterval((()=>{null!==this.player&&this.player.video.paused&&this.player.sync()}),3e4))},async initEventHandler(){if(null===this.player)return;null!==this.data_broadcasting_manager&&await this.data_broadcasting_manager.destroy(),this.data_broadcasting_manager=new sa({player:this.player,display_channel_id:this.channelsStore.channel.current.display_channel_id}),await this.data_broadcasting_manager.init(),this.is_loading=!0,this.player.video.volume=0,!0===this.is_mpegts_supported&&void 0!==this.player.plugins.mpegts?this.player.plugins.mpegts.on(ni().Events.ERROR,(async(t,e)=>{this.player.notice(`再生中にエラーが発生しました。(${t}: ${e}) 3秒後にリロードします。`,-1,void 0,"#FF6F6A"),await pt.sleep(3),location.reload()})):!1===this.is_mpegts_supported&&this.player.on("error",(async()=>{!0!==this.is_offline&&this.player?.video.error&&(this.player.notice(`再生中にエラーが発生しました。(${this.player.video.error.code}: ${this.player.video.error.message}) 3秒後にリロードします。`,-1,void 0,"#FF6F6A"),await pt.sleep(3),location.reload())}));const t=()=>{this.player?.video.play().catch((()=>{console.warn("HTMLVideoElement.play() rejected. run fallback.");const t='<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 17 32"><path d="M14.080 4.8q2.88 0 2.88 2.048v18.24q0 2.112-2.88 2.112t-2.88-2.112v-18.24q0-2.048 2.88-2.048zM2.88 4.8q2.88 0 2.88 2.048v18.24q0 2.112-2.88 2.112t-2.88-2.112v-18.24q0-2.048 2.88-2.048z"></path></svg>';this.player.template.playButton.innerHTML=t,this.player.template.mobilePlayButton.innerHTML=t,this.player.container.classList.remove("dplayer-paused"),this.player.container.classList.add("dplayer-playing"),this.player.danmaku.play()})),!1!==this.is_loading||this.player.video.removeEventListener("pause",t)};!1===this.is_mpegts_supported&&(this.player.video.addEventListener("pause",t),t());const e=async()=>{await pt.sleep(.5),this.player?.video.readyState<3&&(console.log("player.video.readyState < HAVE_FUTURE_DATA. trying to recover."),this.player?.video.pause(),await pt.sleep(.1),this.player?.video.play().catch((()=>{console.warn("HTMLVideoElement.play() rejected. paused."),this.player?.pause()})))},s=async()=>{if(null===this.player)return;if(this.player.video.oncanplay=null,this.player.video.oncanplaythrough=null,!0===this.is_mpegts_supported){this.player.video.playbackRate=0;const t=()=>{let t=0;return this.player.video.buffered.length>=1&&(t=this.player.video.buffered.end(0)),Math.round(1e3*(t-this.player.video.currentTime))/1e3},e=this.settingsStore.settings.tv_low_latency_mode?ia:aa;let s=t();while(s<e)await pt.sleep(.1),s=t();this.player.video.playbackRate=1}this.player.video.addEventListener("waiting",(()=>this.is_video_buffering=!0)),this.player.video.addEventListener("playing",(()=>{this.is_video_buffering=!1,e()})),this.is_loading=!1,!1===this.is_mpegts_supported&&this.player.video.removeEventListener("pause",t),this.is_video_buffering=!1,e(),this.channelsStore.channel.current.is_radiochannel?this.is_background_display=!0:this.is_background_display=!1;const s=this.player.user.get("volume");while(this.player.video.volume+.05<s)this.player.video.volume=pt.mathFloor(this.player.video.volume+.05,2),await pt.sleep(.02);this.player.video.volume=s};this.player.video.oncanplay=s,this.player.video.oncanplaythrough=s;const i=this.player.quality.url.replace("/mpegts","/events").replace(/\/ll-hls.*/,"/events");this.eventsource=new EventSource(i),this.eventsource.addEventListener("initial_update",(t=>{const e=JSON.parse(t.data);switch(console.log(`[initial_update] Status: ${e.status} / Detail: ${e.detail}`),e.status){case"Standby":this.is_video_buffering=!0,this.is_background_display=!0;break}})),this.eventsource.addEventListener("status_update",(async t=>{if(null===this.player)return;const e=JSON.parse(t.data);switch(console.log(`[status_update] Status: ${e.status} / Detail: ${e.detail}`),this.channelsStore.updateChannel(this.channelsStore.display_channel_id,{...this.channelsStore.channel.current,viewer_count:e.client_count}),e.status){case"Standby":this.player.template.notice.textContent.includes("画質を")||this.player.notice(e.detail,-1),this.is_video_buffering=!0,this.is_background_display=!0;break;case"ONAir":this.player.template.notice.textContent.includes("画質を")||this.player.notice(this.player.template.notice.textContent,1e-6),!1===this.is_mpegts_supported&&(this.player.video.load(),this.player.video.play(),s()),this.player.container.classList.contains("dplayer-paused")&&(this.player.container.classList.remove("dplayer-paused"),this.player.container.classList.add("dplayer-playing")),document.pictureInPictureElement&&(document.exitPictureInPicture(),this.player.video.requestPictureInPicture());break;case"Idling":this.player.notice("ストリーミング接続が切断されました。3秒後にリロードします。",-1,void 0,"#FF6F6A"),await pt.sleep(3),location.reload();break;case"Restart":this.player.notice(e.detail,-1),this.player.switchVideo({url:this.player.quality.url,type:this.player.quality.type}),this.player.play(),this.is_video_buffering=!0,this.is_background_display=!0;break;case"Offline":"ライブストリームは Offline です。"===e.detail&&(this.player?.notice("ストリーミング接続が切断されました。3秒後にリロードします。",-1,void 0,"#FF6F6A"),await pt.sleep(3),location.reload()),null!==this.player&&(this.player.notice(e.detail,-1),this.player.video.onerror=()=>{this.player.notice(e.detail,-1),this.player.video.onerror=null},this.player?.danmaku?.clear(),this.player.video.pause()),null!==this.eventsource&&(this.eventsource.close(),this.eventsource=null),this.is_background_display=!0,this.is_loading=!1,this.is_video_buffering=!1,this.is_offline=!0;break}})),this.eventsource.addEventListener("detail_update",(t=>{if(null===this.player)return;const e=JSON.parse(t.data);switch(console.log(`[detail_update] Status: ${e.status} Detail:${e.detail}`),this.channelsStore.updateChannel(this.channelsStore.display_channel_id,{...this.channelsStore.channel.current,viewer_count:e.client_count}),e.status){case"Standby":this.player.notice(e.detail,-1),this.is_background_display||(this.is_background_display=!0);break}})),this.eventsource.addEventListener("clients_update",(t=>{const e=JSON.parse(t.data);this.channelsStore.updateChannel(this.channelsStore.display_channel_id,{...this.channelsStore.channel.current,viewer_count:e.client_count})}))},initShortcutKeyHandler(){const t=this.$refs.Twitter,e=t.$el.querySelector(".tweet-form__textarea");for(const s of document.querySelectorAll("input[type=text],input[type=search],textarea"))s.addEventListener("compositionstart",(()=>this.is_ime_composing=!0)),s.addEventListener("compositionend",(()=>this.is_ime_composing=!1));this.shortcut_key_handler=async s=>{const i=document.activeElement.tagName.toUpperCase(),a=document.activeElement.getAttribute("contenteditable");["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(s.code)&&"INPUT"!==i&&"TEXTAREA"!==i&&""!==a&&"true"!==a&&s.preventDefault();let n=!1;s.repeat&&(n=!0);const r=pt.time();if(r-this.shortcut_key_pressed_at<.05)return;this.shortcut_key_pressed_at=r;const o=await(async()=>{if(("INPUT"!==i&&"TEXTAREA"!==i&&""!==a&&"true"!==a||document.activeElement===e)&&!1===this.is_ime_composing&&"Tab"===s.code)return document.activeElement===e?(e.blur(),!0):(this.is_panel_display=!0,this.tv_panel_active_tab="Twitter",e.focus(),this.$el.scrollLeft=0,window.setTimeout((()=>{e.focus(),this.$el.scrollLeft=0}),100),!0);if(("INPUT"!==i&&"TEXTAREA"!==i&&""!==a&&"true"!==a||document.activeElement===e)&&"Twitter"===this.tv_panel_active_tab&&!1===this.is_ime_composing&&(s.ctrlKey||s.metaKey||s.shiftKey)&&"Enter"===s.code)return t.$el.querySelector(".tweet-button").click(),!0;if(null!==this.player&&!s.shiftKey&&!s.altKey&&this.player.template.controller.classList.contains("dplayer-controller-comment")&&(s.ctrlKey||s.metaKey)&&"KeyM"===s.code)return this.player.comment.hide(),!0;if("INPUT"!==i&&"TEXTAREA"!==i&&""!==a&&"true"!==a){if(!1===n&&!s.ctrlKey&&!s.metaKey&&(!1===this.settingsStore.settings.tv_channel_selection_requires_alt_key||s.altKey)){const t=s.shiftKey?"BS":"GR";let e=null;if("Digit1"!==s.code&&"Digit2"!==s.code&&"Digit3"!==s.code&&"Digit4"!==s.code&&"Digit5"!==s.code&&"Digit6"!==s.code&&"Digit7"!==s.code&&"Digit8"!==s.code&&"Digit9"!==s.code||(e=Number(s.code.replace("Digit",""))),"Digit0"===s.code&&(e=10),"Minus"===s.code&&(e=11),"Equal"===s.code&&(e=12),"Numpad1"!==s.code&&"Numpad2"!==s.code&&"Numpad3"!==s.code&&"Numpad4"!==s.code&&"Numpad5"!==s.code&&"Numpad6"!==s.code&&"Numpad7"!==s.code&&"Numpad8"!==s.code&&"Numpad9"!==s.code||(e=Number(s.code.replace("Numpad",""))),"Numpad0"===s.code&&(e=10),null!==e){const s=this.channelsStore.getChannelByRemoconID(t,e);if(null!==s&&s.display_channel_id!==this.channelsStore.display_channel_id)return await this.$router.push({path:`/tv/watch/${s.display_channel_id}`}),!0}}if(!1===n&&!s.ctrlKey&&!s.metaKey&&!s.shiftKey&&!s.altKey){if("Slash"===s.code)return this.shortcut_key_modal=!this.shortcut_key_modal,!0;if("KeyP"===s.code)return this.is_panel_display=!this.is_panel_display,!0;if("KeyK"===s.code)return this.tv_panel_active_tab="Program",!0;if("KeyL"===s.code)return this.tv_panel_active_tab="Channel",!0;if("Semicolon"===s.code)return this.tv_panel_active_tab="Comment",!0;if("Quote"===s.code)return this.tv_panel_active_tab="Twitter",!0;if("BracketRight"===s.code)return t.twitter_active_tab="Search",!0;if("Backslash"===s.code)return t.twitter_active_tab="Timeline",!0;if("IntlRo"===s.code)return t.twitter_active_tab="Capture",!0}if("Twitter"===this.tv_panel_active_tab&&"Capture"===t.twitter_active_tab&&!s.ctrlKey&&!s.metaKey&&!s.shiftKey&&!s.altKey){if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(s.code)){if(0===t.captures.length)return!1;if(!1===t.captures.some((t=>!0===t.focused)))return t.captures[t.captures.length-1].focused=!0,!0;const e=t.captures.findIndex((t=>!0===t.focused));if("ArrowUp"===s.code){if(e-2<0)return!1;t.captures[e-2].focused=!0}if("ArrowDown"===s.code){if(e+2>t.captures.length-1)return!1;t.captures[e+2].focused=!0}if("ArrowLeft"===s.code){if(e-1<0)return!1;t.captures[e-1].focused=!0}if("ArrowRight"===s.code){if(e+1>t.captures.length-1)return!1;t.captures[e+1].focused=!0}t.captures[e].focused=!1;const i=t.captures.find((t=>!0===t.focused));!0===t.zoom_capture_modal&&(t.zoom_capture=i);const a=t.$el.querySelector(`img[src="${i.image_url}"]`).parentElement;return n?a.scrollIntoView({block:"nearest",inline:"nearest",behavior:"auto"}):a.scrollIntoView({block:"nearest",inline:"nearest",behavior:"smooth"}),!0}if("Enter"===s.code){if(this.is_comment_send_just_did)return!1;if(!0===t.zoom_capture_modal)return t.zoom_capture_modal=!1,!0;const e=t.captures.find((t=>!0===t.focused));return void 0!==e&&(t.zoom_capture=e,t.zoom_capture_modal=!0,!0)}if("Space"===s.code){const e=t.captures.find((t=>!0===t.focused));return void 0!==e&&(t.clickCapture(e),!0)}}if(!1===n&&!s.ctrlKey&&!s.metaKey&&!s.shiftKey&&!s.altKey){if("ArrowUp"===s.code)return this.is_zapping=!0,await this.$router.push({path:`/tv/watch/${this.channelsStore.channel.previous.display_channel_id}`}),!0;if("ArrowDown"===s.code)return this.is_zapping=!0,await this.$router.push({path:`/tv/watch/${this.channelsStore.channel.next.display_channel_id}`}),!0}if(null!==this.player&&!s.shiftKey&&!s.altKey){if((s.ctrlKey||s.metaKey)&&"ArrowUp"===s.code)return this.player.volume(this.player.volume()+.05),!0;if((s.ctrlKey||s.metaKey)&&"ArrowDown"===s.code)return this.player.volume(this.player.volume()-.05),!0;if((s.ctrlKey||s.metaKey)&&"ArrowLeft"===s.code)return!1===this.player.video.paused&&this.player.video.pause(),this.player.video.currentTime=this.player.video.currentTime-.5,!0;if((s.ctrlKey||s.metaKey)&&"ArrowRight"===s.code)return!1===this.player.video.paused&&this.player.video.pause(),this.player.video.currentTime=this.player.video.currentTime+.5,!0}if(null!==this.player&&!s.ctrlKey&&!s.metaKey&&!s.altKey&&!0===s.shiftKey&&"Space"===s.code&&!1===n&&"Twitter"===this.tv_panel_active_tab&&"Capture"===t.twitter_active_tab)return this.player.toggle(),!0;if(null!==this.player&&!1===n&&!s.ctrlKey&&!s.metaKey&&!s.altKey){if("Space"===s.code)return this.player.toggle(),!0;if("KeyF"===s.code)return this.player.fullScreen.toggle(),!0;if("KeyW"===s.code)return this.player.sync(),!0;if("KeyE"===s.code)return document.pictureInPictureEnabled&&this.player.template.pipButton.click(),!0;if("KeyS"===s.code)return this.player.subtitle.toggle(),this.player.subtitle.container.classList.contains("dplayer-subtitle-hide")?this.player.notice(`${this.player.tran("Hide subtitle")}`):this.player.notice(`${this.player.tran("Show subtitle")}`),!0;if("KeyD"===s.code)return this.player.template.showDanmaku.click(),this.player.template.showDanmakuToggle.checked?this.player.notice(`${this.player.tran("Show comment")}`):this.player.notice(`${this.player.tran("Hide comment")}`),!0;if("KeyC"===s.code)return await this.capture_manager.captureAndSave(!1),!0;if("KeyV"===s.code)return await this.capture_manager.captureAndSave(!0),!0;if("KeyM"===s.code)return this.player.controller.show(),this.player.comment.show(),this.controlDisplayTimer(),window.setTimeout((()=>this.player.template.commentInput.focus()),100),!0}}return!1})();!0===o&&s.preventDefault()},document.addEventListener("keydown",this.shortcut_key_handler)},initCaptureManager(){this.capture_manager=new Wi({player:this.player,captured_callback:(t,e)=>{this.$refs.Twitter.addCaptureList(t,e)}});const t=this.$el.querySelector(".dplayer-icon.dplayer-capture-icon");t.addEventListener("click",(async()=>{await this.capture_manager.captureAndSave(!1)}));const e=this.$el.querySelector(".dplayer-icon.dplayer-comment-capture-icon");e.addEventListener("click",(async()=>{await this.capture_manager.captureAndSave(!0)}))},async destroy(t=!1,e=!1){this.$refs.Comment.destroy();for(const i of this.interval_ids)window.clearInterval(i);if(window.clearTimeout(this.control_interval_id),this.interval_ids=[],null!==this.data_broadcasting_manager&&(await this.data_broadcasting_manager.destroy(),this.data_broadcasting_manager=null),this.is_loading=!0,this.is_background_display=!1,null!==this.player&&(this.player_can_be_destroyed=!0),null!==this.eventsource&&(this.eventsource.close(),this.eventsource=null),!1===e){const t=this.player.user.get("volume");for(let e=0;e<20;e++)await pt.sleep(.01),this.player.video.volume=t*(1-(e+1)/20)}if(!0===t&&null!==this.player){try{this.player.destroy()}catch(s){void 0!==this.player.plugins.mpegts&&this.player.plugins.mpegts.destroy()}this.player_can_be_destroyed=!1,this.player=null}}}}),ra=na,oa=(0,p.Z)(ra,ti,ei,!1,null,"0dd9e1f3",null),la=oa.exports;o["default"].use(P.ZP);const ca=new P.ZP({mode:"history",base:"/",routes:[{path:"/",redirect:"/tv/"},{path:"/tv/",name:"TV Home",component:Xs},{path:"/tv/watch/:display_channel_id",name:"TV Watch",component:la},{path:"/settings/",name:"Settings Index",component:ls,beforeEnter:(t,e,s)=>{pt.isSmartphoneVertical()||pt.isSmartphoneHorizontal()||pt.isTabletVertical()?s():s({path:"/settings/general/"})}},{path:"/settings/general",name:"Settings General",component:ss},{path:"/settings/caption",name:"Settings Caption",component:Ae},{path:"/settings/data-broadcasting",name:"Settings Data Broadcasting",component:We},{path:"/settings/capture",name:"Settings Capture",component:Me},{path:"/settings/account",name:"Settings Account",component:Te},{path:"/settings/jikkyo",name:"Settings Jikkyo",component:Cs},{path:"/settings/twitter",name:"Settings Twitter",component:Ns},{path:"/settings/server",name:"Settings Server",component:Is},{path:"/login/",name:"Login",component:qt},{path:"/register/",name:"Register",component:oe},{path:"*",name:"NotFound",component:ee}],scrollBehavior(t,e,s){return s||{x:0,y:0}}});var _a=ca,da=s(95205);(0,da.z)("/service-worker.js",{ready(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered(){console.log("Service worker has been registered.")},cached(){console.log("Content has been cached for offline use.")},updatefound(){console.log("New content is downloading.")},updated(t){console.log("New content is available; please refresh."),N.show({message:"クライアントが新しいバージョンに更新されました。5秒後にリロードします。",timeout:1e4}),null!==t.waiting&&(t.waiting.postMessage({type:"SKIP_WAITING"}),t.waiting.addEventListener("statechange",(async t=>{"activated"===t.target.state&&(await pt.sleep(4),location.reload(!0))})))},offline(){console.log("No internet connection found. App is running in offline mode.")},error(t){console.error("Error during service worker registration:",t)}}),(0,n.OK)(),o["default"].config.productionTip=!1,o["default"].config.devtools=!0,o["default"].use(a.og);const ua=(0,a.WB)();o["default"].use(l.ZP),o["default"].use(_(),{top:!1,bottom:!0,color:"#433532",dark:!0,elevation:8,timeout:2500,autoRemove:!0,closeButtonContent:"閉じる",vuetifyInstance:B});const ma=pt.isTouchDevice()?[]:["hover","focus","touch"];r.ZP.options.themes.tooltip.showTriggers=ma,r.ZP.options.themes.tooltip.hideTriggers=ma,r.ZP.options.themes.tooltip.delay.show=0,r.ZP.options.offset=[0,7],o["default"].use(r.ZP),o["default"].component("Icon",i.JO),o["default"].component("v-tab-item-fix",w),o["default"].component("v-tabs-fix",x),o["default"].component("v-tabs-items-fix",O),window.KonomiTVVueInstance=new o["default"]({pinia:ua,router:_a,vuetify:B,render:t=>t(v)}).$mount("#app");let pa=!1;const ha=st();ha.$subscribe((async()=>{!0!==pa&&(console.log("Client Settings Changed:",ha.settings),Q(ha.settings),await ha.syncClientSettingsToServer())}),{detached:!0}),window.setInterval((async()=>{null!==pt.getAccessToken()&&!0===ha.settings.sync_settings&&(pa=!0,await ha.syncClientSettingsFromServer(),pa=!1,Q(ha.settings))}),3e3)},91343:function(){},2307:function(){},11004:function(){},4065:function(){},43450:function(){}},e={};function s(i){var a=e[i];if(void 0!==a)return a.exports;var n=e[i]={id:i,loaded:!1,exports:{}};return t[i].call(n.exports,n,n.exports,s),n.loaded=!0,n.exports}s.m=t,function(){var t=[];s.O=function(e,i,a,n){if(!i){var r=1/0;for(_=0;_<t.length;_++){i=t[_][0],a=t[_][1],n=t[_][2];for(var o=!0,l=0;l<i.length;l++)(!1&n||r>=n)&&Object.keys(s.O).every((function(t){return s.O[t](i[l])}))?i.splice(l--,1):(o=!1,n<r&&(r=n));if(o){t.splice(_--,1);var c=a();void 0!==c&&(e=c)}}return e}n=n||0;for(var _=t.length;_>0&&t[_-1][2]>n;_--)t[_]=t[_-1];t[_]=[i,a,n]}}(),function(){s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,{a:e}),e}}(),function(){s.d=function(t,e){for(var i in e)s.o(e,i)&&!s.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})}}(),function(){s.u=function(t){return"assets/js/"+t+".64d0cbac.js"}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){s.nmd=function(t){return t.paths=[],t.children||(t.children=[]),t}}(),function(){s.p="/"}(),function(){s.b=document.baseURI||self.location.href;var t={143:0};s.O.j=function(e){return 0===t[e]};var e=function(e,i){var a,n,r=i[0],o=i[1],l=i[2],c=0;if(r.some((function(e){return 0!==t[e]}))){for(a in o)s.o(o,a)&&(s.m[a]=o[a]);if(l)var _=l(s)}for(e&&e(i);c<r.length;c++)n=r[c],s.o(t,n)&&t[n]&&t[n][0](),t[n]=0;return s.O(_)},i=self["webpackChunkKonomiTV"]=self["webpackChunkKonomiTV"]||[];i.forEach(e.bind(null,0)),i.push=e.bind(null,i.push.bind(i))}();var i=s.O(void 0,[998],(function(){return s(40490)}));i=s.O(i)})();
//# sourceMappingURL=app.86789222.js.map