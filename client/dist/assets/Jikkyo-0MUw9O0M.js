import{G as _,d as S,m as b,M as a,U as A,X as k,u as y,_ as V,r as C,o as d,j as $,h as m,e as u,w as U,c as B,b as s,k as o,V as g,i as p,t as E,n as N,R as T,p as I,q as P}from"./index-Bpsr5pZW.js";import{C as R}from"./CommentMuteSettings-BMtGQr-I.js";import{S as M}from"./Base-CpN-yn6U.js";import{V as h}from"./VSlider-C62cxP1t.js";import{V as O}from"./VSwitch-DtBgy9L0.js";import"./VDialog-BzvmX_s3.js";import"./VTextField-DnJxvkLJ.js";import"./VAvatar-Bqoviica.js";import"./VCard-BM1EpQh2.js";import"./ssrBoot-BuXNXP-3.js";import"./VSelect-kDtpR6Dm.js";import"./Navigation-B2NwhCK2.js";class L{static async fetchAuthorizationURL(){const t=await _.get("/niconico/auth");return t.type==="error"?(_.showGenericError(t,"ニコニコアカウントとの連携用の認証 URL を取得できませんでした。"),null):t.data.authorization_url}static async logoutAccount(){const t=await _.delete("/niconico/logout");return t.type==="error"?(_.showGenericError(t,"ニコニコアカウントとの連携を解除できませんでした。"),!1):!0}}const w=L,W=S({name:"Settings-Jikkyo",components:{SettingsBase:M,CommentMuteSettings:R},data(){return{comment_mute_settings_modal:!1,is_loading:!0}},computed:{...b(y,k)},async created(){if(await this.userStore.fetchUser(),this.is_loading=!1,location.hash!==""){const e=new URLSearchParams(location.hash.replace("#",""));if(e.get("status")!==null&&e.get("detail")!==null){const t=parseInt(e.get("status")),c=e.get("detail");this.onOAuthCallbackReceived(t,c),history.replaceState(null,""," ")}}},methods:{async loginNiconicoAccount(){if(this.userStore.is_logged_in===!1){a.warning("連携をはじめるには、KonomiTV アカウントにログインしてください。");return}const e=await w.fetchAuthorizationURL();if(e===null)return;if(A.isMobileDevice()===!0){location.href=e;return}const t=window.open(e,"KonomiTV-OAuthPopup",A.getWindowFeatures());if(t===null){a.error("ポップアップウインドウを開けませんでした。");return}const c=async l=>{if(t.closed||A.typeof(l.data)!=="object"||!("KonomiTV-OAuthPopup"in l.data))return;t&&t.close(),window.removeEventListener("message",c);const F=l.data["KonomiTV-OAuthPopup"].status,f=l.data["KonomiTV-OAuthPopup"].detail;this.onOAuthCallbackReceived(F,f)};window.addEventListener("message",c)},async onOAuthCallbackReceived(e,t){if(console.log(`NiconicoAuthCallbackAPI: Status: ${e} / Detail: ${t}`),e!==200){if(t.startsWith("Authorization was denied (access_denied)"))a.error("ニコニコアカウントとの連携がキャンセルされました。");else if(t.startsWith("Failed to get access token (HTTP Error ")){const c=t.replace("Failed to get access token ","");a.error(`アクセストークンの取得に失敗しました。${c}`)}else if(t.startsWith("Failed to get access token (Connection Timeout)"))a.error("アクセストークンの取得に失敗しました。ニコニコで障害が発生している可能性があります。");else if(t.startsWith("Failed to get user information (HTTP Error ")){const c=t.replace("Failed to get user information ","");a.error(`ニコニコアカウントのユーザー情報の取得に失敗しました。${c}`)}else t.startsWith("Failed to get user information (Connection Timeout)")?a.error("ニコニコアカウントのユーザー情報の取得に失敗しました。ニコニコで障害が発生している可能性があります。"):a.error(`ニコニコアカウントとの連携に失敗しました。(${t})`);return}await this.userStore.fetchUser(!0),a.success("ニコニコアカウントと連携しました。")},async logoutNiconicoAccount(){await w.logoutAccount()!==!1&&(await this.userStore.fetchUser(!0),a.success("ニコニコアカウントとの連携を解除しました。"))}}}),n=e=>(I("data-v-6f662e88"),e=e(),P(),e),K={class:"settings__heading"},j=n(()=>u("span",{class:"ml-3"},"ニコニコ実況",-1)),z={key:0,class:"niconico-account niconico-account--anonymous"},G={class:"niconico-account-wrapper"},H=n(()=>u("div",{class:"niconico-account__info ml-4"},[u("div",{class:"niconico-account__info-name"},[u("span",{class:"niconico-account__info-name-text"},"ニコニコアカウントと連携していません")]),u("span",{class:"niconico-account__info-description"}," ニコニコアカウントと連携すると、テレビを見ながらニコニコ実況にコメントできるようになります。 ")],-1)),J={key:1,class:"niconico-account"},q={class:"niconico-account-wrapper"},X=["src"],Q={class:"niconico-account__info"},Y={class:"niconico-account__info-name"},Z={class:"niconico-account__info-name-text"},x={class:"niconico-account__info-description"},uu=n(()=>u("span",{class:"mr-2",style:{"white-space":"nowrap"}},"Niconico User ID:",-1)),eu=["href"],tu={key:0,class:"text-secondary"},su=n(()=>u("div",{class:"settings__item-label mt-7",style:{"border-left":"3px solid rgb(var(--v-theme-text-darken-1))","padding-left":"12px"}},[o(" コメントの透明度は、プレイヤー下にある設定アイコン ⚙️ から変更できます。"),u("br")],-1)),ou=n(()=>u("div",{class:"settings__item"},[u("div",{class:"settings__item-heading"},"コメントのミュート設定"),u("div",{class:"settings__item-label"},[o(" 表示したくないコメントを、映像上やコメントリストに表示しないようにミュートできます。"),u("br")]),u("div",{class:"settings__item-label mt-2"},[o(" デフォルトでは、下記のミュート設定がオンになっています。"),u("br"),o(" これらのコメントも表示したい方は、適宜オフに設定してください。"),u("br"),u("ul",{class:"ml-5 mt-2"},[u("li",null,"露骨な表現を含むコメントをミュートする"),u("li",null,"ネガティブな表現、差別的な表現、政治的に偏った表現を含むコメントをミュートする"),u("li",null,"文字サイズが大きいコメントをミュートする")])])],-1)),nu=n(()=>u("span",{class:"ml-1"},"コメントのミュート設定を開く",-1)),iu={class:"settings__item"},au=n(()=>u("div",{class:"settings__item-heading"},"コメントの速さ",-1)),cu=n(()=>u("div",{class:"settings__item-label"},[o(" プレイヤーに流れるコメントの速さを設定します。"),u("br"),o(" たとえば 1.2 に設定すると、コメントが 1.2 倍速く流れます。"),u("br")],-1)),ru={class:"settings__item"},lu=n(()=>u("div",{class:"settings__item-heading"},"コメントの文字サイズ",-1)),du=n(()=>u("div",{class:"settings__item-label"},[o(" プレイヤーに流れるコメントの文字サイズの基準値を設定します。"),u("br"),o(" 実際の文字サイズは画面サイズに合わせて調整されます。デフォルトの文字サイズは 34px です。"),u("br")],-1)),_u={class:"settings__item settings__item--switch"},mu=n(()=>u("label",{class:"settings__item-heading",for:"close_comment_form_after_sending"},"コメント送信後にコメント入力フォームを閉じる",-1)),Bu=n(()=>u("label",{class:"settings__item-label",for:"close_comment_form_after_sending"},[o(" この設定をオンにすると、コメントを送信した後に、コメント入力フォームが自動で閉じるようになります。"),u("br"),o(" コメント入力フォームが表示されたままだと、大半のショートカットキーが文字入力と競合して使えなくなります。とくに理由がなければ、オンにしておくのがおすすめです。"),u("br")],-1));function Au(e,t,c,l,F,f){const r=C("Icon"),D=C("CommentMuteSettings"),v=C("SettingsBase");return d(),$(v,null,{default:m(()=>[u("h2",K,[U((d(),B("a",{class:"settings__back-button",onClick:t[0]||(t[0]=i=>e.$router.back())},[s(r,{icon:"fluent:arrow-left-12-filled",width:"25px"})])),[[T]]),s(r,{icon:"bi:chat-left-text-fill",width:"19px"}),j]),u("div",{class:N(["settings__content",{"settings__content--loading":e.is_loading}])},[e.userStore.user===null||e.userStore.user.niconico_user_id===null?(d(),B("div",z,[u("div",G,[s(r,{class:"flex-shrink-0",icon:"bi:chat-left-text-fill",width:"45px"}),H]),s(g,{class:"niconico-account__login ml-auto",color:"secondary",width:"130",height:"56",variant:"flat",onClick:t[1]||(t[1]=i=>e.loginNiconicoAccount())},{default:m(()=>[s(r,{icon:"fluent:plug-connected-20-filled",class:"mr-2",height:"26"}),o("連携する ")]),_:1})])):p("",!0),e.userStore.user!==null&&e.userStore.user.niconico_user_id!==null?(d(),B("div",J,[u("div",q,[u("img",{class:"niconico-account__icon",src:e.userStore.user_niconico_icon_url??""},null,8,X),u("div",Q,[u("div",Y,[u("span",Z,E(e.userStore.user.niconico_user_name)+" と連携しています",1)]),u("span",x,[uu,u("a",{class:"link mr-2",href:`https://www.nicovideo.jp/user/${e.userStore.user.niconico_user_id}`,target:"_blank"},E(e.userStore.user.niconico_user_id),9,eu),e.userStore.user.niconico_user_premium===!0?(d(),B("span",tu,"(Premium)")):p("",!0)])])]),s(g,{class:"niconico-account__login ml-auto",color:"secondary",width:"130",height:"56",variant:"flat",onClick:t[2]||(t[2]=i=>e.logoutNiconicoAccount())},{default:m(()=>[s(r,{icon:"fluent:plug-disconnected-20-filled",class:"mr-2",height:"26"}),o("連携解除 ")]),_:1})])):p("",!0),su,ou,s(g,{class:"settings__save-button mt-4",variant:"flat",onClick:t[3]||(t[3]=i=>e.comment_mute_settings_modal=!e.comment_mute_settings_modal)},{default:m(()=>[s(r,{icon:"heroicons-solid:filter",height:"19px"}),nu]),_:1}),u("div",iu,[au,cu,s(h,{class:"settings__item-form",color:"primary","show-ticks":"always","thumb-label":"","hide-details":"",step:.1,min:.5,max:2,modelValue:e.settingsStore.settings.comment_speed_rate,"onUpdate:modelValue":t[4]||(t[4]=i=>e.settingsStore.settings.comment_speed_rate=i)},null,8,["modelValue"])]),u("div",ru,[lu,du,s(h,{class:"settings__item-form",color:"primary","show-ticks":"always","thumb-label":"","hide-details":"",step:1,min:20,max:60,modelValue:e.settingsStore.settings.comment_font_size,"onUpdate:modelValue":t[5]||(t[5]=i=>e.settingsStore.settings.comment_font_size=i)},null,8,["modelValue"])]),u("div",_u,[mu,Bu,s(O,{class:"settings__item-switch",color:"primary",id:"close_comment_form_after_sending","hide-details":"",modelValue:e.settingsStore.settings.close_comment_form_after_sending,"onUpdate:modelValue":t[6]||(t[6]=i=>e.settingsStore.settings.close_comment_form_after_sending=i)},null,8,["modelValue"])])],2),s(D,{modelValue:e.comment_mute_settings_modal,"onUpdate:modelValue":t[7]||(t[7]=i=>e.comment_mute_settings_modal=i)},null,8,["modelValue"])]),_:1})}const ku=V(W,[["render",Au],["__scopeId","data-v-6f662e88"]]);export{ku as default};
