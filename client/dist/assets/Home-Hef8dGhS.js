import{B as I}from"./VPagination-CNOreGiL.js";import{H as w,N as B}from"./Navigation-DRu8CUck.js";import{R as M,a as A}from"./ReservationList-DmxlB_b4.js";import{S as L}from"./SPHeaderBar-CvAX7FM2.js";import{d as S,q as i,x as U,y as E,c as H,a as n,b as u,n as N,L as c,o as O,_ as P}from"./index-CjuqmTYK.js";import"./ssrBoot-DTvgNvsM.js";import"./VSwitch-DSctGW4a.js";import"./VTextField-BsuD9qF0.js";import"./VAvatar-BEh1mZVx.js";import"./VChip-U7hEpf5X.js";import"./VSlider-CP471AdF.js";import"./VSelect-CWnbbzqK.js";import"./VDialog-9YvBc2Ri.js";import"./VCard-BLmwjObN.js";const b={class:"route-container"},F={class:"reservations-home-container-wrapper"},T={class:"reservations-home-container"},k=30*1e3,x=10,C=S({__name:"Home",setup(D){const l=i([]),p=i(0),t=i(!0),r=i(null),v={upcomingReservations:async()=>{const e=await A.fetchReservations();if(e){const a=c(),d=e.reservations.filter(s=>{const o=c(s.program.start_time),R=o.isAfter(a)&&o.isBefore(a.add(24,"hours")),y=s.is_recording_in_progress;return R||y}).sort((s,o)=>s.is_recording_in_progress&&!o.is_recording_in_progress?-1:!s.is_recording_in_progress&&o.is_recording_in_progress?1:c(s.program.start_time).valueOf()-c(o.program.start_time).valueOf());p.value=d.length,l.value=d.slice(0,x)}}},m=async()=>{try{await Promise.all(Object.values(v).map(e=>e())),t.value=!1}catch(e){console.error("Failed to update reservation sections:",e),t.value=!1}},_=e=>{console.log(`Reservation ${e} deleted, refreshing list...`),m()},g=()=>{r.value===null&&(m(),r.value=window.setInterval(m,k))},f=()=>{r.value!==null&&(clearInterval(r.value),r.value=null)};return U(()=>{g()}),E(()=>{f()}),(e,a)=>(O(),H("div",b,[n(w),u("main",null,[n(B),u("div",F,[n(L),u("div",T,[n(I,{crumbs:[{name:"ホーム",path:"/"},{name:"録画予約",path:"/reservations/",disabled:!0}]}),n(M,{class:N(["reservations-home-container__upcoming-reservations",{"reservations-home-container__upcoming-reservations--loading":l.value.length===0&&t.value}]),title:"放送が近い録画予約",reservations:l.value,total:p.value,hideSort:!0,hidePagination:!0,showMoreButton:!0,isLoading:t.value,showEmptyMessage:!t.value,emptyIcon:"mdi-calendar-clock",emptyMessage:"放送が近い録画予約はありません。",emptySubMessage:"番組表から録画予約を追加できます。",onMore:a[0]||(a[0]=h=>e.$router.push("/reservations/all")),onDelete:_},null,8,["class","reservations","total","isLoading","showEmptyMessage"])])])])]))}}),oe=P(C,[["__scopeId","data-v-d95a52d0"]]);export{oe as default};
