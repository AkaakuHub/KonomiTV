import{D as m,d as k,m as y,M as i,U as g,L as V,u as U,_ as $,r as B,o as _,h as F,w as d,e as t,j as N,b as s,c as p,i as c,V as f,l as h,t as E,n as T,R as I,p as P,q as R}from"./index-5OUeYcSl.js";import{C as L}from"./CommentMuteSettings-68I01y2p.js";import{S as M}from"./Base-KS56v-a7.js";import{V as w}from"./VSlider-m3as6mch.js";import{V as O}from"./VSwitch-EJoU6bFM.js";import"./VDialog-4P4AWN6p.js";import"./VTextField-tU7KVmXL.js";import"./VAvatar-_6R_QnDS.js";import"./VCard-dUkp22kE.js";import"./ssrBoot-FqnYgnwP.js";import"./VSelect-3fDlnBUc.js";import"./Navigation-lN4olgXy.js";class W{static async fetchAuthorizationURL(){const e=await m.get("/niconico/auth");return e.type==="error"?(m.showGenericError(e,"ニコニコアカウントとの連携用の認証 URL を取得できませんでした。"),null):e.data.authorization_url}static async logoutAccount(){const e=await m.delete("/niconico/logout");return e.type==="error"?(m.showGenericError(e,"ニコニコアカウントとの連携を解除できませんでした。"),!1):!0}}const S=W,K=k({name:"Settings-Jikkyo",components:{SettingsBase:M,CommentMuteSettings:L},data(){return{comment_mute_settings_modal:!1,is_loading:!0}},computed:{...y(U,V)},async created(){if(await this.userStore.fetchUser(),this.is_loading=!1,location.hash!==""){const u=new URLSearchParams(location.hash.replace("#",""));if(u.get("status")!==null&&u.get("detail")!==null){const e=parseInt(u.get("status")),a=u.get("detail");this.onOAuthCallbackReceived(e,a),history.replaceState(null,""," ")}}},methods:{async loginNiconicoAccount(){if(this.userStore.is_logged_in===!1){i.warning("連携をはじめるには、KonomiTV アカウントにログインしてください。");return}const u=await S.fetchAuthorizationURL();if(u===null)return;if(g.isMobileDevice()===!0){location.href=u;return}const e=window.open(u,"KonomiTV-OAuthPopup",g.getWindowFeatures());if(e===null){i.error("ポップアップウインドウを開けませんでした。");return}const a=async l=>{if(e.closed||g.typeof(l.data)!=="object"||!("KonomiTV-OAuthPopup"in l.data))return;e&&e.close(),window.removeEventListener("message",a);const A=l.data["KonomiTV-OAuthPopup"].status,C=l.data["KonomiTV-OAuthPopup"].detail;this.onOAuthCallbackReceived(A,C)};window.addEventListener("message",a)},async onOAuthCallbackReceived(u,e){if(console.log(`NiconicoAuthCallbackAPI: Status: ${u} / Detail: ${e}`),u!==200){if(e.startsWith("Authorization was denied (access_denied)"))i.error("ニコニコアカウントとの連携がキャンセルされました。");else if(e.startsWith("Failed to get access token (HTTP Error ")){const a=e.replace("Failed to get access token ","");i.error(`アクセストークンの取得に失敗しました。${a}`)}else if(e.startsWith("Failed to get access token (Connection Timeout)"))i.error("アクセストークンの取得に失敗しました。ニコニコで障害が発生している可能性があります。");else if(e.startsWith("Failed to get user information (HTTP Error ")){const a=e.replace("Failed to get user information ","");i.error(`ニコニコアカウントのユーザー情報の取得に失敗しました。${a}`)}else e.startsWith("Failed to get user information (Connection Timeout)")?i.error("ニコニコアカウントのユーザー情報の取得に失敗しました。ニコニコで障害が発生している可能性があります。"):i.error(`ニコニコアカウントとの連携に失敗しました。(${e})`);return}await this.userStore.fetchUser(!0),i.success("ニコニコアカウントと連携しました。")},async logoutNiconicoAccount(){await S.logoutAccount()!==!1&&(await this.userStore.fetchUser(!0),i.success("ニコニコアカウントとの連携を解除しました。"))}}}),o=u=>(P("data-v-d9abe42b"),u=u(),R(),u),j={class:"settings__heading"},z=o(()=>t("span",{class:"ml-3"},"ニコニコ実況",-1)),G={key:0,class:"niconico-account niconico-account--anonymous"},H={class:"niconico-account-wrapper"},J=o(()=>t("div",{class:"niconico-account__info ml-4"},[t("div",{class:"niconico-account__info-name"},[t("span",{class:"niconico-account__info-name-text"},"ニコニコアカウントと連携していません")]),t("span",{class:"niconico-account__info-description"}," ニコニコアカウントと連携すると、テレビを見ながらニコニコ実況にコメントできるようになります。 ")],-1)),q={key:1,class:"niconico-account"},Q={class:"niconico-account-wrapper"},X=["src"],Y={class:"niconico-account__info"},Z={class:"niconico-account__info-name"},x={class:"niconico-account__info-name-text"},uu={class:"niconico-account__info-description"},eu=o(()=>t("span",{class:"mr-2",style:{"white-space":"nowrap"}},"Niconico User ID:",-1)),tu=["href"],su={key:0,class:"text-secondary"},ou=o(()=>t("div",{class:"settings__item mt-7"},[t("div",{class:"settings__item-heading"},"コメントのミュート設定"),t("div",{class:"settings__item-label"},[c(" 表示したくないコメントを、映像上やコメントリストに表示しないようにミュートできます。"),t("br")])],-1)),nu=o(()=>t("span",{class:"ml-1"},"コメントのミュート設定を開く",-1)),iu={class:"settings__item"},au=o(()=>t("div",{class:"settings__item-heading"},"コメントの速さ",-1)),cu=o(()=>t("div",{class:"settings__item-label"},[c(" プレイヤーに流れるコメントの速さを設定します。"),t("br"),c(" たとえば 1.2 に設定すると、コメントが 1.2 倍速く流れます。"),t("br")],-1)),ru={class:"settings__item"},lu=o(()=>t("div",{class:"settings__item-heading"},"コメントの文字サイズ",-1)),_u=o(()=>t("div",{class:"settings__item-label"},[c(" プレイヤーに流れるコメントの文字サイズの基準値を設定します。"),t("br"),c(" 実際の文字サイズは画面サイズに合わせて調整されます。デフォルトの文字サイズは 34px です。"),t("br")],-1)),du={class:"settings__item settings__item--switch"},mu=o(()=>t("label",{class:"settings__item-heading",for:"close_comment_form_after_sending"},"コメント送信後にコメント入力フォームを閉じる",-1)),Bu=o(()=>t("label",{class:"settings__item-label",for:"close_comment_form_after_sending"},[c(" この設定をオンにすると、コメントを送信した後に、コメント入力フォームが自動で閉じるようになります。"),t("br"),c(" コメント入力フォームが表示されたままだと、大半のショートカットキーが文字入力と競合して使えなくなります。とくに理由がなければ、オンにしておくのがおすすめです。"),t("br")],-1));function gu(u,e,a,l,A,C){const r=B("Icon"),v=B("router-link"),b=B("CommentMuteSettings"),D=B("SettingsBase");return _(),F(D,null,{default:d(()=>[t("h2",j,[N((_(),F(v,{class:"settings__back-button",to:"/settings/"},{default:d(()=>[s(r,{icon:"fluent:arrow-left-12-filled",width:"25px"})]),_:1})),[[I]]),s(r,{icon:"bi:chat-left-text-fill",width:"19px"}),z]),t("div",{class:T(["settings__content",{"settings__content--loading":u.is_loading}])},[u.userStore.user===null||u.userStore.user.niconico_user_id===null?(_(),p("div",G,[t("div",H,[s(r,{class:"flex-shrink-0",icon:"bi:chat-left-text-fill",width:"45px"}),J]),s(f,{class:"niconico-account__login ml-auto",color:"secondary",width:"130",height:"56",variant:"flat",onClick:e[0]||(e[0]=n=>u.loginNiconicoAccount())},{default:d(()=>[s(r,{icon:"fluent:plug-connected-20-filled",class:"mr-2",height:"26"}),c("連携する ")]),_:1})])):h("",!0),u.userStore.user!==null&&u.userStore.user.niconico_user_id!==null?(_(),p("div",q,[t("div",Q,[t("img",{class:"niconico-account__icon",src:u.userStore.user_niconico_icon_url??""},null,8,X),t("div",Y,[t("div",Z,[t("span",x,E(u.userStore.user.niconico_user_name)+" と連携しています",1)]),t("span",uu,[eu,t("a",{class:"link mr-2",href:`https://www.nicovideo.jp/user/${u.userStore.user.niconico_user_id}`,target:"_blank"},E(u.userStore.user.niconico_user_id),9,tu),u.userStore.user.niconico_user_premium===!0?(_(),p("span",su,"(Premium)")):h("",!0)])])]),s(f,{class:"niconico-account__login ml-auto",color:"secondary",width:"130",height:"56",variant:"flat",onClick:e[1]||(e[1]=n=>u.logoutNiconicoAccount())},{default:d(()=>[s(r,{icon:"fluent:plug-disconnected-20-filled",class:"mr-2",height:"26"}),c("連携解除 ")]),_:1})])):h("",!0),ou,s(f,{class:"settings__save-button mt-4",variant:"flat",onClick:e[2]||(e[2]=n=>u.comment_mute_settings_modal=!u.comment_mute_settings_modal)},{default:d(()=>[s(r,{icon:"heroicons-solid:filter",height:"19px"}),nu]),_:1}),t("div",iu,[au,cu,s(w,{class:"settings__item-form",color:"primary","show-ticks":"always","thumb-label":"","hide-details":"",step:.1,min:.5,max:2,modelValue:u.settingsStore.settings.comment_speed_rate,"onUpdate:modelValue":e[3]||(e[3]=n=>u.settingsStore.settings.comment_speed_rate=n)},null,8,["modelValue"])]),t("div",ru,[lu,_u,s(w,{class:"settings__item-form",color:"primary","show-ticks":"always","thumb-label":"","hide-details":"",step:1,min:20,max:60,modelValue:u.settingsStore.settings.comment_font_size,"onUpdate:modelValue":e[4]||(e[4]=n=>u.settingsStore.settings.comment_font_size=n)},null,8,["modelValue"])]),t("div",du,[mu,Bu,s(O,{class:"settings__item-switch",color:"primary",id:"close_comment_form_after_sending","hide-details":"",modelValue:u.settingsStore.settings.close_comment_form_after_sending,"onUpdate:modelValue":e[5]||(e[5]=n=>u.settingsStore.settings.close_comment_form_after_sending=n)},null,8,["modelValue"])])],2),s(b,{modelValue:u.comment_mute_settings_modal,"onUpdate:modelValue":e[6]||(e[6]=n=>u.comment_mute_settings_modal=n)},null,8,["modelValue"])]),_:1})}const ku=$(K,[["render",gu],["__scopeId","data-v-d9abe42b"]]);export{ku as default};
