import{G as g,d as I,U as b,$ as T,N as H,cu as A,cm as S,r as $,o as c,j as F,h as u,e,w as V,c as v,b as a,L as r,g as x,F as U,V as p,k as i,n as N,M as h,R as k}from"./index-DVlBCQF_.js";import{V as G}from"./Navigation-np_90lmr.js";import{S as L}from"./Base-CctTO7F0.js";import{c as E}from"./VSelect-CqWiR88f.js";import{V as y}from"./VSwitch-B60olD5v.js";import{b as m}from"./VTextField-ty5YOUpH.js";import{V as R}from"./VSlider-DbWYol-n.js";import"./ssrBoot-imu4p4jQ.js";import"./VAvatar-DeeZNm4U.js";class w{static async updateDatabase(){const o=await g.post("/maintenance/update-database");if(o.type==="error")switch(o.data.detail){default:g.showGenericError(o,"データベースを更新できませんでした。");break}}static async restartServer(){const o=await g.post("/maintenance/restart");if(o.type==="error")switch(o.data.detail){default:g.showGenericError(o,"サーバーを再起動できませんでした。");break}}static async shutdownServer(){const o=await g.post("/maintenance/shutdown");if(o.type==="error")switch(o.data.detail){default:g.showGenericError(o,"サーバーをシャットダウンできませんでした。");break}}}const Z={class:"settings__heading"},Q=e("span",{class:"ml-2"},"サーバー設定",-1),W=e("div",{class:"settings__description"},[i(" サーバー設定を変更するには、管理者アカウントでログインしている必要があります。"),e("br")],-1),z=e("div",{class:"settings__description mt-1"},[i(" [サーバー設定を更新] ボタンを押さずにこのページから離れると、変更内容は破棄されます。"),e("br"),i(" 変更を反映するには KonomiTV サーバーの再起動が必要です。"),e("br")],-1),j={class:"settings__content-heading"},q=e("span",{class:"ml-2"},"全般",-1),J={class:"settings__item"},O=e("div",{class:"settings__item-heading"},"利用するバックエンド",-1),X=e("div",{class:"settings__item-label"},[i(" EDCB・Mirakurun のいずれかを選択してください。"),e("br"),i(" バックエンドに Mirakurun が選択されているときは、録画予約機能は利用できません。"),e("br")],-1),Y={class:"settings__item settings__item--switch"},ee=e("label",{class:"settings__item-heading",for:"always_receive_tv_from_mirakurun"},"常に Mirakurun / mirakc から放送波を受信する",-1),te=e("label",{class:"settings__item-label",for:"always_receive_tv_from_mirakurun"},[i(" 利用するバックエンドが EDCB のとき、常に Mirakurun / mirakc から放送波を受信するかを設定します。 バックエンドに Mirakurun が選択されているときは効果がありません。"),e("br")],-1),se=e("label",{class:"settings__item-label mt-1",for:"always_receive_tv_from_mirakurun"},[i(" KonomiTV から EDCB と Mirakurun / mirakc 両方にアクセスできる必要があります。"),e("br"),i(" EDCB はチューナー起動やチャンネル切り替えに時間がかかるため、Mirakurun / mirakc が利用できる環境であれば、この設定を有効にするとより快適に使えます。"),e("br")],-1),ie={class:"settings__item"},ae=e("div",{class:"settings__item-heading"},"EDCB (EpgTimerNW) の TCP API の URL",-1),le=e("div",{class:"settings__item-label"},[i(" バックエンドに EDCB が選択されているときに利用されます。"),e("br"),i(" tcp://edcb-namedpipe/ と指定すると、TCP API の代わりに名前付きパイプを使って通信します (ローカルのみ)。"),e("br")],-1),oe=e("div",{class:"settings__item-label mt-1"},[i(" 一部 Windows 環境では localhost の名前解決が遅いため、ストリーミング開始までの待機時間が長くなる場合があります。 EDCB と同じ PC に KonomiTV をインストールしている場合、localhost ではなく 127.0.0.1 の利用を推奨します。"),e("br")],-1),ne={class:"settings__item"},re=e("div",{class:"settings__item-heading"},"Mirakurun / mirakc の HTTP API の URL",-1),de=e("div",{class:"settings__item-label"},[i(" バックエンドに Mirakurun が選択されているときに利用されます。"),e("br")],-1),_e=e("div",{class:"settings__item-label mt-1"},[i(" 一部 Windows 環境では localhost の名前解決が遅いため、ストリーミング開始までの待機時間が長くなる場合があります。 Mirakurun / mirakc と同じ PC に KonomiTV をインストールしている場合、localhost ではなく 127.0.0.1 の利用を推奨します。"),e("br")],-1),ce={class:"settings__item"},me=e("div",{class:"settings__item-heading"},"利用するエンコーダー",-1),ue=e("div",{class:"settings__item-label"},[i(" FFmpeg はソフトウェアエンコーダーです。"),e("br"),i(" すべての PC で利用できますが、CPU に多大な負荷がかかり、パフォーマンスが悪いです。"),e("br")],-1),ve=e("div",{class:"settings__item-label mt-1"},[i(" QSVEncC・NVEncC・VCEEncC・rkmppenc はハードウェアエンコーダーです。"),e("br"),i(" CPU 負荷が低く、パフォーマンスがとても高いです（おすすめ）。"),e("br")],-1),ge={class:"settings__item"},pe=e("div",{class:"settings__item-heading"},"番組情報の更新間隔 (分)",-1),he=e("div",{class:"settings__item-label"},[i(" 番組情報を EDCB または Mirakurun / mirakc から取得する間隔を設定します。デフォルトは 5 (分) です。"),e("br")],-1),fe={class:"settings__item settings__item--switch"},be=e("label",{class:"settings__item-heading",for:"debug"},"デバッグモードを有効にする",-1),Ve=e("label",{class:"settings__item-label",for:"debug"},[i(" 有効にすると、デバッグログも出力されるようになります。"),e("br")],-1),ke={class:"settings__item settings__item--switch"},ye=e("label",{class:"settings__item-heading",for:"debug_encoder"},"エンコーダーのログを有効にする",-1),we=e("label",{class:"settings__item-label",for:"debug_encoder"},[i(" 有効にすると、エンコーダーのログが server/logs/ 以下に保存されます。 さらにデバッグモードが有効のときは、デバッグログとしてリアルタイムにエンコーダーのログが出力されます。"),e("br")],-1),Ce={class:"settings__content-heading mt-6"},Te=e("span",{class:"ml-2"},"サーバー",-1),Se={class:"settings__item"},xe=e("div",{class:"settings__item-heading"},"KonomiTV サーバーのリッスンポート",-1),Ue=e("div",{class:"settings__item-label"},[i(" デフォルトのリッスンポートは 7000 です。"),e("br")],-1),Ee={class:"settings__item"},Pe=e("div",{class:"settings__item-heading"},"HTTPS リバースプロキシのカスタム HTTPS 証明書/秘密鍵ファイルへの絶対パス",-1),Ke=e("div",{class:"settings__item-label"},[i(" 設定すると、カスタム HTTPS 証明書を使って HTTPS リバースプロキシを開始します。"),e("br"),i(" カスタム HTTPS 証明書を有効化すると、https://192-168-x-xx.local.konomi.tv:7000/ の URL では KonomiTV にアクセスできなくなります。"),e("br"),i(" 基本空欄のままで問題ありません。HTTPS 証明書について詳細に理解している方のみ設定してください。"),e("br")],-1),Me={class:"settings__content-heading mt-6"},Be=e("span",{class:"ml-2"},"テレビのライブストリーミング",-1),De={class:"settings__item"},Ie=e("div",{class:"settings__item-heading"},"誰も見ていないチャンネルのエンコードタスクを何秒まで維持するか",-1),He=e("div",{class:"settings__item-label"},[i(" 10 秒に設定したなら、10 秒間誰も見ていない状態が継続したらエンコードタスク（エンコーダー）を終了します。"),e("br"),i(" 0 秒に設定すると、リロードしただけでチューナーとエンコーダーの起動がやり直しになってしまいます。余裕をもたせておく事をおすすめします。"),e("br")],-1),Ae={class:"settings__content-heading mt-6"},$e=e("span",{class:"ml-2"},"ビデオのオンデマンドストリーミング",-1),Fe={class:"settings__item"},Ne=e("div",{class:"settings__item-heading"},"録画済み番組の保存先フォルダの絶対パス",-1),Ge=e("div",{class:"settings__item-label",style:{"padding-bottom":"2px"}},[i(" 複数の保存先フォルダを指定できます。"),e("br")],-1),Le={class:"d-flex align-center mt-3"},Re=["onClick"],Ze=e("svg",{class:"iconify iconify--fluent",width:"20px",height:"20px",viewBox:"0 0 16 16"},[e("path",{fill:"currentColor",d:"M7 3h2a1 1 0 0 0-2 0ZM6 3a2 2 0 1 1 4 0h4a.5.5 0 0 1 0 1h-.564l-1.205 8.838A2.5 2.5 0 0 1 9.754 15H6.246a2.5 2.5 0 0 1-2.477-2.162L2.564 4H2a.5.5 0 0 1 0-1h4Zm1 3.5a.5.5 0 0 0-1 0v5a.5.5 0 0 0 1 0v-5ZM9.5 6a.5.5 0 0 0-.5.5v5a.5.5 0 0 0 1 0v-5a.5.5 0 0 0-.5-.5Z"})],-1),Qe=[Ze],We=e("span",{class:"ml-1"},"保存先フォルダを追加",-1),ze={class:"settings__content-heading mt-6"},je=e("span",{class:"ml-2"},"キャプチャ",-1),qe={class:"settings__item"},Je=e("div",{class:"settings__item-heading"},"アップロードしたキャプチャ画像の保存先フォルダの絶対パス",-1),Oe=e("div",{class:"settings__item-label"},[i(" クライアントの [キャプチャの保存先] 設定で [KonomiTV サーバーにアップロード] または [ブラウザでのダウンロードと、KonomiTV サーバーへのアップロードを両方行う] が選択されているときに利用されます。"),e("br")],-1),Xe=e("div",{class:"settings__item-label mt-1",style:{"padding-bottom":"2px"}},[i(" 複数の保存先フォルダを指定できます。先頭から順に利用され、保存先フォルダがいっぱいになったら次の保存先フォルダに保存されます。"),e("br")],-1),Ye={class:"d-flex align-center mt-3"},et=["onClick"],tt=e("svg",{class:"iconify iconify--fluent",width:"20px",height:"20px",viewBox:"0 0 16 16"},[e("path",{fill:"currentColor",d:"M7 3h2a1 1 0 0 0-2 0ZM6 3a2 2 0 1 1 4 0h4a.5.5 0 0 1 0 1h-.564l-1.205 8.838A2.5 2.5 0 0 1 9.754 15H6.246a2.5 2.5 0 0 1-2.477-2.162L2.564 4H2a.5.5 0 0 1 0-1h4Zm1 3.5a.5.5 0 0 0-1 0v5a.5.5 0 0 0 1 0v-5ZM9.5 6a.5.5 0 0 0-.5.5v5a.5.5 0 0 0 1 0v-5a.5.5 0 0 0-.5-.5Z"})],-1),st=[tt],it=e("span",{class:"ml-1"},"保存先フォルダを追加",-1),at={class:"settings__content-heading mt-8"},lt=e("span",{class:"ml-2"},"メンテナンス",-1),ot=e("div",{class:"settings__item"},[e("div",{class:"settings__item-heading"},"KonomiTV のデータベースを更新"),e("div",{class:"settings__item-label"},[i(" KonomiTV のデータベースに保存されている、チャンネル情報・番組情報・Twitter アカウント情報などの外部 API に依存するデータをすべて更新します。"),e("br"),i(" 即座に外部 API からのデータ更新を反映させたいときに利用してください。"),e("br")])],-1),nt=e("span",{class:"ml-2"},"データベースを更新",-1),rt=e("div",{class:"settings__item"},[e("div",{class:"settings__item-heading text-error-lighten-1"},"KonomiTV サーバーを再起動"),e("div",{class:"settings__item-label"},[i(" KonomiTV サーバーを再起動します。"),e("br"),i(" サーバー設定の変更を反映するためには、再起動が必要です。"),e("br"),e("strong",null,"再起動を実行すると、すべての視聴中セッションが切断されます。"),i("十分注意してください。"),e("br")])],-1),dt=e("span",{class:"ml-2"},"KonomiTV サーバーを再起動",-1),_t=e("div",{class:"settings__item"},[e("div",{class:"settings__item-heading text-error-lighten-1"},"KonomiTV サーバーをシャットダウン"),e("div",{class:"settings__item-label"},[i(" KonomiTV サーバーをシャットダウンします。"),e("br"),e("strong",null,"シャットダウンを実行すると、再度手動で KonomiTV サーバーを起動するまで KonomiTV にアクセスできなくなります。"),i("十分注意してください。"),e("br")]),e("div",{class:"settings__item-label mt-1"},[i(" なお、Linux 版 KonomiTV サーバーはプロセス管理を PM2 / Docker に委譲しているため、シャットダウン後は自動で再起動されます。完全にシャットダウンするには、PM2 / Docker 側でサービスを停止してください。"),e("br")])],-1),ct=e("span",{class:"ml-2"},"KonomiTV サーバーをシャットダウン",-1),yt=I({__name:"Server",setup(P){const o=b.isSmartphoneHorizontal(),C=T(!0);H().fetchUser().then(_=>{_&&_.is_admin&&(C.value=!1)});const t=T(structuredClone(A));S.fetchServerSettings().then(_=>{_&&(t.value=_)});async function K(){t.value.server.custom_https_certificate===""&&(t.value.server.custom_https_certificate=null),t.value.server.custom_https_private_key===""&&(t.value.server.custom_https_private_key=null),await S.updateServerSettings(t.value)===!0&&h.success(`サーバー設定を更新しました。
変更を反映するためには、KonomiTV サーバーを再起動してください。`)}async function M(){h.show("データベースを更新しています..."),await w.updateDatabase(),h.success("データベースを更新しました。")}async function B(){for(await w.restartServer(),h.show("KonomiTV サーバーを再起動しています..."),await b.sleep(1);await G.fetchServerVersion(!0)===null;)await b.sleep(1);h.success("KonomiTV サーバーを再起動しました。")}async function D(){await w.shutdownServer(),h.success("KonomiTV サーバーをシャットダウンしました。")}return(_,s)=>{const n=$("Icon");return c(),F(L,null,{default:u(()=>[e("h2",Z,[V((c(),v("a",{class:"settings__back-button",onClick:s[0]||(s[0]=l=>_.$router.back())},[a(n,{icon:"fluent:arrow-left-12-filled",width:"25px"})])),[[k]]),a(n,{icon:"fluent:server-surface-16-filled",width:"22px"}),Q]),W,z,e("div",{class:N(["settings__content",{"settings__content--disabled":C.value}])},[e("div",j,[a(n,{icon:"fa-solid:sliders-h",width:"22px",style:{padding:"0 3px"}}),q]),e("div",J,[O,X,a(E,{class:"settings__item-form",color:"primary",variant:"outlined","hide-details":"",density:r(o)?"compact":"default",items:["EDCB","Mirakurun"],modelValue:t.value.general.backend,"onUpdate:modelValue":s[1]||(s[1]=l=>t.value.general.backend=l)},null,8,["density","modelValue"])]),e("div",Y,[ee,te,se,a(y,{class:"settings__item-switch",color:"primary",id:"always_receive_tv_from_mirakurun","hide-details":"",modelValue:t.value.general.always_receive_tv_from_mirakurun,"onUpdate:modelValue":s[2]||(s[2]=l=>t.value.general.always_receive_tv_from_mirakurun=l)},null,8,["modelValue"])]),e("div",ie,[ae,le,oe,a(m,{class:"settings__item-form",color:"primary",variant:"outlined","hide-details":"",density:r(o)?"compact":"default",modelValue:t.value.general.edcb_url,"onUpdate:modelValue":s[3]||(s[3]=l=>t.value.general.edcb_url=l)},null,8,["density","modelValue"])]),e("div",ne,[re,de,_e,a(m,{class:"settings__item-form",color:"primary",variant:"outlined","hide-details":"",density:r(o)?"compact":"default",modelValue:t.value.general.mirakurun_url,"onUpdate:modelValue":s[4]||(s[4]=l=>t.value.general.mirakurun_url=l)},null,8,["density","modelValue"])]),e("div",ce,[me,ue,ve,a(E,{class:"settings__item-form",color:"primary",variant:"outlined","hide-details":"",density:r(o)?"compact":"default",items:[{title:"FFmpeg : ソフトウェアエンコーダー",value:"FFmpeg"},{title:"QSVEncC : Intel Graphics 搭載 CPU / Intel Arc GPU で利用可能",value:"QSVEncC"},{title:"NVEncC : NVIDIA GPU で利用可能",value:"NVEncC"},{title:"VCEEncC : AMD GPU で利用可能",value:"VCEEncC"},{title:"rkmppenc : Rockchip RK3588 系 SoC 搭載 SBC で利用可能",value:"rkmppenc"}],modelValue:t.value.general.encoder,"onUpdate:modelValue":s[5]||(s[5]=l=>t.value.general.encoder=l)},null,8,["density","modelValue"])]),e("div",ge,[pe,he,a(R,{class:"settings__item-form",color:"primary","show-ticks":"always","thumb-label":"","hide-details":"",min:.5,max:60,step:.5,density:r(o)?"compact":"default",modelValue:t.value.general.program_update_interval,"onUpdate:modelValue":s[6]||(s[6]=l=>t.value.general.program_update_interval=l)},null,8,["density","modelValue"])]),e("div",fe,[be,Ve,a(y,{class:"settings__item-switch",color:"primary",id:"debug","hide-details":"",modelValue:t.value.general.debug,"onUpdate:modelValue":s[7]||(s[7]=l=>t.value.general.debug=l)},null,8,["modelValue"])]),e("div",ke,[ye,we,a(y,{class:"settings__item-switch",color:"primary",id:"debug_encoder","hide-details":"",modelValue:t.value.general.debug_encoder,"onUpdate:modelValue":s[8]||(s[8]=l=>t.value.general.debug_encoder=l)},null,8,["modelValue"])]),e("div",Ce,[a(n,{icon:"fluent:server-surface-16-filled",width:"22px"}),Te]),e("div",Se,[xe,Ue,a(m,{class:"settings__item-form",color:"primary",variant:"outlined","hide-details":"",density:r(o)?"compact":"default",modelValue:t.value.server.port,"onUpdate:modelValue":s[9]||(s[9]=l=>t.value.server.port=l)},null,8,["density","modelValue"])]),e("div",Ee,[Pe,Ke,a(m,{class:"settings__item-form",color:"primary",variant:"outlined","hide-details":"",label:"例: C:\\path\\to\\cert.pem",density:r(o)?"compact":"default",modelValue:t.value.server.custom_https_certificate,"onUpdate:modelValue":s[10]||(s[10]=l=>t.value.server.custom_https_certificate=l)},null,8,["density","modelValue"]),a(m,{class:"settings__item-form",color:"primary",variant:"outlined","hide-details":"",label:"例: C:\\path\\to\\key.pem",density:r(o)?"compact":"default",modelValue:t.value.server.custom_https_private_key,"onUpdate:modelValue":s[11]||(s[11]=l=>t.value.server.custom_https_private_key=l)},null,8,["density","modelValue"])]),e("div",Me,[a(n,{icon:"fluent:tv-20-filled",width:"22px"}),Be]),e("div",De,[Ie,He,a(m,{class:"settings__item-form",color:"primary",variant:"outlined","hide-details":"",density:r(o)?"compact":"default",modelValue:t.value.tv.max_alive_time,"onUpdate:modelValue":s[12]||(s[12]=l=>t.value.tv.max_alive_time=l)},null,8,["density","modelValue"])]),e("div",Ae,[a(n,{icon:"fluent:movies-and-tv-20-filled",width:"22px"}),$e]),e("div",Fe,[Ne,Ge,(c(!0),v(U,null,x(t.value.video.recorded_folders,(l,d)=>(c(),v("div",{key:"recorded-folder-"+d},[e("div",Le,[a(m,{class:"settings__item-form mt-0",color:"primary",variant:"outlined","hide-details":"",placeholder:"例: E:\\TV-Record",density:r(o)?"compact":"default",modelValue:t.value.video.recorded_folders[d],"onUpdate:modelValue":f=>t.value.video.recorded_folders[d]=f},null,8,["density","modelValue","onUpdate:modelValue"]),V((c(),v("button",{class:"settings__item-delete-button",onClick:f=>t.value.video.recorded_folders.splice(d,1)},Qe,8,Re)),[[k]])])]))),128)),a(p,{class:"mt-3",color:"background-lighten-2",variant:"flat",height:"40px",onClick:s[13]||(s[13]=l=>t.value.video.recorded_folders.push(""))},{default:u(()=>[a(n,{icon:"fluent:add-12-filled",height:"17px"}),We]),_:1})]),e("div",ze,[a(n,{icon:"fluent:image-multiple-16-filled",width:"22px"}),je]),e("div",qe,[Je,Oe,Xe,(c(!0),v(U,null,x(t.value.capture.upload_folders,(l,d)=>(c(),v("div",{key:"upload-folder-"+d},[e("div",Ye,[a(m,{class:"settings__item-form mt-0",color:"primary",variant:"outlined","hide-details":"",placeholder:"例: E:\\TV-Capture",density:r(o)?"compact":"default",modelValue:t.value.capture.upload_folders[d],"onUpdate:modelValue":f=>t.value.capture.upload_folders[d]=f},null,8,["density","modelValue","onUpdate:modelValue"]),V((c(),v("button",{class:"settings__item-delete-button",onClick:f=>t.value.capture.upload_folders.splice(d,1)},st,8,et)),[[k]])])]))),128)),a(p,{class:"mt-3",color:"background-lighten-2",variant:"flat",height:"40px",onClick:s[14]||(s[14]=l=>t.value.capture.upload_folders.push(""))},{default:u(()=>[a(n,{icon:"fluent:add-12-filled",height:"17px"}),it]),_:1})]),a(p,{class:"settings__save-button bg-secondary mt-6",variant:"flat",onClick:s[15]||(s[15]=l=>K())},{default:u(()=>[a(n,{icon:"fluent:save-16-filled",class:"mr-2",height:"23px"}),i("サーバー設定を更新 ")]),_:1}),e("div",at,[a(n,{icon:"fluent:wrench-settings-20-filled",width:"22px"}),lt]),ot,a(p,{class:"settings__save-button mt-5",color:"background-lighten-2",variant:"flat",onClick:s[16]||(s[16]=l=>M())},{default:u(()=>[a(n,{icon:"iconoir:database-backup",height:"20px"}),nt]),_:1}),rt,a(p,{class:"settings__save-button bg-error mt-5",variant:"flat",onClick:s[17]||(s[17]=l=>B())},{default:u(()=>[a(n,{icon:"fluent:arrow-counterclockwise-20-filled",height:"20px"}),dt]),_:1}),_t,a(p,{class:"settings__save-button bg-error mt-5",variant:"flat",onClick:s[18]||(s[18]=l=>D())},{default:u(()=>[a(n,{icon:"fluent:power-20-filled",height:"20px"}),ct]),_:1})],2)]),_:1})}}});export{yt as default};
