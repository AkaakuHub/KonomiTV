import{d as V,U as g,m as b,M as d,K as S,u as y,_ as T,r as F,o as r,h as E,w as n,e as t,j as k,b as i,c as _,i as a,l as C,g as U,t as p,V as B,F as $,k as P,n as I,J as W,R as L,p as N,q as j}from"./index-69Yl2CMm.js";import{T as A}from"./Twitter-vBID5Nra.js";import{S as z}from"./Base-7iMwva3i.js";import{a as K,V as R,b as M,c as q}from"./VCard-HCjuEueN.js";import{V as H}from"./VForm-tBoKLZmx.js";import{c as f}from"./VTextField-tWdlYAln.js";import{V as J}from"./ssrBoot-QRiFL0aK.js";import{V as O}from"./VDialog-kV6CR-50.js";import{V as h,b as G}from"./VSwitch-PmTdgim-.js";import{c as w}from"./VSelect-pycOV31j.js";import"./Navigation-57ftjXSo.js";import"./VAvatar-4bqbITiX.js";const Q=V({name:"Settings-Twitter",components:{SettingsBase:z},data(){return{is_form_dense:g.isSmartphoneHorizontal(),twitter_active_tab:[{title:"ツイート検索タブ",value:"Search"},{title:"タイムラインタブ",value:"Timeline"},{title:"キャプチャタブ",value:"Capture"}],tweet_hashtag_position:[{title:"ツイート本文の前に追加する",value:"Prepend"},{title:"ツイート本文の後に追加する",value:"Append"},{title:"ツイート本文の前に追加してから改行する",value:"PrependWithLineBreak"},{title:"ツイート本文の後に改行してから追加する",value:"AppendWithLineBreak"}],tweet_capture_watermark_position:[{title:"透かしを描画しない",value:"None"},{title:"透かしをキャプチャの左上に描画する",value:"TopLeft"},{title:"透かしをキャプチャの右上に描画する",value:"TopRight"},{title:"透かしをキャプチャの左下に描画する",value:"BottomLeft"},{title:"透かしをキャプチャの右下に描画する",value:"BottomRight"}],is_loading:!0,is_twitter_password_auth_sending:!1,twitter_password_auth_dialog:!1,twitter_screen_name:"",twitter_password:"",twitter_password_showing:!1}},computed:{...b(y,S)},async created(){await this.userStore.fetchUser(),this.is_loading=!1},methods:{async loginTwitterAccountWithPasswordForm(){if(this.userStore.is_logged_in===!1){d.warning("連携をはじめるには、KonomiTV アカウントにログインしてください。"),await g.sleep(.01),this.twitter_password_auth_dialog=!1;return}this.twitter_password_auth_dialog=!0},async loginTwitterAccountWithPassword(){if((await this.$refs.twitter_form.validate()).valid===!1)return;this.is_twitter_password_auth_sending=!0;const u=await A.authWithPassword({screen_name:this.twitter_screen_name,password:this.twitter_password});if(this.is_twitter_password_auth_sending=!1,u===!1)return;if(await this.userStore.fetchUser(!0),this.userStore.user===null){d.error("アカウント情報を取得できませんでした。");return}const s=[...this.userStore.user.twitter_accounts].sort((m,c)=>m.updated_at<c.updated_at?1:m.updated_at>c.updated_at?-1:0)[0];d.success(`Twitter @${s.screen_name} と連携しました。`),this.$refs.twitter_form.reset(),this.twitter_password_auth_dialog=!1},async logoutTwitterAccount(u){await A.logoutAccount(u)!==!1&&(await this.userStore.fetchUser(!0),d.success(`Twitter @${u} との連携を解除しました。`))}}}),o=u=>(N("data-v-8b243d50"),u=u(),j(),u),X={class:"settings__heading"},Y=o(()=>t("span",{class:"ml-3"},"Twitter",-1)),Z={class:"twitter-accounts"},x={key:0,class:"twitter-accounts__heading"},uu={key:1,class:"twitter-accounts__guide"},tu=o(()=>t("div",{class:"ml-4"},[t("div",{class:"font-weight-bold text-h6"},"Twitter アカウントと連携していません"),t("div",{class:"text-text-darken-1 text-subtitle-2 mt-1"}," Twitter アカウントと連携すると、テレビを見ながら Twitter にツイートしたり、ほかの実況ツイートをリアルタイムで表示できるようになります。 ")],-1)),eu=["src"],su={class:"twitter-account__info"},iu={class:"twitter-account__info-name"},au={class:"twitter-account__info-name-text"},ou={class:"twitter-account__info-screen-name"},nu={key:0},ru=o(()=>t("p",{class:"mb-1"},"2023/07 以降、Twitter のサードパーティー API の事実上の廃止により、従来のアプリ連携では Twitter にアクセスできなくなりました。",-1)),lu=o(()=>t("p",{class:"mb-1"},[a("そこで KonomiTV では、代わりに "),t("a",{class:"link",href:"https://github.com/tsukumijima/tweepy-authlib",target:"_blank"},"ユーザー名とパスワードでログイン"),a(" することで、これまで通り Twitter 連携ができるようにしています (2要素認証を設定しているアカウントには対応していません) 。")],-1)),_u=o(()=>t("p",{class:"mb-1"},"ここで入力したパスワードは一切保存されず、取得した Cookie セッションはローカルの KonomiTV サーバーにのみ保存されます。Cookie セッションが Twitter API 以外の外部サービスに送信されることはありません。",-1)),du=o(()=>t("p",{class:"mb-1"},"万全は期していますが、非公式な方法のため、使い方次第ではアカウントにペナルティが適用される可能性もあります。自己の責任のもとでご利用ください。",-1)),Bu={class:"settings__item settings__item--switch"},mu=o(()=>t("label",{class:"settings__item-heading",for:"fold_panel_after_sending_tweet"},"ツイート送信後にパネルを折りたたむ",-1)),cu=o(()=>t("label",{class:"settings__item-label",for:"fold_panel_after_sending_tweet"},[a(" この設定をオンにすると、ツイートを送信した後に、パネルが自動で折りたたまれます。"),t("br"),a(" ツイートするとき以外はできるだけ映像を大きくして見たい方におすすめです。"),t("br")],-1)),Fu={class:"settings__item settings__item--switch"},Cu=o(()=>t("label",{class:"settings__item-heading",for:"reset_hashtag_when_program_switches"},"番組が切り替わったときにハッシュタグフォームをリセットする",-1)),hu=o(()=>t("label",{class:"settings__item-label",for:"reset_hashtag_when_program_switches"},[a(" チャンネルを切り替えたときや、視聴中の番組が終了し次の番組の放送が開始されたときに、ハッシュタグフォームをリセットするかを設定します。"),t("br"),a(" この設定をオンにしておけば、「誤って前番組のハッシュタグをつけたまま次番組の実況ツイートをしてしまう」といったミスを回避できます。"),t("br")],-1)),wu={class:"settings__item settings__item--switch"},gu=o(()=>t("label",{class:"settings__item-heading",for:"auto_add_watching_channel_hashtag"},"視聴中のチャンネルに対応する局タグを自動で追加する",-1)),Eu=o(()=>t("label",{class:"settings__item-label",for:"auto_add_watching_channel_hashtag"},[a(" この設定をオンにすると、視聴中のチャンネルに対応する局タグ (#nhk, #tokyomx など) がハッシュタグフォームに自動で追加されます。"),t("br"),a(" なお、ビデオをみるときは視聴中のチャンネルに対応する局タグは追加されません。"),t("br")],-1)),pu={class:"settings__item"},Au=o(()=>t("div",{class:"settings__item-heading"},"デフォルトで表示される Twitter タブ内のタブ",-1)),fu=o(()=>t("div",{class:"settings__item-label"},[a(" 視聴画面を開いたときに、パネルの Twitter タブの中で最初に表示されるタブを設定します。"),t("br")],-1)),Du={class:"settings__item"},vu=o(()=>t("div",{class:"settings__item-heading"},"ツイートにつけるハッシュタグの位置",-1)),Vu=o(()=>t("div",{class:"settings__item-label"},[a(" ツイート本文から見て、ハッシュタグをどの位置につけてツイートするかを設定します。"),t("br")],-1)),bu={class:"settings__item"},Su=o(()=>t("div",{class:"settings__item-heading"},"ツイートするキャプチャに番組タイトルの透かしを描画する",-1)),yu=o(()=>t("div",{class:"settings__item-label"},[a(" ツイートするキャプチャに、透かしとして視聴中の番組タイトルを描画するかを設定します。"),t("br"),a(" 透かしの描画位置は 左上・右上・左下・右下 から選択できます。"),t("br")],-1));function Tu(u,s,m,c,ku,Uu){const l=F("Icon"),D=F("router-link"),v=F("SettingsBase");return r(),E(v,null,{default:n(()=>[t("h2",X,[k((r(),E(D,{class:"settings__back-button",to:"/settings/"},{default:n(()=>[i(l,{icon:"fluent:arrow-left-12-filled",width:"25px"})]),_:1})),[[L]]),i(l,{icon:"fa-brands:twitter",width:"22px"}),Y]),t("div",{class:I(["settings__content",{"settings__content--loading":u.is_loading}])},[t("div",Z,[u.userStore.user!==null&&u.userStore.user.twitter_accounts.length>0?(r(),_("div",x,[i(l,{icon:"fluent:person-board-20-filled",class:"mr-2",height:"30"}),a("連携中のアカウント ")])):C("",!0),u.userStore.user===null||u.userStore.user.twitter_accounts.length===0?(r(),_("div",uu,[i(l,{class:"flex-shrink-0",icon:"fa-brands:twitter",width:"45px"}),tu])):C("",!0),(r(!0),_($,null,U(u.userStore.user!==null?u.userStore.user.twitter_accounts:[],e=>(r(),_("div",{class:"twitter-account",key:e.id},[t("img",{class:"twitter-account__icon",src:e.icon_url},null,8,eu),t("div",su,[t("div",iu,[t("span",au,p(e.name),1)]),t("span",ou,[a(" @"+p(e.screen_name)+" ",1),e.is_oauth_session===!0?(r(),_("span",nu,"(Legacy Session)")):C("",!0)])]),i(B,{class:"twitter-account__logout ml-auto",width:"124",height:"52",variant:"flat",onClick:$u=>u.logoutTwitterAccount(e.screen_name)},{default:n(()=>[i(l,{icon:"fluent:plug-disconnected-20-filled",class:"mr-2",height:"24"}),a("連携解除 ")]),_:2},1032,["onClick"])]))),128)),i(B,{class:"twitter-account__login",color:"secondary","max-width":"250",height:"50",variant:"flat",onClick:s[0]||(s[0]=e=>u.loginTwitterAccountWithPasswordForm())},{default:n(()=>[i(l,{icon:"fluent:plug-connected-20-filled",class:"mr-2",height:"24"}),a("連携するアカウントを追加 ")]),_:1}),i(O,{"max-width":"600",modelValue:u.twitter_password_auth_dialog,"onUpdate:modelValue":s[7]||(s[7]=e=>u.twitter_password_auth_dialog=e)},{default:n(()=>[i(K,null,{default:n(()=>[i(R,{class:"d-flex justify-center pt-6 font-weight-bold"},{default:n(()=>[a("Twitter にログイン")]),_:1}),i(M,{class:"pt-2 pb-0"},{default:n(()=>[ru,lu,_u,du,i(H,{class:"settings__item",ref:"twitter_form",onSubmit:s[4]||(s[4]=P(()=>{},["prevent"]))},{default:n(()=>[i(f,{class:"settings__item-form mt-6",color:"primary",variant:"outlined",label:"ユーザー名 (@ から始まる ID)",placeholder:"screen_name",ref:"twitter_screen_name",modelValue:u.twitter_screen_name,"onUpdate:modelValue":s[1]||(s[1]=e=>u.twitter_screen_name=e),density:u.is_form_dense?"compact":"default",rules:[e=>!!e||"ユーザー名を入力してください。"]},null,8,["modelValue","density","rules"]),i(f,{class:"settings__item-form mt-2",color:"primary",variant:"outlined",label:"パスワード",modelValue:u.twitter_password,"onUpdate:modelValue":s[2]||(s[2]=e=>u.twitter_password=e),density:u.is_form_dense?"compact":"default",type:u.twitter_password_showing?"text":"password","append-inner-icon":u.twitter_password_showing?"mdi-eye":"mdi-eye-off",rules:[e=>!!e||"パスワードを入力してください。"],"onClick:append":s[3]||(s[3]=e=>u.twitter_password_showing=!u.twitter_password_showing)},null,8,["modelValue","density","type","append-inner-icon","rules"])]),_:1},512)]),_:1}),i(q,{class:"pt-0 px-6 pb-6"},{default:n(()=>[i(J),i(B,{color:"text",variant:"text",height:"40",onClick:s[5]||(s[5]=e=>u.twitter_password_auth_dialog=!1)},{default:n(()=>[a("キャンセル")]),_:1}),i(B,{color:"secondary",variant:"flat",height:"40",class:"px-4",onClick:s[6]||(s[6]=e=>u.loginTwitterAccountWithPassword())},{default:n(()=>[a("ログイン")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),t("div",Bu,[mu,cu,i(h,{class:"settings__item-switch",color:"primary",id:"fold_panel_after_sending_tweet","hide-details":"",modelValue:u.settingsStore.settings.fold_panel_after_sending_tweet,"onUpdate:modelValue":s[8]||(s[8]=e=>u.settingsStore.settings.fold_panel_after_sending_tweet=e)},null,8,["modelValue"])]),t("div",Fu,[Cu,hu,i(h,{class:"settings__item-switch",color:"primary",id:"reset_hashtag_when_program_switches","hide-details":"",modelValue:u.settingsStore.settings.reset_hashtag_when_program_switches,"onUpdate:modelValue":s[9]||(s[9]=e=>u.settingsStore.settings.reset_hashtag_when_program_switches=e)},null,8,["modelValue"])]),t("div",wu,[gu,Eu,i(h,{class:"settings__item-switch",color:"primary",id:"auto_add_watching_channel_hashtag","hide-details":"",modelValue:u.settingsStore.settings.auto_add_watching_channel_hashtag,"onUpdate:modelValue":s[10]||(s[10]=e=>u.settingsStore.settings.auto_add_watching_channel_hashtag=e)},null,8,["modelValue"])]),t("div",pu,[Au,fu,i(w,{class:"settings__item-form",color:"primary",variant:"outlined","hide-details":"",density:u.is_form_dense?"compact":"default",items:u.twitter_active_tab,modelValue:u.settingsStore.settings.twitter_active_tab,"onUpdate:modelValue":s[11]||(s[11]=e=>u.settingsStore.settings.twitter_active_tab=e)},null,8,["density","items","modelValue"])]),t("div",Du,[vu,Vu,i(w,{class:"settings__item-form",color:"primary",variant:"outlined","hide-details":"",density:u.is_form_dense?"compact":"default",items:u.tweet_hashtag_position,modelValue:u.settingsStore.settings.tweet_hashtag_position,"onUpdate:modelValue":s[12]||(s[12]=e=>u.settingsStore.settings.tweet_hashtag_position=e)},null,8,["density","items","modelValue"])]),t("div",bu,[Su,yu,i(w,{class:"settings__item-form",color:"primary",variant:"outlined","hide-details":"",density:u.is_form_dense?"compact":"default",items:u.tweet_capture_watermark_position,modelValue:u.settingsStore.settings.tweet_capture_watermark_position,"onUpdate:modelValue":s[13]||(s[13]=e=>u.settingsStore.settings.tweet_capture_watermark_position=e)},null,8,["density","items","modelValue"])])],2),i(G,{class:"align-center justify-center",persistent:!0,"model-value":u.is_twitter_password_auth_sending,"z-index":"300"},{default:n(()=>[i(W,{color:"secondary",indeterminate:"",size:"64"})]),_:1},8,["model-value"])]),_:1})}const Ju=T(Q,[["render",Tu],["__scopeId","data-v-8b243d50"]]);export{Ju as default};
