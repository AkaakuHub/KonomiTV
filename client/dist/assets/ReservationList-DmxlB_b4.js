import{C as re,D as se,S as te,Q as ae,E as M,N as ie,X as ne,T as oe,a as n,O as Z,a7 as y,d as z,cL as le,q as C,s as U,w as H,c as g,n as I,b as e,t as m,A as P,P as A,h as D,l as E,r as j,U as T,e as $,M as x,o as u,R as O,_ as q,F as N,g as Q,bQ as J,x as de,i as ce,k as F,V as G}from"./index-CjuqmTYK.js";import{V as ee}from"./VSwitch-DSctGW4a.js";import{c as ue}from"./VChip-U7hEpf5X.js";import{u as ve}from"./Navigation-DRu8CUck.js";import{V as ge}from"./VSlider-CP471AdF.js";import{u as _e,m as pe,V as W,c as L}from"./VTextField-BsuD9qF0.js";import{m as me,e as Y,d as K}from"./VSelect-CWnbbzqK.js";import{V as fe}from"./VDialog-9YvBc2Ri.js";import{a as he,V as be,b as ye,c as we}from"./VCard-BLmwjObN.js";import{V as Ve}from"./ssrBoot-DTvgNvsM.js";import{V as ke}from"./VPagination-CNOreGiL.js";const $e=se({...pe(),...ne(me(),["inline"])},"VCheckbox"),Ce=re()({name:"VCheckbox",inheritAttrs:!1,props:$e(),emits:{"update:modelValue":l=>!0,"update:focused":l=>!0},setup(l,_){let{attrs:i,slots:w}=_;const o=te(l,"modelValue"),{isFocused:s,focus:p,blur:f}=_e(l),b=ae(),R=M(()=>l.id||`checkbox-${b}`);return ie(()=>{const[S,B]=oe(i),d=W.filterProps(l),a=Y.filterProps(l);return n(W,Z({class:["v-checkbox",l.class]},S,d,{modelValue:o.value,"onUpdate:modelValue":c=>o.value=c,id:R.value,focused:s.value,style:l.style}),{...w,default:c=>{let{id:h,messagesId:V,isDisabled:t,isReadonly:r,isValid:k}=c;return n(Y,Z(a,{id:h.value,"aria-describedby":V.value,disabled:t.value,readonly:r.value},B,{error:k.value===!1,modelValue:o.value,"onUpdate:modelValue":v=>o.value=v,onFocus:p,onBlur:f}),w)}})}),{}}});class X{static async fetchReservations(){const _=await y.get("/recording/reservations");return _.type==="error"?(y.showGenericError(_,"録画予約一覧を取得できませんでした。"),null):_.data}static async fetchReservation(_){const i=await y.get(`/recording/reservations/${_}`);return i.type==="error"?(y.showGenericError(i,"録画予約情報を取得できませんでした。"),null):i.data}static async addReservation(_,i){const w={program_id:_,record_settings:i},o=await y.post("/recording/reservations",w);if(o.type==="error"){switch(o.data.detail){case"This API is only available when the backend is EDCB":y.showGenericError(o,"この機能は EDCB バックエンド利用時のみ使用できます。");break;case"Specified program was not found":y.showGenericError(o,"指定された番組が見つかりませんでした。");break;case"Specified channel was not found":y.showGenericError(o,"指定されたチャンネルが見つかりませんでした。");break;case"The same program_id is already reserved":y.showGenericError(o,"この番組は既に録画予約されています。");break;case"Failed to add a recording reservation":y.showGenericError(o,"録画予約の追加に失敗しました。");break;default:y.showGenericError(o,"録画予約の追加に失敗しました。");break}return!1}return!0}static async updateReservation(_,i){const w={record_settings:i},o=await y.put(`/recording/reservations/${_}`,w);if(o.type==="error"){switch(o.data.detail){case"This API is only available when the backend is EDCB":y.showGenericError(o,"この機能は EDCB バックエンド利用時のみ使用できます。");break;case"Specified reservation_id was not found":y.showGenericError(o,"指定された録画予約が見つかりませんでした。");break;case"Failed to update the specified recording reservation":y.showGenericError(o,"録画予約の更新に失敗しました。");break;default:y.showGenericError(o,"録画予約の更新に失敗しました。");break}return null}return o.data}static async deleteReservation(_){const i=await y.delete(`/recording/reservations/${_}`);if(i.type==="error"){switch(i.data.detail){case"This API is only available when the backend is EDCB":y.showGenericError(i,"この機能は EDCB バックエンド利用時のみ使用できます。");break;case"Specified reservation_id was not found":y.showGenericError(i,"指定された録画予約が見つかりませんでした。");break;case"Failed to delete the specified recording reservation":y.showGenericError(i,"録画予約の削除に失敗しました。");break;default:y.showGenericError(i,`録画予約 (ID: ${_}) の削除に失敗しました。`);break}return!1}return!0}}const Ee={class:"reservation__container"},Re={class:"reservation__controls"},Se={class:"reservation__priority"},De={class:"reservation__priority-badge"},Be={key:0,class:"reservation__toggle"},Pe={class:"reservation__toggle-label"},Ue={key:1,class:"reservation__recording"},Ie={class:"reservation__content"},Me={class:"reservation__content-header"},Te=["innerHTML"],Le={class:"reservation__content-status"},xe={class:"reservation__content-meta"},Fe={class:"reservation__content-meta-broadcaster"},Ge=["src"],He={class:"reservation__content-meta-broadcaster-name"},Ae={class:"reservation__content-meta-time"},Oe={class:"reservation__content-meta-size-comment"},Ne={key:0,class:"reservation__content-meta-comment"},ze={class:"reservation__content-meta-size"},je=["innerHTML"],qe=z({__name:"Reservation",props:{reservation:{}},emits:["deleted","click"],setup(l,{emit:_}){const i=l,w=_;le();const o=C(i.reservation.record_settings.is_enabled),s=C(!1);U(()=>i.reservation.record_settings.is_enabled,d=>{o.value=d});const p=d=>{const a=d.target;a.src=`${T.api_base_url}/channels/gr001/logo`},f=d=>{if(d.is_recording_in_progress)return"録画中";switch(d.recording_availability){case"Full":return"録画可能";case"Partial":return"一部のみ録画可能";case"Unavailable":return"チューナー不足";default:return"不明"}},b=d=>{if(d.is_recording_in_progress)return"fluent:record-16-filled";switch(d.recording_availability){case"Full":return"fluent:checkmark-circle-16-regular";case"Partial":return"fluent:warning-16-filled";case"Unavailable":return"fluent:dismiss-circle-16-regular";default:return"fluent:question-circle-16-regular"}},R=d=>{if(d.is_recording_in_progress)return"primary";switch(d.recording_availability){case"Full":return"success";case"Partial":return"warning";case"Unavailable":return"error";default:return"grey"}},S=()=>{w("click",i.reservation)},B=async()=>{if(!s.value){s.value=!0;try{const d={...i.reservation.record_settings,is_enabled:o.value};if(await X.updateReservation(i.reservation.id,d)){const c=o.value?`録画予約を有効にしました。
番組開始時刻になると自動的に録画が開始されます。`:`録画予約を無効にしました。
番組開始時刻までに再度予約を有効にしない限り、この番組は録画されません。`;x.success(c)}else o.value=i.reservation.record_settings.is_enabled}catch(d){console.error("Failed to update reservation:",d),o.value=i.reservation.record_settings.is_enabled}finally{s.value=!1}}};return(d,a)=>{const c=j("Icon");return H((u(),g("div",{class:I(["reservation",{"reservation--disabled":!o.value}]),onClick:S},[e("div",Ee,[e("div",Re,[e("div",Se,[e("div",De,m(d.reservation.record_settings.priority),1),a[1]||(a[1]=e("div",{class:"reservation__priority-label"},"優先度",-1))]),d.reservation.is_recording_in_progress?(u(),g("div",Ue,a[2]||(a[2]=[e("div",{class:"reservation__recording-icon"},null,-1)]))):(u(),g("div",Be,[n(ee,{modelValue:o.value,"onUpdate:modelValue":[a[0]||(a[0]=h=>o.value=h),B],color:"primary",density:"compact","hide-details":""},null,8,["modelValue"]),e("div",Pe,m(o.value?"有効":"無効"),1)]))]),e("div",Ie,[e("div",Me,[e("div",{class:"reservation__content-title",innerHTML:P(A).decorateProgramInfo(d.reservation.program,"title")},null,8,Te),e("div",Le,[n(ue,{color:R(d.reservation),size:"small",variant:"tonal"},{default:D(()=>[n(c,{icon:b(d.reservation),width:"12px",height:"12px",class:"mr-1"},null,8,["icon"]),E(" "+m(f(d.reservation)),1)]),_:1},8,["color"])])]),e("div",xe,[e("div",Fe,[e("img",{class:"reservation__content-meta-broadcaster-icon",loading:"lazy",decoding:"async",src:`${P(T).api_base_url}/channels/${d.reservation.channel.id}/logo`,onError:p},null,40,Ge),e("span",He,"Ch: "+m(d.reservation.channel.channel_number)+" "+m(d.reservation.channel.name),1)]),e("div",Ae,m(P(A).getProgramTime(d.reservation.program)),1),e("div",Oe,[d.reservation.comment?(u(),g("div",Ne,[n(c,{icon:"fluent:note-20-filled",width:"14px",height:"14px",class:"mr-1"}),E(" "+m(d.reservation.comment),1)])):$("",!0),e("div",ze,[n(c,{icon:"fluent:hard-drive-20-filled",width:"14px",height:"14px",class:"mr-1"}),E(" 推定 "+m(P(T).formatBytes(d.reservation.estimated_recording_file_size,!0)),1)])])]),e("div",{class:"reservation__content-description",innerHTML:P(A).decorateProgramInfo(d.reservation.program,"description")},null,8,je)])])],2)),[[O]])}}}),Je=q(qe,[["__scopeId","data-v-aa9bb486"]]),Ke=z({name:"ReservationProgramInfo",props:{reservation:{type:Object,required:!0}},data(){return{Utils:Object.freeze(T),ProgramUtils:Object.freeze(A)}},methods:{onLogoError(l){const _=l.target;_.src=`${T.api_base_url}/channels/gr001/logo`}}}),Qe={class:"program-container"},Xe={class:"program-info"},Ze=["innerHTML"],We={class:"program-info__broadcaster"},Ye=["src"],er={class:"program-info__broadcaster-container"},rr={class:"d-flex align-center"},sr={class:"program-info__broadcaster-number"},tr={class:"program-info__broadcaster-name"},ar={class:"program-info__broadcaster-time"},ir=["innerHTML"],nr={class:"program-info__genre-container"},or={class:"mt-5"},lr={class:"program-info__status"},dr={class:"ml-2"},cr={class:"program-info__status"},ur={class:"ml-2"},vr={key:0,class:"program-info__status"},gr={class:"ml-2"},_r={class:"program-detail-container"},pr={class:"program-detail__heading"},mr=["innerHTML"];function fr(l,_,i,w,o,s){const p=j("Icon");return u(),g("div",Qe,[e("section",Xe,[e("h1",{class:"program-info__title",innerHTML:l.ProgramUtils.decorateProgramInfo(l.reservation.program,"title")},null,8,Ze),e("div",We,[e("img",{class:"program-info__broadcaster-icon",src:`${l.Utils.api_base_url}/channels/${l.reservation.channel.id}/logo`,onError:_[0]||(_[0]=(...f)=>l.onLogoError&&l.onLogoError(...f))},null,40,Ye),e("div",er,[e("div",rr,[e("div",sr,"Ch: "+m(l.reservation.channel.channel_number),1),e("div",tr,m(l.reservation.channel.name),1)]),e("div",ar,m(l.ProgramUtils.getProgramTime(l.reservation.program)),1)])]),e("div",{class:"program-info__description",innerHTML:l.ProgramUtils.decorateProgramInfo(l.reservation.program,"description")},null,8,ir),e("div",nr,[(u(!0),g(N,null,Q(l.reservation.program.genres??[],(f,b)=>(u(),g("div",{class:"program-info__genre",key:b},m(f.major)+" / "+m(f.middle),1))),128))]),e("div",or,[e("div",lr,[n(p,{icon:"fluent:video-16-filled",height:"17px",style:{"margin-left":"-2px","margin-right":"-1.7px","margin-bottom":"-3px"}}),e("span",dr,"映像: "+m(l.reservation.program.video_codec)+" / "+m(l.reservation.program.video_resolution),1)]),e("div",cr,[n(p,{icon:"fluent:headphones-sound-wave-20-filled",height:"17px",style:{"margin-left":"-2px","margin-right":"-1.7px","margin-bottom":"-3px"}}),e("span",ur,"主音声: "+m(l.reservation.program.primary_audio_type)+" "+m(l.reservation.program.primary_audio_sampling_rate||"Unknown")+" / "+m(l.reservation.program.primary_audio_language),1)]),l.reservation.program.secondary_audio_type?(u(),g("div",vr,[n(p,{icon:"fluent:headphones-sound-wave-20-filled",height:"17px",style:{"margin-left":"-2px","margin-right":"-1.7px","margin-bottom":"-3px"}}),e("span",gr,"副音声: "+m(l.reservation.program.secondary_audio_type)+" "+m(l.reservation.program.secondary_audio_sampling_rate||"Unknown")+" / "+m(l.reservation.program.secondary_audio_language),1)])):$("",!0)])]),e("section",_r,[(u(!0),g(N,null,Q(l.reservation.program.detail??{},(f,b)=>(u(),g("div",{class:"program-detail",key:b},[e("h2",pr,m(b),1),e("div",{class:"program-detail__text",innerHTML:l.Utils.URLtoLink(f)},null,8,mr)]))),128))])])}const hr=q(Ke,[["render",fr],["__scopeId","data-v-18bc390b"]]),br={class:"reservation-recording-settings"},yr={key:0,class:"recording-warning-banner"},wr={class:"reservation-recording-settings__section"},Vr={class:"reservation-recording-settings__header"},kr={class:"reservation-recording-settings__section"},$r={class:"reservation-recording-settings__slider"},Cr={class:"reservation-recording-settings__section"},Er={class:"reservation-recording-settings__section"},Rr={class:"reservation-recording-settings__section"},Sr={class:"reservation-recording-settings__margin-default"},Dr={class:"reservation-recording-settings__margin-controls"},Br={class:"reservation-recording-settings__section"},Pr={class:"reservation-recording-settings__section"},Ur={class:"reservation-recording-settings__section"},Ir={class:"reservation-recording-settings__section"},Mr={class:"reservation-recording-settings__description"},Tr=z({__name:"ReservationRecordingSettings",props:{reservation:{},hasChanges:{type:Boolean}},emits:["updateSettings","changesDetected"],setup(l,{emit:_}){const i=l,w=_,o=ve(),s=C(structuredClone(J(i.reservation.record_settings))),p=C(structuredClone(J(i.reservation.record_settings))),f=M({get:()=>s.value.recording_folders.length>0?s.value.recording_folders[0].recording_folder_path:"",set:t=>{R(t,b.value)}}),b=M({get:()=>s.value.recording_folders.length>0&&s.value.recording_folders[0].recording_file_name_template||"",set:t=>{R(f.value,t)}}),R=(t,r)=>{const k=t.trim()!=="",v=r.trim()!=="";!k&&!v?s.value.recording_folders=[]:(s.value.recording_folders.length===0&&s.value.recording_folders.push({recording_folder_path:"",recording_file_name_template:null,is_oneseg_separate_recording_folder:!1}),s.value.recording_folders[0].recording_folder_path=t,s.value.recording_folders[0].recording_file_name_template=r||null)},S=C(s.value.recording_start_margin===null&&s.value.recording_end_margin===null),B=[{title:"デフォルト設定を使う",value:"Default"},{title:"録画する",value:"Enable"},{title:"録画しない",value:"Disable"}],d=[{title:"デフォルト設定を使う",value:"Default"},{title:"録画する",value:"Enable"},{title:"録画しない",value:"Disable"}],a=[{title:"デフォルト設定を使う",value:"Default"},{title:"何もしない",value:"Nothing"},{title:"スタンバイ",value:"Standby"},{title:"スタンバイ(復帰後再起動)",value:"StandbyAndReboot"},{title:"サスペンド",value:"Suspend"},{title:"サスペンド(復帰後再起動)",value:"SuspendAndReboot"},{title:"シャットダウン",value:"Shutdown"}],c=M(()=>JSON.stringify(s.value)!==JSON.stringify(p.value));U(c,t=>{w("changesDetected",t)});const h=()=>{w("updateSettings",s.value)},V=()=>{S.value?(s.value.recording_start_margin=null,s.value.recording_end_margin=null):(s.value.recording_start_margin=10,s.value.recording_end_margin=5),h()};return U(()=>i.reservation,t=>{s.value=structuredClone(J(t.record_settings)),p.value=structuredClone(J(t.record_settings))},{deep:!0}),de(async()=>{await o.fetchServerVersion()}),(t,r)=>{const k=j("Icon");return u(),g("div",br,[t.reservation.is_recording_in_progress?(u(),g("div",yr,[n(k,{icon:"fluent:warning-16-filled",class:"recording-warning-banner__icon"}),r[11]||(r[11]=e("span",{class:"recording-warning-banner__text"}," 録画中の録画設定の変更はできません。 ",-1))])):$("",!0),e("div",wr,[e("div",Vr,[r[12]||(r[12]=e("div",{class:"reservation-recording-settings__label"},"録画予約の有効/無効",-1)),n(ee,{disabled:t.reservation.is_recording_in_progress,style:{height:"0","margin-top":"-40px","margin-right":"6px"},modelValue:s.value.is_enabled,"onUpdate:modelValue":[r[0]||(r[0]=v=>s.value.is_enabled=v),h],color:"primary",density:"compact","hide-details":""},null,8,["disabled","modelValue"])]),r[13]||(r[13]=e("div",{class:"reservation-recording-settings__description mb-0"},[E(" 予約が無効なときは、この番組の録画動作を行いません。"),e("br"),E(" キーワード自動予約条件により不必要な番組が予約されてしまっているときは、予約を無効にしてみてください。(予約削除ではすぐ再追加されてしまい意味がありません。) ")],-1))]),e("div",kr,[r[14]||(r[14]=e("div",{class:"reservation-recording-settings__label"},"録画予約の優先度",-1)),r[15]||(r[15]=e("div",{class:"reservation-recording-settings__description mb-0"}," 放送時間が重なりチューナーが足りないときは、より優先度が高い予約から優先的に録画します。 ",-1)),e("div",$r,[n(ge,{disabled:t.reservation.is_recording_in_progress,modelValue:s.value.priority,"onUpdate:modelValue":[r[1]||(r[1]=v=>s.value.priority=v),h],min:1,max:5,step:1,color:"primary",density:"compact","show-ticks":"always","thumb-label":"","hide-details":""},null,8,["disabled","modelValue"])])]),e("div",Cr,[r[16]||(r[16]=e("div",{class:"reservation-recording-settings__label"},"録画フォルダのパス",-1)),r[17]||(r[17]=e("div",{class:"reservation-recording-settings__description"}," 空欄にすると、デフォルトの録画フォルダに保存されます。 ",-1)),n(L,{disabled:t.reservation.is_recording_in_progress,modelValue:f.value,"onUpdate:modelValue":[r[2]||(r[2]=v=>f.value=v),h],color:"primary",variant:"outlined",density:"compact","hide-details":"",placeholder:P(o).is_linux_environment?"/mnt/hdd/Records/2025年春アニメ":"E:\\Records\\2025年春アニメ"},null,8,["disabled","modelValue","placeholder"])]),e("div",Er,[r[18]||(r[18]=ce('<div class="reservation-recording-settings__label" data-v-29a2441b>録画ファイル名テンプレート (マクロ)</div><div class="reservation-recording-settings__description" data-v-29a2441b> 空欄にすると、デフォルトの録画ファイル名テンプレート (マクロ) が録画ファイル名の変更に利用されます。<br data-v-29a2441b><div class="mt-1" data-v-29a2441b><a class="link" href="https://github.com/xtne6f/EDCB/blob/work-plus-s/Document/Readme_EpgTimer.txt#L929-L1008" target="_blank" data-v-29a2441b>利用可能なテンプレート構文の一覧</a> / <a class="link" href="https://github.com/xtne6f/EDCB/blob/work-plus-s/Document/Readme_Mod.txt#%E3%83%9E%E3%82%AF%E3%83%AD" target="_blank" data-v-29a2441b>xtne6f 版での追加差分</a></div></div>',2)),n(L,{disabled:t.reservation.is_recording_in_progress,modelValue:b.value,"onUpdate:modelValue":[r[3]||(r[3]=v=>b.value=v),h],color:"primary",variant:"outlined",density:"compact","hide-details":"",placeholder:"$ZtoH(Title)$.ts"},null,8,["disabled","modelValue"])]),e("div",Rr,[r[20]||(r[20]=e("div",{class:"reservation-recording-settings__label"},"録画マージン (秒)",-1)),r[21]||(r[21]=e("div",{class:"reservation-recording-settings__description"}," 番組開始時刻の何秒前から録画を開始し、番組終了時刻の何秒後に録画を終了するかの設定です。最低でも5秒以上をおすすめします。(0秒だと番組の冒頭/末尾が欠けてしまいます。) ",-1)),e("div",Sr,[n(Ce,{disabled:t.reservation.is_recording_in_progress,id:"use-default-margin",modelValue:S.value,"onUpdate:modelValue":[r[4]||(r[4]=v=>S.value=v),V],color:"primary",density:"compact","hide-details":""},null,8,["disabled","modelValue"]),r[19]||(r[19]=e("label",{class:"reservation-recording-settings__margin-default-text",for:"use-default-margin",style:{"user-select":"none"}}," デフォルト設定を使う ",-1))]),e("div",Dr,[n(L,{disabled:t.reservation.is_recording_in_progress||S.value,modelValue:s.value.recording_start_margin,"onUpdate:modelValue":[r[5]||(r[5]=v=>s.value.recording_start_margin=v),h],modelModifiers:{number:!0},color:"primary",variant:"outlined",density:"compact",type:"number","hide-details":"",prefix:"番組開始",suffix:"秒前",style:{width:"160px"}},null,8,["disabled","modelValue"]),n(L,{disabled:t.reservation.is_recording_in_progress||S.value,modelValue:s.value.recording_end_margin,"onUpdate:modelValue":[r[6]||(r[6]=v=>s.value.recording_end_margin=v),h],modelModifiers:{number:!0},color:"primary",variant:"outlined",density:"compact",type:"number","hide-details":"",prefix:"番組終了",suffix:"秒後",style:{width:"166px"}},null,8,["disabled","modelValue"])])]),e("div",Br,[r[22]||(r[22]=e("div",{class:"reservation-recording-settings__label"},"字幕データ録画設定",-1)),r[23]||(r[23]=e("div",{class:"reservation-recording-settings__description"},[E(" 字幕データはほとんど録画容量を消費しません。"),e("br"),E(" [録画する] に設定しておくことを強くおすすめします。 ")],-1)),n(K,{disabled:t.reservation.is_recording_in_progress,modelValue:s.value.caption_recording_mode,"onUpdate:modelValue":[r[7]||(r[7]=v=>s.value.caption_recording_mode=v),h],items:B,color:"primary",variant:"outlined",density:"compact","hide-details":""},null,8,["disabled","modelValue"])]),e("div",Pr,[r[24]||(r[24]=e("div",{class:"reservation-recording-settings__label"},"データ放送録画設定",-1)),r[25]||(r[25]=e("div",{class:"reservation-recording-settings__description"},[E(" データ放送は30分で 500MB 以上録画容量を消費する上、KonomiTV は録画再生時のデータ放送表示に非対応です。"),e("br"),E(" [録画しない] に設定しておくことを強くおすすめします。 ")],-1)),n(K,{disabled:t.reservation.is_recording_in_progress,modelValue:s.value.data_broadcasting_recording_mode,"onUpdate:modelValue":[r[8]||(r[8]=v=>s.value.data_broadcasting_recording_mode=v),h],items:d,color:"primary",variant:"outlined",density:"compact","hide-details":""},null,8,["disabled","modelValue"])]),e("div",Ur,[r[26]||(r[26]=e("div",{class:"reservation-recording-settings__label"},"録画後動作設定",-1)),r[27]||(r[27]=e("div",{class:"reservation-recording-settings__description"}," 通常は [何もしない] のままで大丈夫です。録画後に録画 PC をスリープさせておきたい方のみ設定してください。環境によっては復帰できず以降の録画に失敗することがあります。 ",-1)),n(K,{disabled:t.reservation.is_recording_in_progress,modelValue:s.value.post_recording_mode,"onUpdate:modelValue":[r[9]||(r[9]=v=>s.value.post_recording_mode=v),h],items:a,color:"primary",variant:"outlined",density:"compact","hide-details":""},null,8,["disabled","modelValue"])]),e("div",Ir,[r[28]||(r[28]=e("div",{class:"reservation-recording-settings__label"},"録画後実行スクリプトのパス",-1)),e("div",Mr," 通常は空欄のままで大丈夫です。録画後に指定の "+m(P(o).is_linux_environment?".sh / .lua":".bat / .ps1 / .lua")+" スクリプトを実行させたい方のみ設定してください。 ",1),n(L,{disabled:t.reservation.is_recording_in_progress,modelValue:s.value.post_recording_bat_file_path,"onUpdate:modelValue":[r[10]||(r[10]=v=>s.value.post_recording_bat_file_path=v),h],color:"primary",variant:"outlined",density:"compact","hide-details":"",placeholder:P(o).is_linux_environment?"/var/local/edcb/transcode.sh":"C:\\DTV\\EDCB\\Transcode.bat"},null,8,["disabled","modelValue","placeholder"])])])}}}),Lr=q(Tr,[["__scopeId","data-v-29a2441b"]]),xr={class:"reservation-detail-drawer__header"},Fr={class:"reservation-detail-drawer__tabs"},Gr={class:"reservation-detail-drawer__content"},Hr={key:0,class:"reservation-detail-drawer__info"},Ar={key:1,class:"reservation-detail-drawer__settings"},Or={class:"reservation-detail-drawer__footer"},Nr={class:"reservation-detail-drawer__actions"},zr={key:0,class:"mb-4"},jr={class:"text-h6 mb-2"},qr={class:"text-body-2 text-text-darken-1"},Jr={key:1,class:"warning-banner warning-banner--recording"},Kr={key:2,class:"warning-banner warning-banner--normal"},Qr={key:3,class:"warning-banner warning-banner--keyword mt-3"},Xr=z({__name:"ReservationDetailDrawer",props:{reservation:{},modelValue:{type:Boolean}},emits:["update:modelValue","updated","deleted"],setup(l,{emit:_}){const i=l,w=_,o=M({get:()=>i.modelValue,set:t=>w("update:modelValue",t)}),s=C("info"),p=C(!1),f=C(!1),b=C(null),R=C(!1),S=M(()=>{var t;return((t=i.reservation)==null?void 0:t.comment.includes("EPG自動予約"))??!1}),B=M(()=>{var t;return((t=i.reservation)==null?void 0:t.is_recording_in_progress)??!1});U(o,t=>{t&&(s.value="info",p.value=!1)});const d=()=>{p.value&&!confirm("変更が保存されていません。ドロワーを閉じますか？")||(o.value=!1)},a=t=>{b.value=t},c=async()=>{if(!p.value||f.value||!b.value||!i.reservation)return;const t=b.value.caption_recording_mode==="Default",r=b.value.data_broadcasting_recording_mode==="Default";if(t!==r){x.warning("字幕データ録画設定・データ放送録画設定を明示的に設定する際は、両方とも「デフォルト設定を使う」以外に設定してください。");return}f.value=!0;try{if(await X.updateReservation(i.reservation.id,b.value)){x.success("録画設定の変更を保存しました。");const v={...i.reservation,record_settings:b.value};w("updated",v),p.value=!1}}catch(k){console.error("Failed to save settings:",k),x.error("録画設定の保存に失敗しました。")}finally{f.value=!1}},h=()=>{R.value=!0},V=async()=>{if(R.value=!1,!!i.reservation)try{await X.deleteReservation(i.reservation.id)&&(x.success("録画予約を削除しました。"),w("deleted",i.reservation.id),o.value=!1)}catch(t){console.error("Failed to delete reservation:",t)}};return(t,r)=>{const k=j("Icon");return u(),g(N,null,[e("div",{class:I(["reservation-detail-drawer__scrim",{"reservation-detail-drawer__scrim--visible":o.value}]),onClick:d},null,2),e("div",{class:I(["reservation-detail-drawer",{"reservation-detail-drawer--visible":o.value}])},[e("div",xr,[e("div",Fr,[H((u(),g("div",{class:I(["reservation-detail-drawer__tab",{"reservation-detail-drawer__tab--active":s.value==="info"}]),onClick:r[0]||(r[0]=v=>s.value="info")},[n(k,{icon:"fluent:info-12-regular",width:"20px",height:"20px"}),r[5]||(r[5]=e("span",{class:"reservation-detail-drawer__tab-text"},"番組情報",-1))],2)),[[O]]),H((u(),g("div",{class:I(["reservation-detail-drawer__tab",{"reservation-detail-drawer__tab--active":s.value==="settings"}]),onClick:r[1]||(r[1]=v=>s.value="settings")},[n(k,{icon:"material-symbols:settings-video-camera-outline-rounded",width:"20px",height:"20px"}),r[6]||(r[6]=e("span",{class:"reservation-detail-drawer__tab-text"},"録画設定",-1))],2)),[[O]])]),H((u(),g("div",{class:"reservation-detail-drawer__close",onClick:d},[n(k,{icon:"fluent:dismiss-16-filled",width:"22px",height:"22px"})])),[[O]])]),e("div",Gr,[s.value==="info"&&t.reservation?(u(),g("div",Hr,[n(hr,{reservation:t.reservation},null,8,["reservation"])])):$("",!0),s.value==="settings"&&t.reservation?(u(),g("div",Ar,[n(Lr,{reservation:t.reservation,"has-changes":p.value,onUpdateSettings:a,onChangesDetected:r[2]||(r[2]=v=>p.value=v)},null,8,["reservation","has-changes"])])):$("",!0)]),e("div",Or,[e("div",Nr,[n(G,{class:"px-3",variant:"text",onClick:h},{default:D(()=>[n(k,{icon:"fluent:delete-16-regular",width:"20px",height:"20px"}),r[7]||(r[7]=e("span",{class:"ml-1"},"予約を削除",-1))]),_:1}),s.value==="settings"?(u(),F(G,{key:0,class:"px-3",color:"secondary",variant:"flat",disabled:!p.value,loading:f.value,onClick:c},{default:D(()=>[n(k,{icon:"fluent:save-16-regular",width:"20px",height:"20px"}),r[8]||(r[8]=e("span",{class:"ml-1"},"変更を保存",-1))]),_:1},8,["disabled","loading"])):$("",!0)])])],2),n(fe,{modelValue:R.value,"onUpdate:modelValue":r[4]||(r[4]=v=>R.value=v),"max-width":"710"},{default:D(()=>[n(he,null,{default:D(()=>[n(be,{class:"d-flex justify-center pt-6 font-weight-bold"},{default:D(()=>r[9]||(r[9]=[E(" 録画予約を削除しますか？ ")])),_:1}),n(ye,{class:"pt-2 pb-0"},{default:D(()=>[t.reservation?(u(),g("div",zr,[e("div",jr,m(t.reservation.program.title),1),e("div",qr,m(P(A).getProgramTime(t.reservation.program)),1)])):$("",!0),B.value&&t.reservation?(u(),g("div",Jr,[n(k,{icon:"fluent:warning-16-filled",class:"warning-banner__icon"}),r[10]||(r[10]=e("span",{class:"warning-banner__text"},[E(" この番組は現在録画中です。"),e("br"),E(" 予約を削除すると、現在までの録画ファイルは残りますが、残りの期間の録画は中断されます。 ")],-1))])):t.reservation?(u(),g("div",Kr,[n(k,{icon:"fluent:info-16-regular",class:"warning-banner__icon"}),r[11]||(r[11]=e("span",{class:"warning-banner__text"}," 録画予約を削除すると、放送開始前に再度予約を追加しない限り、録画は行われません。 ",-1))])):$("",!0),S.value&&t.reservation?(u(),g("div",Qr,[n(k,{icon:"fluent:warning-16-filled",class:"warning-banner__icon"}),r[12]||(r[12]=e("span",{class:"warning-banner__text"},[E(" この予約はキーワード自動予約で追加されました。削除してもすぐに再追加される可能性があります。"),e("br"),E(" 録画が不要な場合は削除ではなく「無効」にすることをおすすめします。 ")],-1))])):$("",!0)]),_:1}),n(we,{class:"pt-4 px-6 pb-6"},{default:D(()=>[n(Ve),n(G,{color:"text",variant:"text",onClick:r[3]||(r[3]=v=>R.value=!1)},{default:D(()=>[n(k,{icon:"fluent:dismiss-20-regular",width:"18px",height:"18px"}),r[13]||(r[13]=e("span",{class:"ml-1"},"キャンセル",-1))]),_:1}),n(G,{class:"px-3",color:"error",variant:"flat",onClick:V},{default:D(()=>[n(k,{icon:"fluent:delete-20-regular",width:"18px",height:"18px"}),r[14]||(r[14]=e("span",{class:"ml-1"},"予約を削除",-1))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}}),Zr=q(Xr,[["__scopeId","data-v-8d3c4c0e"]]),Wr={key:0,class:"reservation-list__header"},Yr={class:"reservation-list__title"},es={class:"reservation-list__title-text"},rs={key:1,class:"reservation-list__title-count"},ss={class:"reservation-list__actions"},ts={class:"reservation-list__empty-content"},as=["innerHTML"],is=["innerHTML"],ns={class:"reservation-list__grid-content"},os={key:1,class:"reservation-list__pagination"},ls=z({__name:"ReservationList",props:{title:{},reservations:{},total:{},page:{default:1},sortOrder:{default:"desc"},hideHeader:{type:Boolean,default:!1},hideSort:{type:Boolean,default:!1},hidePagination:{type:Boolean,default:!1},showMoreButton:{type:Boolean,default:!1},showBackButton:{type:Boolean,default:!1},showEmptyMessage:{type:Boolean,default:!0},emptyIcon:{default:"fluent:warning-20-regular"},emptyMessage:{default:"録画予約が見つかりませんでした。"},emptySubMessage:{default:"番組表から録画予約を追加できます。"},isLoading:{type:Boolean,default:!1}},emits:["update:page","update:sortOrder","more","delete"],setup(l,{emit:_}){const i=l,w=C(i.page),o=C(i.sortOrder),s=C([...i.reservations]),p=C(i.total),f=C(!1),b=C(null);U(()=>i.page,a=>{w.value=a}),U(()=>i.sortOrder,a=>{o.value=a}),U(()=>i.reservations,a=>{s.value=[...a]}),U(()=>i.total,a=>{p.value=a});const R=_,S=a=>{b.value=a,f.value=!0},B=a=>{s.value=s.value.filter(c=>c.id!==a),p.value=Math.max(0,p.value-1),f.value=!1,R("delete",a)},d=a=>{const c=s.value.findIndex(h=>h.id===a.id);c!==-1&&(s.value[c]=a),b.value=a};return(a,c)=>{const h=j("Icon");return u(),g("div",{class:I(["reservation-list",{"reservation-list--show-sort":!a.hideSort}])},[a.hideHeader?$("",!0):(u(),g("div",Wr,[e("h2",Yr,[a.showBackButton?H((u(),g("div",{key:0,class:"reservation-list__title-back",onClick:c[0]||(c[0]=V=>a.$router.back())},[n(h,{icon:"fluent:chevron-left-12-filled",width:"27px"})])),[[O]]):$("",!0),e("span",es,m(a.title),1),a.showMoreButton?$("",!0):(u(),g("div",rs,[a.isLoading?(u(),F(h,{key:0,icon:"line-md:loading-twotone-loop",class:"mr-1 spin",width:"20px",height:"20px"})):(u(),g(N,{key:1},[E(m(p.value)+"件",1)],64))]))]),e("div",ss,[a.hideSort?$("",!0):(u(),F(K,{key:0,modelValue:o.value,"onUpdate:modelValue":[c[1]||(c[1]=V=>o.value=V),c[2]||(c[2]=V=>a.$emit("update:sortOrder",V))],items:[{title:"放送が近い順",value:"asc"},{title:"放送が遠い順",value:"desc"}],"item-title":"title","item-value":"value",class:"reservation-list__sort",color:"primary","bg-color":"background-lighten-1",variant:"solo",density:"comfortable","hide-details":""},null,8,["modelValue"])),a.showMoreButton?(u(),F(G,{key:1,variant:"text",class:"reservation-list__more",onClick:c[3]||(c[3]=V=>a.$emit("more"))},{default:D(()=>[c[7]||(c[7]=e("span",{class:"text-primary"},"もっと見る",-1)),n(h,{icon:"fluent:chevron-right-12-regular",width:"18px",class:"ml-1 text-text-darken-1",style:{margin:"0px -4px"}})]),_:1})):$("",!0)])])),e("div",{class:I(["reservation-list__grid",{"reservation-list__grid--loading":a.isLoading,"reservation-list__grid--empty":p.value===0&&a.showEmptyMessage}])},[e("div",{class:I(["reservation-list__empty",{"reservation-list__empty--show":p.value===0&&a.showEmptyMessage&&!a.isLoading}])},[e("div",ts,[n(h,{class:"reservation-list__empty-icon",icon:a.emptyIcon,width:"54px",height:"54px"},null,8,["icon"]),e("h2",{innerHTML:a.emptyMessage},null,8,as),a.emptySubMessage?(u(),g("div",{key:0,class:"reservation-list__empty-submessage",innerHTML:a.emptySubMessage},null,8,is)):$("",!0)])],2),e("div",ns,[(u(!0),g(N,null,Q(s.value,V=>(u(),F(Je,{key:V.id,reservation:V,onDeleted:B,onClick:S},null,8,["reservation"]))),128))])],2),!a.hidePagination&&p.value>0?(u(),g("div",os,[n(ke,{modelValue:w.value,"onUpdate:modelValue":[c[4]||(c[4]=V=>w.value=V),c[5]||(c[5]=V=>a.$emit("update:page",V))],"active-color":"primary",density:"comfortable",length:Math.ceil(p.value/30),"total-visible":P(T).isSmartphoneVertical()?5:7},null,8,["modelValue","length","total-visible"])])):$("",!0),n(Zr,{modelValue:f.value,"onUpdate:modelValue":c[6]||(c[6]=V=>f.value=V),reservation:b.value,onDeleted:B,onUpdated:d},null,8,["modelValue","reservation"])],2)}}}),ys=q(ls,[["__scopeId","data-v-0a324376"]]);export{ys as R,X as a};
